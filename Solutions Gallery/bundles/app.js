define("ViewGallery/Flx",function(require,exports,module){var _=require("Underscore"),Class=require("tau/core/class"),Event=require("tau/core/event"),Mixin={defaultChangeListener:function(){this.isMounted()&&(this.changeListener||this.forceUpdate).apply(this)},componentDidMount:function(){(this.props.store||this.state.store).onChange(this.defaultChangeListener)},componentWillUnmount:function(){(this.props.store||this.state.store).offChange(this.defaultChangeListener)},componentWillReceiveProps:function(nextProps){nextProps.store&&(this.props.store.offChange(this.defaultChangeListener),nextProps.store.onChange(this.defaultChangeListener))}},createStore=function(proto){var EVENT_NAME="change",Store=Class.extend(_.extend({onChange:function(listener){this.addEventListener(EVENT_NAME,listener)},offChange:function(listener){this.removeListener(EVENT_NAME,listener)},fireChange:function(){this.fire(EVENT_NAME)}},proto));return Event.implementOn(Store.prototype),Store};return module.exports={Mixin:Mixin,createStore:createStore},module.exports}),define("ViewGallery/ScrollToMixin",function(require,exports,module){var $=require("jQuery"),ScrollTo={scrollTo:function(el,offset){var $scrolled;if($scrolled=this.getScrollToScrolledEl?this.getScrollToScrolledEl():$(this.getDOMNode()).parents(".vg-right:first"),el){var rect=el.getBoundingClientRect(),scrollVal=rect.top+(offset||0);$scrolled.animate({scrollTop:"+="+scrollVal})}else $scrolled[0].scrollTop=0}};return module.exports=ScrollTo,module.exports}),define("ViewGallery/SortableMixin",function(require,exports,module){var Sortable={handleDragStart:function(e){e.dataTransfer.effectAllowed="move";try{e.dataTransfer.setData("text/html",null)}catch(ex){e.dataTransfer.setData("text","")}this.props.sortStarted(this.props.index)},handleDragEnd:function(){this.props.sortCompleted(this.props.draggingIndex)},handleDragOver:function(e){e.preventDefault();var over=e.currentTarget;this.move(over)},move:function(over){var to=Number(over.dataset.index),from=this.props.draggingIndex;from!==to&&this.props.sort(from,to)},isDragging:function(){return this.props.draggingIndex===this.props.index}};return module.exports=Sortable,module.exports}),define("ViewGallery/StickyHeaderMixin",function(require,exports,module){var $=require("jQuery"),resize=function(component){if(component.refs.header&&component.refs.inner){var parentInnerWidth,right=0,innerWidth=component.refs.inner.getDOMNode().getBoundingClientRect().width;if(component.getStickyHeaderParent){var parent=component.getStickyHeaderParent();parent&&(parentInnerWidth=parent.getBoundingClientRect().width)}parentInnerWidth||(parentInnerWidth=component.refs.inner.getDOMNode().parentNode.getBoundingClientRect().width),parentInnerWidth>innerWidth&&(right=parentInnerWidth-innerWidth),$(component.refs.header.getDOMNode()).css({width:innerWidth,right:right}),$(component.refs.inner.getDOMNode()).css({marginTop:component.refs.header.getDOMNode().getBoundingClientRect().height})}},StickyHeader={componentDidUpdate:function(){resize(this)},componentDidMount:function(){resize(this),setTimeout(resize.bind(null,this),500),setTimeout(resize.bind(null,this),1e3),setTimeout(resize.bind(null,this),2e3)}};return module.exports=StickyHeader,module.exports}),define("ViewGallery/appStore",function(require,exports,module){var EventEmitter=require("tau/core/event"),Flx=require("ViewGallery/Flx"),SolutionStore=require("ViewGallery/solutionsStore"),track=require("ViewGallery/track"),boardCreator=require("ViewGallery/boardCreator"),Parse=require("ViewGallery/parse"),externalData=require("ViewGallery/externalData"),dispatcher=require("ViewGallery/dispatcher"),Store=Flx.createStore({init:function(config,settings){Parse.initialize(settings.parseClientId,settings.parseJSId),this.solutionsStore=new SolutionStore(config),this.isActive=config.activeByDefault,this.isActive&&this.solutionsStore.read(),this.progress=!1,this.deactivateListener=this.deactivate.bind(this),dispatcher.addEventListener("app:deactivate",this.deactivateListener),this.progressUpdateListener=this.updateProgress.bind(this),dispatcher.addEventListener("progress:update",this.progressUpdateListener)},activateFromMenu:function(){track({name:"activateFromMenu"}),this.hideExternalMenu(),this.activate()},activate:function(){this.progress=!1,this.isActive=!0,this.solutionsStore.isLoading=!0,this.solutionsStore.items=[],this.solutionsStore.read(),this.fireChange()},deactivate:function(){boardCreator.resetProcesses(),this.isActive=!1,this.hideExternalMenu(),dispatcher.removeListener("app:deactivate",this.deactivateListener),dispatcher.removeListener("progress:update",this.progressUpdateListener),this.fireChange()},addView:function(){this.isActive=!0,this.solutionsStore.isLoading=!0,this.solutionsStore.items=[],this.fireChange();var configurator=externalData.configurator;configurator.service("boardSettings").get({fields:["ownerIds"],callback:function(){var boardData=configurator.service("boardSettings").settings;this.solutionsStore.read().then(function(){this.solutionsStore.startAddView(boardData)}.bind(this))}.bind(this)})},updateProgress:function(e,val){this.progress=val,this.fireChange()},getPermissions:function(){return this.solutionsStore.logIn().then(function(){return this.solutionsStore.permissions}.bind(this))},hideExternalMenu:function(){var configurator=externalData.configurator;if(configurator.getViewsMenuActionsIntegrationService){var service=configurator.getViewsMenuActionsIntegrationService();service.toggleNewItemMenu&&service.toggleNewItemMenu(!1)}}});return EventEmitter.implementOn(Store.prototype),module.exports=Store,module.exports}),define("ViewGallery/boardApi",function(require,exports,module){var $=require("jQuery"),_=require("Underscore"),store=require("ViewGallery/restApi"),externalData=require("ViewGallery/externalData");return module.exports={allAcid:null,getAllAcid:function(){return this.allAcid?$.when(this.allAcid):this.getAcid("*","*").then(function(acid){return this.allAcid=acid,this.allAcid}.bind(this),function(){return $.when(null)})},getAcid:function(projectIds,teamIds){return store.loadOne("context","",{projectIds:projectIds,teamIds:teamIds}).then(function(res){return res.Acid})},getCurrentContext:function(){return externalData.configurator.getAppStateStore().get({fields:["acid"]}).then(function(res){var acid=res.acid;return store.loadOne("context","",{acid:acid})}).then(function(res){var teams=res.SelectedTeams;return res.AppContext.TeamContext.No&&(teams=[{Id:null}].concat(teams)),{projects:{items:res.SelectedProjects},teams:{items:teams}}})},createBoard:function(config){var appConfigurator=externalData.configurator;return appConfigurator.getViewsMenuService().boardsApi.createViewMenuItem(config).then(function(res){return res.data})},createGroup:function(config){var appConfigurator=externalData.configurator;return appConfigurator.getViewsMenuService().groupsApi.createViewMenuItem(config).then(function(res){return res.data})},getViewFolders:function(){var appConfigurator=externalData.configurator,processGroups=function(items){return items.map(function(v){return{title:v.itemData.name,boardKeys:_.filter(v.children,function(v){return"board"===v.itemType}).map(function(v){return v.itemData.key})}})};return $.ajax({url:appConfigurator.getApplicationPath()+"/api/views/v1",contentType:"application/json; charset=utf-8"}).then(function(res){var items=_.filter(res.items[1].children,function(v){return"group"===v.itemType&&v.itemData.name&&v.children&&v.children.length});return processGroups(items)})},getGroupedViews:function(){var appConfigurator=externalData.configurator,processGroups=function(items){return items.map(function(v){return{title:v.itemData.name||"Ungrouped",boards:_.filter(v.children,function(v){return"board"===v.itemType}).map(function(v){return{title:v.itemData.name,key:v.itemData.key}})}})};return $.ajax({url:appConfigurator.getApplicationPath()+"/api/views/v1",contentType:"application/json; charset=utf-8"}).then(function(res){var items=_.filter(res.items[1].children,function(v){return"group"===v.itemType&&v.children&&v.children.length});return processGroups(items)})},getBoardByKey:function(key){var appConfigurator=externalData.configurator;return $.ajax({url:appConfigurator.getApplicationPath()+"/api/views/v1/board/"+key,contentType:"application/json; charset=utf-8"}).then(function(res){return res})},processBoardData:function(boardData){var configuration=boardData,result=_.pick(configuration,"name","viewMode","cells","x","y","zoomLevel","cardSettings","prioritization","timelineSettings");if(configuration.timelineGlobalDateRange){var now=new Date,dates=configuration.timelineGlobalDateRange.split(" — "),startDate=new Date(dates[0]),endDate=new Date(dates[1]);if(startDate&&endDate){var start=Math.ceil((startDate-now)/864e5),end=Math.ceil((endDate-now)/864e5);result.timelineRelativeDays={start:start,end:end}}}return result.zoomLevel[result.viewMode]||(result.zoomLevel[result.viewMode]=_.first(_.compact(_.values(result.zoomLevel)))),result},createConfigFromBoard:function(key){return this.getBoardByKey(key).then(this.processBoardData)}},module.exports}),define("ViewGallery/boardCreator",function(require,exports,module){var _=require("Underscore"),$=require("jQuery"),track=require("ViewGallery/track"),boardApi=require("ViewGallery/boardApi"),store=require("ViewGallery/restApi"),configurator=require("tau/configurator"),prereqImport=require("ViewGallery/prerequisitesImport"),getCfIdentificator=prereqImport.getCfIdentificator,processesCache=[],resetProcesses=function(){processesCache=[]},getProcesses=function(){var list=processesCache;return list.length||(list=store.load("Processes",{include:store.wrapInclude(["Id","Name","Projects-Count",{CustomFields:["Id","Name","Value","EntityFieldName","FieldType","EnabledForFilter","Required",{EntityType:["Id","Name"]},"Config"]}]),take:999}).then(function(res){return processesCache=res})),list},createGlobalDateRange=function(config){if(!config.timelineRelativeDays||null===config.timelineRelativeDays.start||null===config.timelineRelativeDays.end)return null;var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dates=[];if(config.timelineRelativeDays.start||0===config.timelineRelativeDays.start){var startDate=new Date(Number(new Date)+24*config.timelineRelativeDays.start*3600*1e3);dates.push(startDate.getDate()+"-"+months[startDate.getMonth()]+"-"+startDate.getFullYear())}if(config.timelineRelativeDays.end||0===config.timelineRelativeDays.end){var endDate=new Date(Number(new Date)+24*config.timelineRelativeDays.end*3600*1e3);dates.push(endDate.getDate()+"-"+months[endDate.getMonth()]+"-"+endDate.getFullYear())}return dates.join(" — ")},goToBoard=function(id){var href=$(document.body).find("[data-sortable-key="+id+"]").children("a").prop("href");href&&(window.location.href=href)},getSolutionFullImportData=function(solution){var views=solution.views,dataToImport=_.deepClone(solution.prerequisitesData||{});return dataToImport.process||(dataToImport.customFields=views.reduce(function(res,v){return v.prerequisitesData?res.concat(v.prerequisitesData.customFields):res},[]),dataToImport.customFields=_.uniq(dataToImport.customFields,getCfIdentificator),dataToImport.forceProcesses=_.any(solution.views,function(v){return v.prerequisitesForceProcesses})),dataToImport.process||dataToImport.customFields.length?dataToImport:null},createFromSolution=function(item,opts){var solution=item,acids=[],importData=function(){return prereqImport.importSolution(item,getSolutionFullImportData(item),opts)},createGroup=function(item){track({name:"createGroup",solution:_.omit(solution,"userData","views")});var config={name:item.title,isExpanded:!0,menuIsVisible:!0,menuNumericPriority:Number(new Date)};return boardApi.createGroup(config)},createBoard=function(item,groupId,priority){track({name:"createViewWithGroup",view:_.omit(item,"userData"),solution:_.omit(solution,"userData","views")});var config=_.deepClone(item.config),zoom=config.zoomLevel;return"object"!=typeof zoom&&(config.zoomLevel={},config.zoomLevel[config.viewMode]=zoom),config.name=item.title,config.menuGroupKey=groupId,config.menuNumericPriority=priority,config.menuIsVisible=!0,config.timelineGlobalDateRange=createGlobalDateRange(config),config.acid=acids[priority],boardApi.createBoard(config)},createBoards=function(group){var gone=!1;return $.when.apply(null,item.views.map(function(view,k){return acids[k]?$.when(createBoard(view,group.key,k)).then(function(board){gone||(gone=!0,goToBoard(board.key))}):null}))};return $.when(importData(item)).then(function(res){return opts.onBeforeCreate&&opts.onBeforeCreate(),acids=res,resetProcesses(),createGroup(item)}).then(function(group){return createBoards(group)})},getViewFullImportData=function(view,solution){var dataToImport=_.deepClone(view.prerequisitesData||{}),solutionDataToImport=_.deepClone(solution.prerequisitesData||{});return dataToImport=_.extend(dataToImport,solutionDataToImport),dataToImport.customFields=dataToImport.process?dataToImport.process.customFields:dataToImport.customFields,dataToImport.customFields=dataToImport.customFields||[],dataToImport.forceProcesses=view.prerequisitesForceProcesses,dataToImport.process||dataToImport.customFields.length?dataToImport:null},createFromView=function(view,solution,opts){track({name:"createView",view:_.omit(view,"userData"),solution:_.omit(solution,"userData","views")});var importData=function(){var dataToImport=getViewFullImportData(view,solution);return prereqImport.importView(dataToImport,opts)},config=_.deepClone(view.config),zoom=config.zoomLevel;return"object"!=typeof zoom&&(config.zoomLevel={},config.zoomLevel[config.viewMode]=zoom),config.name=view.title,config.menuIsVisible=!0,config.menuNumericPriority=Number(new Date),config.timelineGlobalDateRange=createGlobalDateRange(config),$.when(importData()).then(function(acid){return opts.onBeforeCreate&&opts.onBeforeCreate(),resetProcesses(),config.acid=acid,boardApi.createBoard(config)}).then(function(res){var id=res.key;return goToBoard(id),res})},getImportRestrictions=function(solution,views){var processCustomFields=function(dataToImport){return dataToImport.customFields=views.reduce(function(res,v){return v.prerequisitesData?res.concat(v.prerequisitesData.customFields):res},dataToImport.customFields),dataToImport.customFields=_.uniq(dataToImport.customFields,getCfIdentificator),dataToImport},user=configurator.getLoggedUser();if(user.isAdministrator)return $.when(!1);var dataToImport=_.deepClone(solution.prerequisitesData||{});if(dataToImport.process?dataToImport.customFields=[]:(dataToImport.customFields=dataToImport.customFields||[],dataToImport=processCustomFields(dataToImport)),!dataToImport.process&&!dataToImport.customFields.length)return $.when(!1);var checkFields=function(process1,process2){return _.all(process1.CustomFields,function(cf){return _.any(process2.CustomFields,function(cf2){return getCfIdentificator(cf)===getCfIdentificator(cf2)})})};return $.when(getProcesses()).then(function(processes){if(dataToImport.process){var processData=dataToImport.process,process=_.findWhere(processes,{Name:processData.Name});if(!process)return"no-process";if(!process["Projects-Count"])return"no-project"}else if(dataToImport.customFields)return processes=_.filter(processes,function(process){return process["Projects-Count"]}),processes.length?(processes=_.filter(processes,function(process){return checkFields({CustomFields:dataToImport.customFields},process)}),processes.length?!1:"no-customfields"):"no-any-process"})},getSolutionImportRestrictions=function(solution){if(solution.prerequisitesData&&solution.prerequisitesData.process)return $.when(getImportRestrictions(solution,[])).then(function(code){return{code:code,disabled:Boolean(code),process:"no-project"===code||"no-process"===code?solution.prerequisitesData.process:null}});var views=_.filter(solution.views,function(v){return v.objectId}),restrictions=views.map(function(v){return getImportRestrictions(solution,[v])});return $.when.apply(null,restrictions).then(function(){var restrs=_.toArray(arguments),restrictedViews=views.reduce(function(res,v,k){return restrs[k]&&(res=res.concat(v)),res},[]),res={code:!1,views:restrictedViews};restrictedViews.length&&(res.code="no-customfields"),restrictedViews.length===views.length&&(res.disabled=!0);var cfs=restrictedViews.reduce(function(res,v){return res.concat(v.prerequisitesData.customFields||[])},[]);return cfs=_.uniq(cfs,getCfIdentificator),res.customFields=cfs,res})},getViewImportRestrictions=function(view,solution){return $.when(getImportRestrictions(solution,[view])).then(function(code){return{code:code,disabled:Boolean(code),process:"no-project"===code||"no-process"===code?solution.prerequisitesData.process:null,customFields:"no-customfields"===code?view.prerequisitesData.customFields:null}})};return module.exports={createFromSolution:createFromSolution,createFromView:createFromView,getSolutionImportRestrictions:getSolutionImportRestrictions,getViewImportRestrictions:getViewImportRestrictions,getSolutionFullImportData:getSolutionFullImportData,getViewFullImportData:getViewFullImportData,resetProcesses:resetProcesses},module.exports}),define("ViewGallery/dispatcher",function(require,exports,module){var Bus=require("tau/core/bus"),dispatcher=new Bus;return module.exports=dispatcher,module.exports}),define("ViewGallery/externalData",function(require,exports,module){return module.exports={configurator:null},module.exports}),define("ViewGallery/fileInputMultipleStore",function(require,exports,module){var EventEmitter=require("tau/core/event"),_=require("Underscore"),Flx=require("ViewGallery/Flx"),Store=Flx.createStore({id:0,init:function(item){var urls=item.screenshotImg?[item.screenshotImg]:[];urls=item.screenshotImgs&&item.screenshotImgs.length?item.screenshotImgs:urls,this.items=urls.map(function(v){return{id:++this.id,userData:{},file:v}}.bind(this)),this.items=this.items.concat({id:null,userData:{}})},read:function(){this.fireChange()},select:function(item){this.items=this.items.map(function(v){return v.userData.isSelected=!1,v}),item.userData.isSelected=!0,this.activeIndex=this.items.indexOf(item),this.fireChange()},remove:function(item){item.id&&(this.items=_.without(this.items,item),this.fireChange())},update:function(item,value){item.file=value.resizeData,item.inputData=value,item.id||(item.id=++this.id,this.items=this.items.concat({id:null,userData:{}})),this.fireChange()},reorder:function(from,to){var items=this.items,item=items[from];items.splice(from,1),items.splice(to,0,item),this.draggingIndex=to,this.items=items,this.fireChange()},startSort:function(index){this.draggingIndex=index,this.fireChange()},startAdd:function(){_.findWhere(this.items,{id:null})||(this.items=this.items.concat({id:null,userData:{}})),this.fireChange()},getValue:function(){return _.filter(this.items,function(v){return v.id}).map(function(v){return v.inputData||v})}});return EventEmitter.implementOn(Store.prototype),module.exports=Store,module.exports}),define("ViewGallery/makeHttpsImg",function(require,exports,module){return module.exports=function(url){return url&&window.location.href.match(/^https:\/\//)?"https://images.weserv.nl/?url="+window.encodeURI(url.replace(/^http:\/\//,"")):url},module.exports}),define("ViewGallery/markdown",function(require,exports,module){var $=require("jQuery"),ShowdownConverter=require("showdown").converter,converter=new ShowdownConverter;return module.exports={toHtml:function(val){var t=converter.makeHtml(val||"");return $("<div />").html(t).html()}},module.exports}),define("ViewGallery/model",function(require,exports,module){var Parse=require("ViewGallery/parse"),Solution=Parse.Object.extend("Solution"),SolutionCollection=Parse.Collection.extend({model:Solution,query:new Parse.Query(Solution).ascending("priority").limit(1e3)}),View=Parse.Object.extend("View"),ViewCollection=Parse.Collection.extend({model:View,query:new Parse.Query(View).ascending("priority").limit(1e3)}),Feedback=Parse.Object.extend("Feedback");return module.exports={View:View,ViewCollection:ViewCollection,Solution:Solution,SolutionCollection:SolutionCollection,Feedback:Feedback},module.exports}),define("ViewGallery/notify",function(require,exports,module){var configurator=require("tau/configurator"),error=function(message){configurator.getBusRegistry().getByName("application board").then(function(bus){bus.fire("error",{message:message})})},success=function(message){configurator.getBusRegistry().getByName("application board").then(function(bus){setTimeout(function(){bus.fire("notification",{message:message})},2e3)})};return module.exports={success:success,error:error},module.exports}),define("ViewGallery/prerequisitesExport",function(require,exports,module){var $=require("jQuery"),_=require("Underscore"),store=require("ViewGallery/restApi"),configurator=require("tau/configurator"),hasTerms=Boolean(configurator.getStore().typeMetaInfo("process").refs.terms),getProcess=function(id){return store.loadOne("Processes",id,{include:store.wrapInclude(["Name","Description",{Projects:["Id","Name"]},{Practices:["Id","Name"]},{CustomFields:["Id","Name","Value","EntityFieldName","FieldType","EnabledForFilter","Required",{EntityType:["Id","Name"]},"Config"]}])})},getEntityStates=function(process){return store.load("EntityStates",{include:store.wrapInclude(["Id","Name","IsInitial","IsFinal","IsPlanned","IsCommentRequired",{EntityType:["Id"]}]),where:"Process.Id eq "+process.Id,orderBy:"NumericPriority"})},getTerms=function(process){return hasTerms?store.load("Terms",{include:store.wrapInclude(["WordKey","Value"]),where:"Process.Id eq "+process.Id,take:999}):process.Projects.length?store.loadOne("context","",{projectIds:process.Projects[0].Id}).then(function(res){return res.Processes[0].Terms}):[]},exportProcess=function(id){var result={};return $.when(getProcess(id)).then(function(process){var copyProcess=_.omit(process,"Id","Projects");return copyProcess.CustomFields=copyProcess.CustomFields.map(function(v){return _.omit(v,"Id","ConfigString")}),result.process=copyProcess,$.when(getEntityStates(process),getTerms(process))}).then(function(entityStates,terms){return result.entityStates=entityStates.map(function(v){return _.omit(v,"Id")}),result.terms=terms,result})},exportCustomFields=function(customFields){var result={};return result.customFields=customFields.map(function(v){return _.omit(v,"Id","ConfigString")}),result};return module.exports={doExport:exportProcess,doExportView:exportCustomFields},module.exports}),define("ViewGallery/prerequisitesImport",function(require,exports,module){var _=require("Underscore"),$=require("jQuery"),configurator=require("tau/configurator"),hasWorkflows=Boolean(configurator.getStore().typeMetaInfo("process").refs.workflows),boardApi=require("ViewGallery/boardApi"),store=require("ViewGallery/restApi"),createTerms=function(process,termsData){var defaultTerms={Release:["Release","Releases"],Iteration:["Iteration","Iterations"],SquadIteration:["Team Iteration","Team Iterations"],Epic:["Epic","Epics"],Feature:["Feature","Features"],UserStory:["User Story","User Stories"],Bug:["Bug","Bugs"],Build:["Build","Builds"],Impediment:["Impediment","Impediments"]},terms=_.object(termsData.map(function(v){return[v.Name||v.WordKey,v.Value]})),resTerms={};_.forEach(defaultTerms,function(defTerms,entityType){_.forEach(defTerms,function(v,k){terms[v]&&(resTerms[entityType]||(resTerms[entityType]={}),resTerms[entityType][k?"plural":"single"]=terms[v])})});var sendTerms=_.map(resTerms,function(v,k){return v.entityKind=k,v});return store.insert("../../terms/",{processId:process.Id,terms:sendTerms})},getAcidByProjects=function(projects){return boardApi.getAcid(_.pluck(projects,"Id").join(","),"*")},getAcidByContextData=function(contextData){var args=["projects","teams"].map(function(v){if(contextData[v].all)return"*";var items=_.pluck(contextData[v].items,"Id");return items=items.map(function(v){return null===v?"null":v}),items.join(",")});return boardApi.getAcid.apply(boardApi,args)},getAllAcid=function(){return boardApi.getAllAcid()},getAllProcesses=function(){return store.load("Processes",{include:store.wrapInclude(["Name",{Projects:["Id","Name","IsActive"]},{CustomFields:["Id","Name","Value","Config","FieldType",{EntityType:["Id","Name"]}]}])}).then(function(res){return res.map(function(v){return v.Projects=_.where(v.Projects,{IsActive:!0}),v})})},findProcess=function(processData){return store.load("Processes",{include:store.wrapInclude(["Id","Name",{CustomFields:["Id","Name","Value","EntityFieldName","FieldType","EnabledForFilter","Required",{EntityType:["Id","Name"]},"Config"]}])}).then(function(items){return _.find(items,function(v){return v.Name.toLowerCase()===processData.Name.toLowerCase()})})},findProcessById=function(id){return store.loadOne("Processes",id,{include:store.wrapInclude(["Id","Name",{Projects:["Id","Name","IsActive"]},{CustomFields:["Id","Name","Value","EntityFieldName","FieldType","EnabledForFilter","Required",{EntityType:["Id","Name"]},"Config"]}])}).then(function(res){return res.Projects=_.where(res.Projects,{IsActive:!0}),res})},getProcessesByProjects=function(projects){var findByProjects=function(process){return _.any(projects,function(pr){return _.find(process.Projects,function(pr2){return pr2.Id===pr.Id})})};return $.when(getAllProcesses()).then(function(processes){return _.filter(processes,findByProjects)})},escapeRegExp=function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},findProjectByName=function(name){var reg=new RegExp("^"+escapeRegExp(name)+"( \\((\\d+)\\))?$","i");return store.load("Projects",{take:999,orderBy:"Name"}).then(function(items){var exact=_.find(items,function(v){return v.Name.toLowerCase()===name.toLowerCase()});if(!exact)return null;items=_.map(items,function(v){var match=v.Name.match(reg);return match?{item:v,count:Number(match[2]||0)}:null}),items=_.compact(items);var max=items.reduce(function(res,v){return v.count>=res.count?v:res},{count:0});return max})},findProjects=function(processData){return store.load("Projects",{include:store.wrapInclude(["Name",{Process:["Id","Name"]}]),where:['(Process.Name eq "'+processData.Name+'")','(isActive eq "True")'].join(" and ")})},createProject=function(process,name){return store.insert("Projects",{Name:name||process.Name,Process:{Id:process.Id}})},createProcess=function(processData){processData.CustomFields=processData.CustomFields.map(function(v){return"DefaultValue"in v.Config||(v.Config.DefaultValue=null),v});var dataToInsert={Name:processData.Name,Description:processData.Description,Practices:processData.Practices,CustomFields:processData.CustomFields};if(hasWorkflows){var workflows=_.groupBy(processData.EntityStates,function(state){return state.EntityType.Id});workflows=_.values(workflows).map(function(states){return{Name:"Main Workflow",EntityType:states[0].EntityType,EntityStates:states.map(function(v,k){var es=_.omit(v,"EntityType");return es.NumericPriority=k,es})}}),dataToInsert.Workflows=workflows}return $.when(store.insert("Processes",dataToInsert)).then(function(process){return $.when(process,createTerms(process,processData.Terms||[]))})},createAll=function(processData,newProjectName,onProgress){return $.when(!0).then(function(){return createProcess(processData)}).then(function(process){return onProgress(50),$.when(process,createProject(process,newProjectName))}).fail(function(){return $.when(null)})},createConfirm=function(next,args){if(next){var def=new $.Deferred;return next.apply(null,args.concat(function(code){code===!1?def.reject():arguments.length?def.resolve.apply(def,_.toArray(arguments)):def.resolve.apply(def,args)})),def}return $.when.apply(null,args)},getOrCreateProcessWithProjects=function(processData,opts){var onProgress=opts.onProgress||function(){},newProjectName=processData.Name,confirmExistingProcessAndExistingProjects=function(process,projects){return createConfirm(opts.onConfirmExistingProcessAndExistingProjects,[process,projects])},confirmNewProcessAndNewProject=function(process,project){return createConfirm(opts.onConfirmNewProcessAndNewProject,[process,project])},confirmExistingProcessAndNewProject=function(process,project){return createConfirm(opts.onConfirmExistingProcessAndNewProject,[process,project])};return $.when(findProcess(processData),findProjectByName(newProjectName)).then(function(process,project){return project&&(newProjectName=newProjectName+" ("+(project.count+1)+")"),$.when(process,process?findProjects(process):[])}).then(function(process,projects){var newProject={Name:newProjectName};return process?projects.length?confirmExistingProcessAndExistingProjects(process,projects):confirmExistingProcessAndNewProject(process,newProject):confirmNewProcessAndNewProject(processData,newProject)}).then(function(process,projects){return onProgress(30),process&&process.Id?projects.length?process:createProject(process,newProjectName).then(function(){return onProgress(50),process}):createAll(process,newProjectName,onProgress)}).then(function(process){return findProcessById(process.Id)})},getCfIdentificator=function(cf){return[cf.Name,cf.EntityType.Name,cf.FieldType].join("|")},getConnectedTeams=function(projects){if(!projects.length)return[];var ids=_.pluck(projects,"Id");return store.load("Projects",{include:store.wrapInclude([{TeamProjects:[{Team:["Id"]}]}]),where:["Id in ("+ids+")"].join(" and ")}).then(function(res){return res.reduce(function(res,v){return res.concat(_.pluck(v.TeamProjects,"Team"))},[])})},findProcessesWithCustomFields=function(customFields){var isAdministrator=configurator.getLoggedUser().isAdministrator,countFields=function(process1,process2){return _.reduce(process1.CustomFields,function(res,cf){return _.any(process2.CustomFields,function(cf2){return getCfIdentificator(cf)===getCfIdentificator(cf2)})?res+1:res},0)};return $.when(getAllProcesses()).then(function(processes){if(processes=_.filter(processes,function(pr){return pr.Projects.length}),processes=processes.map(function(pr){return pr.cfCount=countFields({CustomFields:customFields},pr),pr}),processes=_.sortBy(processes,function(v){return-1*v.cfCount}),processes.length&&processes[0].cfCount>0){var maxProcess=processes[0];if(!isAdministrator&&maxProcess.cfCount<customFields.length)return[];if(maxProcess.cfCount<customFields.length)return[maxProcess];var max=maxProcess.cfCount;return _.where(processes,{cfCount:max})}return[]})},findProjectsWithCustomFields=function(customFields){return $.when(findProcessesWithCustomFields(customFields)).then(function(processes){return _.flatten(_.pluck(processes,"Projects"))})},findExistingCustomFieldsInProcesses=function(customFields){return $.when(findProcessesWithCustomFields(customFields)).then(function(processes){if(processes.length){var process=processes[0],findByIdentificator=function(cf,cf2){return getCfIdentificator(cf)===getCfIdentificator(cf2)},cfs=customFields.map(function(cf){return _.find(process.CustomFields,findByIdentificator.bind(null,cf))||cf});return cfs}return customFields})},updateProcessesWithCustomFields=function(processes,customFieldsData,onProgress){var progress=0,part=100/processes.length;customFieldsData=customFieldsData.map(function(v){return _.omit(v,"Id")});var update=function(process){return process.CustomFields=process.CustomFields.concat(customFieldsData),process.CustomFields=_.uniq(process.CustomFields,getCfIdentificator),process.CustomFields=process.CustomFields.map(function(v){return"DefaultValue"in v.Config||(v.Config.DefaultValue=null),v}),store.update("Processes",process.Id,process).then(function(res){return progress+=part,onProgress(progress),res},function(){return progress+=part,onProgress(progress),process})},defs=processes.map(update);return $.when.apply(null,defs)},importData=function(dataToImport,opts){if(!(dataToImport&&(dataToImport.process||dataToImport.customFields&&dataToImport.customFields.length)))return boardApi.getAllAcid();
var acid,confirmImportError=function(){return createConfirm(opts.onImportError,[])},processes=[],onProgress=opts.onProgress||function(){};if(dataToImport.process){var processData=dataToImport.process;processData.EntityStates=dataToImport.entityStates,processData.Terms=dataToImport.terms,processes=$.when(!0).then(function(){return getOrCreateProcessWithProjects(processData,opts)}).then(function(process){return onProgress(90),$.when(getAcidByProjects(process.Projects),process)}).then(function(result,process){return acid=result,[process]})}else if(dataToImport.customFields.length){var isAdministrator=configurator.getLoggedUser().isAdministrator;processes=$.when.apply(null,[findProjectsWithCustomFields(dataToImport.customFields),findExistingCustomFieldsInProcesses(dataToImport.customFields)]).then(function(projects,customFields){return $.when(projects,getConnectedTeams(projects),customFields)}).then(function(projects,teams,customFields){var confirmCF=createConfirm(opts.onConfirmCustomFields,[projects,teams,customFields]);return $.when(confirmCF)}).then(function(contextData,customFields){if(onProgress(10),contextData&&0!==contextData.length){var projects=contextData.projects.items;return $.when(getAcidByContextData(contextData),getProcessesByProjects(projects),customFields)}return $.when(getAllAcid(contextData),getAllProcesses(),dataToImport.customFields)}).then(function(acid,processes,customFields){return $.when(acid,isAdministrator?updateProcessesWithCustomFields(processes,customFields,onProgress):[])}).then(function(res){return acid=res})}else onProgress(50);var execute=$.when(processes).then(function(){return acid});return $.when(execute).then(function(res){return res},confirmImportError)},importSolution=function(solution,dataToImport,opts){if(dataToImport)return $.when(importData(dataToImport,opts)).then(function(acid){return solution.views.map(function(v){return solution.userData.importRestrictions&&"no-customfields"===solution.userData.importRestrictions.code&&solution.userData.importRestrictions.views&&solution.userData.importRestrictions.views.indexOf(v)>=0?null:acid})});var confirmContext=createConfirm(opts.onConfirmContext,[]);return $.when(confirmContext).then(function(contextData){return getAcidByContextData(contextData)}).then(function(acid){return solution.views.map(function(){return acid})})},importView=function(dataToImport,opts){if(dataToImport)return importData(dataToImport,opts);var confirmContext=createConfirm(opts.onConfirmContext,[]);return $.when(confirmContext).then(function(contextData){return getAcidByContextData(contextData)})};return module.exports={importView:importView,importSolution:importSolution,getCfIdentificator:getCfIdentificator},module.exports}),define("ViewGallery/restApi",function(require,exports,module){var $=require("jQuery"),_=require("Underscore"),configurator=require("tau/configurator"),loadSimple=function(url,params){return $.ajax({type:"get",url:url,contentType:"application/json; charset=utf-8",dataType:"json",data:params})},processResult=function(result){return _.isArray(result)?result.map(function(v){return processResult(v)}):_.isObject(result)?result.Items&&_.isArray(result.Items)?processResult(result.Items):_.object(_.map(result,function(v,k){var key=k;return[key,processResult(v)]})):result},load=function(resource,params){var loadPages=function loadPages(url,params){return loadSimple(url,params).then(function(res){var items=res.Items;return res.Next?loadPages(res.Next).then(function(nextItems){return items.concat(nextItems)}):items})};return loadPages(configurator.getApplicationPath()+"/api/v1/"+resource,params).then(function(res){return processResult(res)})},loadOne=function(resource,id,params){return loadSimple(configurator.getApplicationPath()+"/api/v1/"+resource+"/"+id,params).then(function(res){return processResult(res)})},postSimple=function(url,params){return $.ajax({type:"post",url:url,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(params)})},removeSimple=function(url,params){return $.ajax({type:"post",url:url,contentType:"application/json; charset=utf-8",dataType:"json",headers:{"X-HTTP-Method-Override":"DELETE"},data:JSON.stringify(params)})},insert=function(resource,params){return postSimple(configurator.getApplicationPath()+"/api/v1/"+resource,params).then(function(res){return processResult(res)})},update=function(resource,id,params){return postSimple(configurator.getApplicationPath()+"/api/v1/"+resource+"/"+id,params).then(function(res){return processResult(res)})},remove=function(resource,id){return removeSimple(configurator.getApplicationPath()+"/api/v1/"+resource+"/"+id).then(function(res){return processResult(res)})},stringify=function(obj){var res="";return obj&&(Array.isArray(obj)?res=obj.map(stringify).join(","):"object"==typeof obj?res=Object.keys(obj).map(function(key){return key+"["+stringify(obj[key])+"]"}).join(","):"function"!=typeof obj&&(res=String(obj))),res},wrapInclude=function(obj){return"["+stringify(obj)+"]"};return module.exports={load:load,loadOne:loadOne,insert:insert,update:update,remove:remove,wrapInclude:wrapInclude},module.exports}),define("ViewGallery/solutionsGroupStore",function(require,exports,module){var EventEmitter=require("tau/core/event"),_=require("Underscore"),Flx=require("ViewGallery/Flx"),model=require("ViewGallery/model"),Solution=model.Solution,Store=Flx.createStore({init:function(solutionStore,group){if(this.solutionStore=solutionStore,this.items=group.items,this.title=group.title,this.permissions=_.extend({},solutionStore.permissions),this.permissions.add=this.permissions.add&&!Boolean(group.host),this.permissions.collapse=this.permissions.edit&&!this.permissions.add,this.isCollapsed=!1,this.permissions.collapse){var r=!1;try{r=JSON.parse(window.localStorage.getItem("vg__group__"+this.title+"__collapsed"))}catch(e){}this.isCollapsed=r}},getListItems:function(){return this.items},reorder:function(from,to){if(this.isDragging){var item=this.items[from];this.items.splice(from,1),this.items.splice(to,0,item),this.draggingIndex=to,this.solutionStore.items=_.union(_.difference(this.solutionStore.items,this.items),this.items),this.fireChange()}},prioritize:function(index){var item=this.items[index];this.items[index].userData.isDragging=!1,this.isDragging=!1;var priority,minPriority=0,maxPriority=9007199254740992,delta=1e6,prev=index?this.items[index-1]:null,next=this.items[index+1];next&&prev?priority=(next.priority+prev.priority)/2:next?priority=next.priority/1.5:prev&&(priority=prev.priority+delta),priority=Math.round(priority),minPriority>=priority||priority>=maxPriority||prev&&priority===prev.priority||next&&priority===next.priority?(this.items=this.items.map(function(v,k){return v.priority=(delta+1)*(k+1),v}),this.writePriorities()):(item.priority=priority,this.solutionStore.writeOne(item)),this.solutionStore.items=_.union(_.difference(this.solutionStore.items,this.items),this.items),this.fireChange()},startSort:function(index){this.draggingIndex=index,this.items[index].userData.isDragging=!0,this.isDragging=!0,this.solutionStore.items=_.union(_.difference(this.solutionStore.items,this.items),this.items),this.fireChange()},writePriorities:function(){this.items.forEach(function(item){var obj=new Solution,writeItem={id:item.objectId,priority:item.priority};return obj.save(writeItem)})},toggleCollapse:function(){this.isCollapsed=!this.isCollapsed,window.localStorage&&window.localStorage.setItem("vg__group__"+this.title+"__collapsed",JSON.stringify(this.isCollapsed)),this.fireChange()}});return EventEmitter.implementOn(Store.prototype),module.exports=Store,module.exports}),define("ViewGallery/solutionsStore",function(require,exports,module){var EventEmitter=require("tau/core/event"),_=require("Underscore"),$=require("jQuery"),Parse=require("ViewGallery/parse"),configurator=require("tau/configurator"),model=require("ViewGallery/model"),Solution=model.Solution,View=model.View,Feedback=model.Feedback,ViewStore=require("ViewGallery/viewsStore"),markdown=require("ViewGallery/markdown"),boardCreator=require("ViewGallery/boardCreator"),boardApi=require("ViewGallery/boardApi"),Flx=require("ViewGallery/Flx"),track=require("ViewGallery/track"),notify=require("ViewGallery/notify"),dispatcher=require("ViewGallery/dispatcher"),prerequisites=require("ViewGallery/prerequisitesExport"),Store=Flx.createStore({init:function(authConfig){this.authConfig=authConfig,this.items=[],this.filterText="",this.permissions={add:!1,edit:!1,remove:!1},this.user=null,this.isLoading=!0},logIn:function(){var setLogged=function(user){return this.user=user,this.permissions={add:!0,edit:!0,remove:!0},Parse.Promise.as(this.user)}.bind(this),setAnonymous=function(){return this.user="anonymous",this.permissions={add:!1,edit:!1,remove:!1},Parse.User.logOut(),Parse.Promise.as(this.user)}.bind(this);if(this.authConfig&&this.authConfig.login&&this.authConfig.password){var currentUser=Parse.User.current();return currentUser?setLogged(currentUser):Parse.User.logIn(this.authConfig.login,this.authConfig.password).then(function(user){return setLogged(user)},function(err){return this.err=err,setAnonymous()}.bind(this))}return setAnonymous()},read:function(){this.isAdding=!1,this.zeroView=!1,this.draggingIndex=null,this.items=[],this.filterText="";var toArray=function(res){return(_.isArray(res)?res:res.toArray()).map(function(v){var vv=v.attributes;return vv.objectId=v.id,vv.userData=vv.userData||{},vv.priority=vv.priority||0,vv})},fetchSolutions=function(host){var query=new Parse.Query(Solution);return query=query.ascending("priority").limit(1e3),host&&(query=query.containedIn("hostsAccess",[null,host])),query.find()},fetchViews=function(solutionIds){var query=new Parse.Query(View);return query.ascending("priority").limit(1e3).containedIn("parentId",solutionIds).find()};return this.logIn().then(function(){var host=configurator.getApplicationPath().replace(/https?:\/\//,""),speedTrack=track.start();return Parse.Promise.when([fetchSolutions(this.permissions.edit?!1:host)]).then(function(solutions){solutions=toArray(solutions);var ids=_.pluck(solutions,"objectId");return Parse.Promise.when([solutions,fetchViews(ids)])}).then(function(solutions,views){views=toArray(views);var groupedViews=_.groupBy(views,function(v){return v.parentId});if(this.items=solutions.map(function(v){return v.views=groupedViews[v.objectId]||[],v}),this.lastSelectedId){var selected=_.findWhere(this.items,{objectId:this.lastSelectedId});selected&&(selected.userData.isSelected=!0)}if(this.lastSelectedViewId){var view=_.findWhere(views,{objectId:this.lastSelectedViewId});view&&(view.userData.isSelected=!0)}speedTrack.stop({name:"serverRequest",type:"success"}),this.isLoading=!1,this.fireChange()}.bind(this),function(errs){var err=_.find(errs,function(v){return v&&v.message});notify.error("Server is not responding"),speedTrack.stop({name:"serverRequest",type:"error"}),track({name:"serverError",err:err})})}.bind(this))},write:function(){this.items.forEach(function(v){this.writeOne(v)}.bind(this))},writeOne:function(item){var obj=new Solution,writeItem=_.deepClone(item);return writeItem.userData={},writeItem.views=[],obj.save(writeItem).then(function(res){item.objectId=res.id},function(err){this.err=err,this.read()}.bind(this))},saveFromItems:function(item){var res=this.writeOne(item);return this.isEditing&&(this.isEditing=!1,this.fireChange()),res},select:function(item){var prevSelected=_.find(this.items,function(v){return v.userData.isSelected});this.items=this.items.map(function(v){return v.userData.isSelected=!1,v.userData.isEditingFull=!1,v.userData.showVideo=!1,v}),item.userData.isSelected=!0,this.isAdding?(prevSelected&&(prevSelected.views=_.reject(prevSelected.views,function(v){return!v.objectId})),item.views=item.views||[],item.views.indexOf(this.zeroView)<0&&item.views.push(this.zeroView)):prevSelected&&(prevSelected=this.resetViews(prevSelected)),prevSelected&&!prevSelected.objectId&&(this.items=_.without(this.items,prevSelected)),item.userData.scrollTo="start",Boolean(this.filterText)?item.userData.scrollTo="search":_.any(item.views,function(v){return v.userData&&v.userData.isSelected})?item.userData.scrollTo="edit":_.any(item.views,function(v){return v.userData&&v.userData.isSelected})&&(item.userData.scrollTo="select"),this.fireChange()},selectById:function(id){this.select(_.findWhere(this.items,{objectId:id}))},getSelected:function(){var selected=_.find(this.items,function(v){return v.userData.isSelected});return selected&&(selected.userData.fullPrerequisitesData=boardCreator.getSolutionFullImportData(selected)),selected},startAdd:function(){if(!_.any(this.items,function(v){return v.userData.isEditing})){this.items=this.items.map(function(v){return v.userData.isSelected=!1,v.userData.isEditingFull=!1,v.views=_.reject(v.views,function(vv){return!vv.objectId}),v});var newItem={title:"",userData:{isSelected:!0,isEditingFull:!0},views:[]};this.zeroView&&(newItem.views=[this.zeroView]),this.items=this.items.concat(newItem),this.fireChange()}},stopAdd:function(solution,isTrigger){this.isAdding=!1,this.zeroView=!1,solution.views=_.reject(solution.views,function(v){return!v.objectId}),isTrigger&&this.fireChange()},startEdit:function(item){this.permissions.edit&&(_.any(this.items,function(v){return v.userData.isEditing})||(item.userData.isEditingFull=!1,item.userData.isEditing=!0,this.fireChange()))},cancelEdit:function(item){item.objectId?(item.userData.isEditing=!1,item.userData.tmpTitle="",this.fireChange()):(this.items=_.without(this.items,item),this.fireChange())},save:function(item,title){title=title.trim(),title.length?(item.title=title,item.userData.isEditing=!1,this.items=this.items.map(function(v){return v.userData.isSelected=!1,v}),item.userData.isSelected=!0,item.objectId||(item.priority=Number(new Date)),this.fireChange(),this.writeOne(item)):item.objectId||(this.items=_.without(this.items,item),this.fireChange())},togglePrereq:function(item){item.userData.showPrereq=!item.userData.showPrereq,item.userData.showPrereqTooltip=!1,item.userData.showPrereq&&(this.scrollTo="prereq"),this.fireChange()},togglePrereqTooltip:function(item,val){item.userData.showPrereqTooltip=item.userData.showPrereq?!1:val,item.userData.showPrereq||(item.userData.importStatus=!1),this.fireChange()},toggleVideo:function(item){item.userData.showVideo=!item.userData.showVideo,this.fireChange()},toggleShowImportRestrictions:function(item,val){item.userData.showImportRestrictions=val,this.fireChange()},startAddView:function(config){if(!this.items.length)return void this.fireChange();this.isAdding=!0,this.items=this.items.map(function(v){return this.resetViews(v,"all")}.bind(this));var selected;this.lastSelectedId&&(selected=_.findWhere(this.items,{objectId:this.lastSelectedId}));var solution=selected||this.items[0];solution.userData.isSelected=!0,solution.views=solution.views||[],this.zeroView={title:config.name,shortDescription:"",userData:{isSelected:!0,isEditing:!0},config:boardApi.processBoardData(_.deepClone(config))},solution.views.push(this.zeroView),this.fireChange()},startRemove:function(item){this.items=this.items.map(function(v){return v.userData.isWaitingConfirmation=!1,v}),item.userData.isWaitingConfirmation=!0,this.fireChange()},cancelRemove:function(item){item.userData.isWaitingConfirmation=!1,this.fireChange()},remove:function(item){var i=this.items.indexOf(item),next=this.items[i-1]||this.items[i+1];this.items=_.without(this.items,item),item.userData.isSelected&&next&&(next.userData.isSelected=!0);var removeViews=item.views.map(function(v){if(!v.objectId)return!0;var obj=new View;return obj.id=v.objectId,obj.destroy()});Parse.Promise.when(removeViews).then(function(){var obj=new Solution;return obj.id=item.objectId,obj.destroy()}).then(function(){},function(err){this.err=err,this.read()}.bind(this)),this.fireChange()},resetViews:function(item,type){return item.views=item.views||[],item.views=_.reject(item.views,function(v){return!v.objectId}),item.views=item.views.map(function(v){return"all"===type?v.userData={}:(v.userData.isEditing=!1,v.userData.isWaitingConfirmation=!1),v}),item},createBoards:function(item){item=this.resetViews(item,"all"),item.userData.importStatus=null,item.userData.importContinuation=null,item.userData.showImportRestrictions=!1,item.userData.isCreating=!1,item.userData.createProgress=0,this.fireChange();var makeContinuation=function(next){return next};boardCreator.createFromSolution(item,{onConfirmCustomFields:function(projects,teams,customFields,next){item.userData.importData={projects:projects,teams:teams,customFields:customFields},item.userData.importStatus="customfields",item.userData.importContinuation=next,this.fireChange()}.bind(this),onConfirmContext:function(next){$.when(boardApi.getCurrentContext()).then(function(context){item.userData.importData={projects:context.projects.items,teams:context.teams.items},item.userData.importStatus="context",item.userData.importContinuation=next,this.fireChange()}.bind(this))}.bind(this),onConfirmNewProcessAndNewProject:function(process,project,next){item.userData.importData={process:{Name:process.Name},project:{Name:project.Name}},item.userData.importStatus="new-process-and-new-project",item.userData.importContinuation=makeContinuation(next),this.fireChange()}.bind(this),onConfirmExistingProcessAndNewProject:function(process,project,next){item.userData.importData={process:process,project:{Name:project.Name}},item.userData.importStatus="existing-process-and-new-project",item.userData.importContinuation=makeContinuation(next),this.fireChange()}.bind(this),onConfirmExistingProcessAndExistingProjects:function(process,projects,next){item.userData.importData={process:process,projects:projects},item.userData.importStatus="existing-process-and-existing-projects",item.userData.importContinuation=makeContinuation(next),this.fireChange()}.bind(this),onImportError:function(next){notify.error("We've had some problems during import, but solution will be created anyway"),next()},onProgress:function(val){item.userData.isCreating=!0,item.userData.createProgress=val,dispatcher.fire("progress:update",val),this.fireChange()}.bind(this),onBeforeCreate:function(){this.deactivateApp()}.bind(this)}).then(function(){notify.success("Solution has been added to your Targetprocess account"),item.userData.importData=null,item.userData.importStatus=null,item.userData.importContinuation=null,this.fireChange()}.bind(this))},confirmImport:function(item,confirmData){confirmData?item.userData.importContinuation(confirmData.context,confirmData.customFields):"customfields"===item.userData.importState?item.userData.importContinuation(null,null):item.userData.importContinuation(),item.userData.importData=null,item.userData.importStatus=null,this.fireChange()},cancelImport:function(item){item.userData.importData=null,item.userData.importStatus=null,item.userData.importContinuation=null,this.fireChange()},deactivateApp:function(){var time=100;setTimeout(function(){dispatcher.fire("app:deactivate")},time)},startEditFull:function(item){this.items=this.items.map(function(v){return v.userData.isEditing=!1,v.userData.isEditingFull=!1,v.userData.isWaitingConfirmation=!1,v.userData.tmpTitle=null,item.userData.isLoading=!1,item.userData.loadProgress=0,v}),item.userData.tmpTitle=item.title,item.userData.isEditingFull=!0,item.userData.isSelected=!0;var hasCfs=_.any(item.views,function(v){return v.prerequisitesData&&v.prerequisitesData.customFields&&v.prerequisitesData.customFields.length});item.userData.viewsHasCfs=hasCfs,item=this.resetViews(item,"all"),this.fireChange()},saveFull:function(item,formData){_.extend(item,formData),item.descriptionHtml=markdown.toHtml(item.description),item.prerequisitesHtml=markdown.toHtml(item.prerequisites);var isNew=!Boolean(item.objectId);isNew&&(item.priority=Number(new Date)),item.hostsAccess=item.hosts.length?item.hosts:[null],item.userData.isLoading=!0,item.userData.loadProgress=0,item.ACL={},item.isHidden?item.ACL[Parse.User.current().id]={read:!0,write:!0}:item.ACL["*"]={read:!0,write:!0},this.isAdding&&(item.views=item.views||[],item.views.indexOf(this.zeroView)<0&&item.views.push(this.zeroView)),item.prerequisitesProcessId=formData.prerequisitesProcessId;var execute;item.prerequisitesProcessId?(execute=new Parse.Promise,prerequisites.doExport(item.prerequisitesProcessId).then(execute.resolve.bind(execute),execute.reject.bind(execute)),execute=execute.then(function(exportData){return item.userData.loadProgress=10,item.prerequisitesData=exportData,this.writeOne(item)}.bind(this),function(){return this.writeOne(item)}.bind(this)).then(function(){this.fireChange()}.bind(this))):(item.prerequisitesData=null,execute=this.writeOne(item).then(function(){this.fireChange()}.bind(this))),isNew&&formData.viewFolder&&(execute=execute.then(function(){return this.importFromFolder(item,formData.viewFolder)}.bind(this))),execute.then(function(){item.userData.isLoading=!1,item.userData.isEditingFull=!1,this.fireChange()}.bind(this)),this.fireChange()},importFromFolder:function(item,folder){var addAndSaveView=function(view){item.views=item.views.concat(view);var store=new ViewStore(item,this);return store.writeOne(view)},views=folder.boardKeys.map(function(key,k){return boardApi.createConfigFromBoard(key).then(function(config){return{title:config.name,userData:{},config:config,priority:k}})}),part=100/(views.length||1),execute=new Parse.Promise;return $.when.apply(null,views).then(function(){execute.resolve(_.toArray(arguments))}),execute.then(function(processedViews){var saves=processedViews.reduce(function(res,v){return res.then(addAndSaveView.bind(this,v)).then(function(){item.userData.loadProgress+=part,this.fireChange()}.bind(this))}.bind(this),Parse.Promise.when(!0));return saves.then(function(){this.fireChange()}.bind(this))}.bind(this))},cancelEditFull:function(item){item.objectId?item.userData.isEditingFull&&(item.userData.isEditingFull=!1,this.isAdding&&(item.views=item.views||[],item.views.indexOf(this.zeroView)<0&&item.views.push(this.zeroView)),this.fireChange()):(this.items=_.without(this.items,item),this.fireChange())},setTmpTitle:function(item,title){item.userData.tmpTitle=title,this.fireChange()},filter:function(text){this.filterText=text,text&&(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(function(){track({name:"applyFilter",text:text})},1e3)),this.fireChange()},getListItems:function(){var filterText=this.filterText.trim().toLowerCase(),items=_.filter(this.items,function(v){return v.objectId});items=_.map(items,function(v){v.userData.isMatchFilter=!1;var isSolutionMatch=!filterText||!v.objectId||v.title.toLowerCase().indexOf(filterText)>=0;if(isSolutionMatch)v.userData.isMatchFilter=!0;else{var isViewMatch=_.any(v.views,function(view){return ViewStore.isMatchFilter(view,filterText)});v.userData.isMatchFilter=isViewMatch}return v});var grouped=_.groupBy(items,function(v){return v.hosts.length?"custom":""}),groups=_.map(grouped,function(v,k){return{host:k,title:k?"Custom Solutions":"Solutions",items:v}});groups=_.sortBy(groups,function(v){return v.host}),groups.length||(groups=[{host:"",title:"Solutions",items:[]}]);var selected=_.find(this.items,function(v){return v.userData.isSelected});if(!selected){var group=_.find(groups,function(v){return v.items.length>0});group&&(selected=group.items[0],selected.userData.isSelected=!0)}return selected&&selected.objectId&&(this.lastSelectedId=selected.objectId),this.selected=selected,groups},startFeedback:function(){this.feedbackStatus="",this.isFeedback=!0,this.fireChange()},cancelFeedback:function(){this.isFeedback=!1,this.fireChange()},submitFeedback:function(message){if(message){var host=configurator.getApplicationPath(),feedback=new Feedback;feedback.set("message",message),feedback.set("host",host),feedback.set("username",window.loggedUser.name),feedback.set("user",window.loggedUser),feedback.save(),this.feedbackStatus="success",this.fireChange()}},moveView:function(view,solutionFrom,solutionToId){solutionFrom.views=_.without(solutionFrom.views,view);var solutionTo=_.findWhere(this.items,{objectId:solutionToId});solutionTo.views.push(view);var viewStore=new ViewStore(solutionTo,this);viewStore.prioritize(solutionTo.views.length-1),this.select(solutionTo)},scrolledTo:function(){this.scrollTo=!1}});return EventEmitter.implementOn(Store.prototype),module.exports=Store,module.exports}),define("ViewGallery/terms",function(require,exports,module){var configurator=require("tau/configurator"),types=configurator.getStore().getTypes().getDictionary(),termMap={priority:"Business Value",projectmember:"Project Allocation",entitystate:"State",tag:"Tags",assigneduser:"Person",source:"Request Source",outboundrelations:"Outbound Relations",inboundrelations:"Inbound Relations"},modeMap={board:"Board",list:"One by one",newlist:"List",timeline:"Timeline"},getTermTitle=function(term){var normTerm=term.toLowerCase();return termMap.hasOwnProperty(normTerm)?termMap[normTerm]:types[normTerm]?types[normTerm].terms.name.val:term=term.replace(/^ddl/,"")},getViewModeTitle=function(name){return modeMap[name]||name};return module.exports={getTermTitle:getTermTitle,getViewModeTitle:getViewModeTitle},module.exports}),define("ViewGallery/track",function(require,exports,module){var track=function(data){window.taus&&window.taus.track("ViewGallery",data)};return track.start=function(data){return window.taus?window.taus.start("ViewGallery",data):void 0},module.exports=track,module.exports}),define("ViewGallery/viewsStore",function(require,exports,module){var EventEmitter=require("tau/core/event"),_=require("Underscore"),$=require("jQuery"),Parse=require("ViewGallery/parse"),model=require("ViewGallery/model"),View=model.View,Flx=require("ViewGallery/Flx"),markdown=require("ViewGallery/markdown"),terms=require("ViewGallery/terms"),notify=require("ViewGallery/notify"),dispatcher=require("ViewGallery/dispatcher"),boardCreator=require("ViewGallery/boardCreator"),prerequisites=require("ViewGallery/prerequisitesExport"),boardApi=require("ViewGallery/boardApi"),stringMatch=function(text,v){return v=(v||"").toLowerCase(),v.indexOf(text)>=0},isMatchFilter=function(item,filterText){var match=stringMatch.bind(null,filterText),matchAny=function(items){return _.any(items,match)},getTermTitles=function(items){return(items||[]).map(function(v){return terms.getTermTitle(v)})},matchTerms=function(terms){return matchAny(getTermTitles(terms))},matchConfigLine=function(line){return line&&line.types&&line.types.length?matchTerms(line.types):!1},res=!filterText||!item.objectId||match(item.title)||matchAny(item.tags);return!res&&item.config?match(terms.getViewModeTitle(item.config.viewMode))||matchConfigLine(item.config.cells)||matchConfigLine(item.config.x)||matchConfigLine(item.config.y):res},Store=Flx.createStore({init:function(solution,store){this.solution=solution,this.solutionStore=store,this.items=[];var data=this.solution.views||[];this.items=data.map(function(v){return v.userData=v.userData||{},v.tags=v.tags||[],v}),this.permissions=this.solutionStore.permissions,this.scrollTo=solution.userData.scrollTo},read:function(){var data=this.solution.views||[];this.items=data.map(function(v){return v.userData=v.userData||{},v.tags=v.tags||[],v}),this.scrollTo=this.solution.userData.scrollTo,this.fireChange()},writeOne:function(item){var obj=new View,writeItem=_.deepClone(item);return writeItem.userData={},writeItem.parentId=writeItem.parentId||this.solution.objectId,obj.save(writeItem).then(function(res){item.objectId=res.id},function(err){this.err=err,this.read()}.bind(this))},selectInner:function(item){var prev=_.find(this.items,function(v){return v.userData.isSelected});prev&&prev!==item&&!prev.objectId&&(this.items=_.without(this.items,prev),this.solution.views=this.items,this.solutionStore.isAdding=!1,this.solutionStore.zeroView=!1),item.userData.isEditing&&item.userData.isSelected||(this.items=this.items.map(function(v){return v.userData.isEditing=!1,item.userData.isWaitingConfirmation=!1,v.userData.isSelected=v===item?!v.userData.isSelected:!1,v}),this.solutionStore.lastSelectedViewId=null,this.solutionStore.cancelEditFull(this.solution))},select:function(item){this.hasViewTransition=!0,this.selectInner(item),this.scrollTo="select",this.fireChange()},hasNext:function(item){return this.items.indexOf(item)<this.items.length-1},hasPrev:function(item){return this.items.indexOf(item)>0},selectNext:function(item){var next=this.items.indexOf(item)+1;next>=this.items.length&&(next=0);var nextItem=this.items[next];this.hasViewTransition=!1,this.pagingDirection="next",this.scrollTo="top",this.selectInner(nextItem),this.fireChange()},selectPrevious:function(item){var next=this.items.indexOf(item)-1;0>next&&(next=this.items.length-1);var nextItem=this.items[next];this.hasViewTransition=!1,this.pagingDirection="prev",this.scrollTo="top",this.selectInner(nextItem),this.fireChange()},getSelected:function(){var selected=_.find(this.items,function(v){return v.userData.isSelected});return selected&&(selected.userData.fullPrerequisitesData=boardCreator.getViewFullImportData(selected,this.solution)),selected},startEdit:function(item){this.items=this.items.map(function(v){return v.userData.isEditing=!1,v.userData.isSelected=!1,item.userData.isWaitingConfirmation=!1,v}),item.userData.tmpTitle=null,item.userData.isEditing=!0,item.userData.isSelected=!0,this.scrollTo="edit",this.fireChange()},cancelEdit:function(item){item.objectId?(item.userData.isEditing=!1,item.userData.isWaitingConfirmation=!1,this.fireChange()):this.solutionStore.stopAdd(this.solution,!0)},toggleScreenshot:function(item){item.userData.isScreenshotFull=!item.userData.isScreenshotFull,this.fireChange()},togglePrereq:function(item){item.userData.showPrereq=!item.userData.showPrereq,item.userData.showPrereqTooltip=!1,item.userData.showPrereq&&(this.scrollTo="prereq"),this.fireChange()},togglePrereqTooltip:function(item,val){item.userData.showPrereqTooltip=item.userData.showPrereq?!1:val,item.userData.showPrereq||(item.userData.importStatus=!1),this.fireChange()},toggleVariations:function(item){item.userData.showVariations=!item.userData.showVariations,this.fireChange()},toggleConfig:function(item){item.userData.showConfig=!item.userData.showConfig,this.fireChange()},toggleConfigOnView:function(item){item.userData.hideConfigOnView=!item.userData.hideConfigOnView,this.fireChange()},save:function(item,formData){item.userData.isLoading=!0,item.userData.loadProgress=0;var total=0,loaded={},loadFile=function(res){if(!res||!_.isObject(res))return null;total+=res.resizeData.length;var name=res.file.name.replace(/[^\w.]/g,"0"),file=new Parse.File(name,{base64:res.resizeData});return file.save({onProgress:function(e){loaded[name]=e.loaded;var loadedSum=_.values(loaded).reduce(function(res,v){return res+v},0),percent=loadedSum/total*100;item.userData.loadProgress=percent,this.fireChange()}.bind(this)})}.bind(this),loadConfig=function(){return formData.configByKey?boardApi.createConfigFromBoard(formData.configByKey):null},loadFiles=function(data){var loads=data.map(function(v){return _.isObject(v.file)?loadFile(v):v.file});return Parse.Promise.when(loads).then(function(){return _.toArray(arguments)})};Parse.Promise.when([loadFile(formData.previewImg.file),loadFiles(formData.screenshotImg),loadConfig()]).then(function(preview,screenshots,config){item=_.extend(item,_.omit(formData,"previewImg","screenshotImg")),item.descriptionHtml=markdown.toHtml(item.description),item.prerequisitesHtml=markdown.toHtml(item.prerequisites),item.variationsHtml=markdown.toHtml(item.variations),item.tags=(item.tags||"").split(",").map(function(v){return v.trim()}),item.tags=_.unique(_.compact(item.tags)),preview?item.previewImg=preview.url():formData.previewImg.isClear&&(item.previewImg=null),item.screenshotImgs=screenshots.map(function(v){return v.url?v.url():v}),item.screenshotImg=null,config&&(item.config=config),item.userData.isEditing=!1,item.userData.isWaitingConfirmation=!1,item.userData.isLoading=!1,item.userData.loadProgress=0,item.prerequisitesDataCustomFields=formData.prerequisitesDataCustomFields,item.prerequisitesData=prerequisites.doExportView(formData.prerequisitesDataCustomFields),this.writeOne(item).then(function(){if(!item.priority){var index=this.items.indexOf(item);
index>=0&&this.prioritize(index)}}.bind(this)),this.solutionStore.stopAdd(this.solution),item.parentId!==this.solution.objectId?this.solutionStore.moveView(item,this.solution,item.parentId):(this.moveToSelected=!0,this.fireChange())}.bind(this))},startRemove:function(item){this.items=this.items.map(function(v){return v.userData.isWaitingConfirmation=!1,v}),item.userData.isWaitingConfirmation=!0,this.fireChange()},cancelRemove:function(item){item.userData.isWaitingConfirmation=!1,this.fireChange()},remove:function(item){this.items=_.without(this.items,item),this.solution.views=this.items;var obj=new View;obj.id=item.objectId,obj.destroy().then(function(){},function(err){this.err=err,this.read()}.bind(this)),this.solutionStore.fireChange()},createBoard:function(item){item.userData.importStatus=null,item.userData.importContinuation=null,item.userData.showImportRestrictions=!1,item.userData.isCreating=!1,item.userData.createProgress=0,this.fireChange();var makeContinuation=function(next){return next};boardCreator.createFromView(item,this.solution,{onConfirmCustomFields:function(projects,teams,customFields,next){item.userData.importData={projects:projects,teams:teams,customFields:customFields},item.userData.importStatus="customfields",item.userData.importContinuation=makeContinuation(next),this.fireChange()}.bind(this),onConfirmContext:function(next){$.when(boardApi.getCurrentContext()).then(function(context){item.userData.importData={projects:context.projects.items,teams:context.teams.items},item.userData.importStatus="context",item.userData.importContinuation=next,this.fireChange()}.bind(this))}.bind(this),onConfirmNewProcessAndNewProject:function(process,project,next){item.userData.importData={process:{Name:process.Name},project:{Name:project.Name}},item.userData.importStatus="new-process-and-new-project",item.userData.importContinuation=makeContinuation(next),this.fireChange()}.bind(this),onConfirmExistingProcessAndNewProject:function(process,project,next){item.userData.importData={process:process,project:{Name:project.Name}},item.userData.importStatus="existing-process-and-new-project",item.userData.importContinuation=makeContinuation(next),this.fireChange()}.bind(this),onConfirmExistingProcessAndExistingProjects:function(process,projects,next){item.userData.importData={process:process,projects:projects},item.userData.importStatus="existing-process-and-existing-projects",item.userData.importContinuation=makeContinuation(next),this.fireChange()}.bind(this),onImportError:function(next){notify.error("We've had some problems during import, but view will be created anyway"),next()},onProgress:function(val){item.userData.isCreating=!0,item.userData.createProgress=val,dispatcher.fire("progress:update",val),this.fireChange()}.bind(this),onBeforeCreate:function(){this.deactivateApp(item)}.bind(this)}).then(function(){notify.success("View has been added to your Targetprocess account"),item.userData.importData=null,item.userData.importStatus=null,item.userData.importContinuation=null,this.fireChange()}.bind(this))},confirmImport:function(item,confirmData){confirmData?item.userData.importContinuation(confirmData.context,confirmData.customFields):"customfields"===item.userData.importState?item.userData.importContinuation(null,null):item.userData.importContinuation(),item.userData.importData=null,item.userData.importStatus=null,this.fireChange()},cancelImport:function(item){item.userData.importData=null,item.userData.importStatus=null,item.userData.importContinuation=null,this.fireChange()},deactivateApp:function(item){var time=400;item.userData.isSelected&&(item.userData.isSelected=!1,this.solutionStore.fireChange(),setTimeout(function(){dispatcher.fire("app:deactivate")},time))},setTmpTitle:function(item,title){item.userData.tmpTitle=title,this.fireChange()},reorder:function(from,to){if(this.isDragging){var item=this.items[from];this.items.splice(from,1),this.items.splice(to,0,item),this.draggingIndex=to,this.fireChange()}},prioritize:function(index){var item=this.items[index];this.items[index].userData.isDragging=!1,this.isDragging=!1;var priority,minPriority=0,maxPriority=9007199254740992,delta=1e6,prev=index?this.items[index-1]:null,next=this.items[index+1];next&&prev?priority=(next.priority+prev.priority)/2:next?priority=next.priority/1.5:prev&&(priority=prev.priority+delta),priority=Math.round(priority),minPriority>=priority||priority>=maxPriority||prev&&priority===prev.priority||next&&priority===next.priority?(this.items=this.items.map(function(v,k){return v.priority=(delta+1)*(k+1),v}),this.writePriorities()):(item.priority=priority,this.writeOne(item)),this.solution.views=this.items,this.fireChange()},startSort:function(index){var hasZero=_.find(this.items,function(v){return!v.objectId});return hasZero?!1:(this.items=this.items.map(function(v){return v.userData.isEditing=!1,v.userData.isSelected=!1,v.userData.isWaitingConfirmation=!1,v}),this.draggingIndex=index,this.items[index].userData.isDragging=!0,this.isDragging=!0,void this.fireChange())},writePriorities:function(){this.items.forEach(function(item){var obj=new View,writeItem={id:item.objectId,priority:item.priority};return obj.save(writeItem)})},getListItems:function(){var filterText=this.solutionStore.filterText.trim().toLowerCase(),items=_.reject(this.items,function(v){return!v.objectId&&!this.solution.objectId}.bind(this));return items=_.map(items,function(v){return v.userData.isMatchFilter=isMatchFilter(v,filterText),v}),"search"===this.scrollTo&&(items=items.map(function(v){return v.userData.isSelected=v.userData.isMatchFilter&&v.userData.isSelected,v})),items},selectTag:function(tag,item){item.userData.isSelected=!1,this.solutionStore.filter(tag)},scrolledTo:function(){this.scrollTo=!1,this.solution.userData.scrollTo=!1},getSolutions:function(){return this.solutionStore.getListItems()},selectSolution:function(id){this.solutionStore.selectById(id)},toggleShowImportRestrictions:function(item,val){item.userData.showImportRestrictions=val,this.fireChange()}});return Store.isMatchFilter=isMatchFilter,EventEmitter.implementOn(Store.prototype),module.exports=Store,module.exports}),define("ViewGallery/App",function(require,exports,module){"use strict";var React=require("react"),ReactCSSTransitionGroup=React.addons.CSSTransitionGroup,SolutionList=require("ViewGallery/SolutionList"),SolutionViewer=require("ViewGallery/SolutionViewer"),Overlay=require("ViewGallery/Overlay"),Flx=require("ViewGallery/Flx"),App=React.createClass({displayName:"App",mixins:[Flx.Mixin],render:function(){var overlay,store=this.props.store;if(store.isActive){var progress,solutionsStore=store.solutionsStore;store.progress!==!1&&(progress=React.DOM.div({className:"tau-loader"})),overlay=Overlay({scrollable:!1,onClose:this.handleClose},React.DOM.div({className:"vg"+(store.progress?" vg-loading":"")},SolutionList({store:solutionsStore}),React.DOM.div({className:"vg-right"},React.DOM.div({className:"vg-wrapper-scroll"},SolutionViewer({store:solutionsStore})))),progress)}return ReactCSSTransitionGroup({transitionName:"vg-overlay-animation"},overlay)},handleClose:function(){this.props.store.deactivate()}});return module.exports=App,module.exports}),define("ViewGallery/Button",function(require,exports,module){var React=require("react"),_=require("Underscore"),Button=React.createClass({displayName:"Button",getDefaultProps:function(){return{type:"button",className:"vg-btn",progress:0}},render:function(){var children=this.props.children,className=this.props.className;this.props.loaderActive&&this.props.loaderProgress>0&&this.props.loaderProgress<=100&&(children=[React.DOM.span({key:"progress",className:"vg-btn__progress",style:{width:this.props.loaderProgress+"%"}}),children],className+=" vg-btn-loader");var props=_.extend(this.props,{className:className,children:children});return React.addons.cloneWithProps(React.DOM.button(null),props)}});return module.exports=Button,module.exports}),define("ViewGallery/Confirmation",function(require,exports,module){var React=require("react"),Confirmation=React.createClass({displayName:"Confirmation",getDefaultProps:function(){return{orientation:"left",okLabel:"Yes, I'm sure",cancelLabel:"No"}},componentDidMount:function(){this.listener=function(e){this.getDOMNode().contains(e.target)||this.handleCancel(e)}.bind(this),document.addEventListener("click",this.listener,!0)},componentWillUnmount:function(){document.removeEventListener("click",this.listener,!0)},render:function(){return React.DOM.div({className:"tau-bubble tau-warning-bubble i-role-bubble i-state_visible vg-confirmation i-orientation_"+this.props.orientation+" "+(this.props.className||""),"data-orientation":this.props.orientation},React.DOM.div({className:"tau-bubble__arrow tau-container","data-orientation":this.props.orientation}),React.DOM.div({className:"tau-bubble__inner tau-container"},React.DOM.div(null,React.DOM.h3(null,this.props.children)),React.DOM.div({className:"tau-buttons"},React.DOM.button({type:"button",className:"tau-btn tau-primary i-role-actionok",onClick:this.handleConfirm},this.props.okLabel),React.DOM.button({type:"button",className:"tau-btn i-role-actioncancel",onClick:this.handleCancel},this.props.cancelLabel))))},handleConfirm:function(e){this.props.onConfirm(e)},handleCancel:function(e){this.props.onCancel(e)}});return module.exports=Confirmation,module.exports}),define("ViewGallery/ContextInput",function(require,exports,module){var ContextInputList,React=require("react"),cx=React.addons.classSet,$=require("jQuery"),_=require("Underscore"),restApi=require("ViewGallery/restApi"),mapRecursive=function(items,cb){return items.map(function(v){return v.items&&(v.items=mapRecursive(v.items,cb)),v=cb(v)})},isAllChecked=function(items){return items.length&&_.all(items,function(vv){return vv.userData.isChecked})},processChecked=function(items,values){return items.map(function(v){return v.userData=v.userData||{},v.items?(v.items=processChecked(v.items,values),v.userData.isChecked=isAllChecked(v.items)):v.userData.isChecked=_.isBoolean(values)?values:values[v.Id],v})},makeDisabled=function(items,isDisabled){return items.map(function(v){return v.userData=v.userData||{},v.items&&(v.items=makeDisabled(v.items,isDisabled)),v.userData.isDisabled=isDisabled,v})},sortChecked=function(items){return _.sortBy(items,function(v){if(null===v.Id)return-99;var isAnyChecked=Boolean(v.userData.isChecked||v.items&&_.any(items,function(vv){return vv.userData.isChecked})),x=-1*Number(isAnyChecked);return v.items&&(v.items=sortChecked(v.items)),x})},ContextInputRow=React.createClass({displayName:"ContextInputRow",render:function(){var v=this.props.item;if(v.userData.isRejected)return null;var className=cx({"vg-contextinput__rowinner":!0});return React.DOM.div({className:"vg-contextinput__row"},React.DOM.label({className:className},React.DOM.div({className:"vg-contextinput__inputholder"},React.DOM.span({className:"vg-contextinput__inputwrapper"+(v.Color?" vg-contextinput__inputwrapper-active":""),style:{backgroundColor:v.Color||null}},React.DOM.input({type:"checkbox",checked:v.userData.isChecked,disabled:v.userData.isDisabled,onChange:this.handleChange}))),React.DOM.div({className:"vg-contextinput__iconholder"},"Icon"in v?React.DOM.i({className:"tau-icon tau-icon_type_svg tau-icon_name_"+v.Icon,dangerouslySetInnerHTML:{__html:"&nbsp;"}}):null),React.DOM.div({className:"vg-contextinput__label"+(v.items?" vg-contextinput__label-category":"")},React.DOM.span({className:"vg-contextinput__labeltext"},v.Name))),v.items?ContextInputList({ref:"list",items:v.items,onChange:this.handleChangeList}):null)},handleChange:function(){this.props.item.items&&(this.props.item.items=processChecked(this.props.item.items,!this.props.item.userData.isChecked)),this.props.onChange(this.props.item,!this.props.item.userData.isChecked)},handleChangeList:function(items){this.props.onChange(this.props.item,isAllChecked(items))}});ContextInputList=React.createClass({displayName:"ContextInputList",render:function(){var items=this.props.items;return React.DOM.div({className:"vg-contextinput__list"},items.map(function(v){return ContextInputRow({key:v.Id||"k00",item:v,onChange:this.handleChange})}.bind(this)))},handleChange:function(item,isChecked){item.userData.isChecked=isChecked,this.props.onChange(this.props.items)}});var ContextInputColumn=React.createClass({displayName:"ContextInputColumn",getInitialState:function(){var ids=_.pluck(this.props.defaultValue.items,"Id"),isAll=Boolean(this.props.defaultValue.all),values=_.object(this.props.items.map(function(v){return[v.Id,isAll?!0:ids.indexOf(v.Id)>=0]})),items=this.props.groupedItems||this.props.items;return items=processChecked(items,values),items=makeDisabled(items,this.props.disabled),items=sortChecked(items),{items:items,valueAll:isAllChecked(items)}},render:function(){var search=this.props.search,items=mapRecursive(this.state.items,function(v){return v.userData.isRejected=search&&v.Name.toLowerCase().indexOf(search)<0,v.items&&(v.userData.isRejected=v.userData.isRejected&&_.all(v.items,function(v){return v.userData.isRejected})),v}),isAllRejected=search&&_.all(items,function(v){return v.userData.isRejected}),allItem={Name:this.props.title,userData:{isChecked:this.state.valueAll,isDisabled:this.props.disabled}};return React.DOM.div({className:"vg-contextinput__col "+this.props.className},React.DOM.div({className:"vg-contextinput__list vg-contextinput__header"},ContextInputRow({item:allItem,onChange:this.handleChangeAll})),isAllRejected?React.DOM.div({className:"vg-contextinput__searchemptyresult"},this.props.searchEmptyResultPlaceholder):ContextInputList({ref:"list",items:items,onChange:this.handleChange}))},handleChange:function(items){this.setState({valueAll:isAllChecked(items),items:items})},handleChangeAll:function(){var val=!this.state.valueAll;this.setState({valueAll:val,items:processChecked(this.state.items,val)})},getValue:function(){var flattenItems=function(items){return items.reduce(function(res,v){return res=res.concat(v.items?flattenItems(v.items):v)},[])},items=flattenItems(this.state.items),all=this.state.valueAll,checked=_.filter(items,function(v){return v.userData.isChecked});return checked.length||(all=!0,checked=items),items=checked.map(function(v){return _.omit(v,"userData")}),{all:all,items:items}}}),ContextInput=React.createClass({displayName:"ContextInput",getInitialState:function(){return{isLoading:!0}},componentDidMount:function(){var loadProjects=restApi.load("projects",{include:restApi.wrapInclude(["Id","Name","Color","NumericPriority","IsActive",{Process:["Id"]},{Program:["Id","Name","NumericPriority"]}]),orderBy:"Name",where:'(IsActive eq "True")'}),loadTeams=restApi.load("teams",{include:restApi.wrapInclude(["Id","Name","Icon"])}).then(function(teams){var noTeam={Id:null,Name:"No team"};return[noTeam].concat(teams)});$.when(loadProjects,loadTeams).then(function(projects,teams){this.setState({projects:projects,teams:teams,isLoading:!1})}.bind(this))},render:function(){if(this.state.isLoading)return null;var groupedProjects=_.groupBy(this.state.projects,function(v){return v.Program?v.Program.Id:"none"});groupedProjects=(groupedProjects.none||[]).concat(_.reduce(groupedProjects,function(res,v,k){if("none"!==k){var prog=v[0].Program;prog.items=v,res=res.concat(prog)}return res},[])),groupedProjects=_.sortBy(groupedProjects,function(v){return v.Name.toLowerCase()});var teams=this.state.teams;_.all(teams,function(v){return!v.Icon})&&(teams=teams.map(function(v){return _.omit(v,"Icon")}));var showSearch=!this.props.disabled&&(this.state.projects.length>10||this.state.teams.length>10),className=cx({"vg-contextinput":!0,"disabled vg-contextinput-disabled":this.props.disabled});return React.DOM.div({className:className},showSearch?React.DOM.div({className:"vg-contextinput__search"},React.DOM.div({className:"tau-inline-group tau-search"},React.DOM.input({className:"tau-in-text",ref:"search",type:"text",placeholder:"Search",onChange:this.handleSearch}),React.DOM.button({type:"button",className:"tau-btn tau-search",onClick:this.handleSearch}))):null,React.DOM.div({className:"vg-contextinput__cols"},ContextInputColumn({ref:"projects",className:"vg-contextinput__col-projects",groupedItems:groupedProjects,items:this.state.projects,search:this.state.search,defaultValue:this.props.defaultValue.projects,searchEmptyResultPlaceholder:"No such project found",title:"Projects",disabled:this.props.disabled}),ContextInputColumn({ref:"teams",className:"vg-contextinput__col-teams",items:teams,search:this.state.search,defaultValue:this.props.defaultValue.teams,searchEmptyResultPlaceholder:"No such team found",title:"Teams",disabled:this.props.disabled})))},handleSearch:function(){var search=this.refs.search.getDOMNode().value.trim().toLowerCase();this.setState({search:search})},getValue:function(){return{projects:this.refs.projects.getValue(),teams:this.refs.teams.getValue()}}});return module.exports=ContextInput,module.exports}),define("ViewGallery/CustomFieldsEditor",function(require,exports,module){var React=require("react"),cx=React.addons.classSet,_=require("Underscore"),Flx=require("ViewGallery/Flx"),Store=Flx.createStore({load:function(items){this.items=items.map(function(v){return v=_.extend({},v),v.userData={isDisabled:this.isDisabled},v}.bind(this)),this.fireChange()},getValue:function(){return this.items.map(function(v){return _.omit(v,"userData")})},save:function(item,value){item.userData.tmpValue=null,item.Value=_.unique(_.filter(value.split(/\r?\n/).map(function(v){return v.trim()}),function(v){return v&&v.length})).join("\r\n"),this.fireChange()},focus:function(item){item.userData.isDisabled||(item.userData.isHover=!1,item.userData.isFocus=!0,this.fireChange())},blur:function(item){item.userData.isDisabled||(item.userData.isFocus=!1,this.fireChange())},hover:function(item){item.userData.isDisabled||item.userData.isFocus||(item.userData.isHover=!item.userData.isHover,this.fireChange())},saveTmpValue:function(item,value){item.userData.tmpValue=value,this.fireChange()}}),CustomFieldsEditorInput=React.createClass({displayName:"CustomFieldsEditorInput",render:function(){var item=this.props.item,className=cx({"vg-forminput":!0,"vg-customfieldseditor__input":!0,"vg-customfieldseditor__input-focus":item.userData.isFocus,"vg-customfieldseditor__input-hover":item.userData.isHover});return React.DOM.div({className:className},React.DOM.label(null,item.Name,React.DOM.div({className:"vg-customfieldseditor__inputwrapper"},item.userData.isHover?React.DOM.i({className:"vg-icon vg-icon-pencil"}):null,React.DOM.textarea({ref:"textarea",value:item.userData.tmpValue||item.Value,disabled:item.userData.isDisabled,onFocus:this.handleFocus,onBlur:this.handleBlur,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onChange:this.handleChange}))))},handleMouseEnter:function(){this.props.store.hover(this.props.item)},handleMouseLeave:function(){this.props.store.hover(this.props.item)},handleFocus:function(){this.props.store.focus(this.props.item)},handleBlur:function(){this.props.store.save(this.props.item,this.refs.textarea.getDOMNode().value),this.props.store.blur(this.props.item)},handleChange:function(){this.props.store.saveTmpValue(this.props.item,this.refs.textarea.getDOMNode().value)}}),CustomFieldsEditor=React.createClass({displayName:"CustomFieldsEditor",mixins:[Flx.Mixin],getInitialState:function(){return{store:new Store}},componentDidMount:function(){this.state.store.isDisabled=this.props.disabled,this.state.store.load(this.props.items)},render:function(){var cfs=this.state.store.items;if(!cfs)return null;var className=cx({"vg-customfieldseditor":!0,"disabled vg-customfieldseditor-disabled":this.state.store.isDisabled});return React.DOM.div({className:className},cfs.map(function(v,k){return CustomFieldsEditorInput({item:v,key:"k"+k,store:this.state.store})}.bind(this)))},getValue:function(){return this.state.store.getValue()}});return module.exports=CustomFieldsEditor,module.exports}),define("ViewGallery/CustomFieldsSelect",function(require,exports,module){var _=require("Underscore"),$=require("jQuery"),React=require("react"),store=require("ViewGallery/restApi"),CustomFieldsSelect=React.createClass({displayName:"CustomFieldsSelect",getInitialState:function(){return{items:[]}},componentDidMount:function(){store.load("Processes",{include:store.wrapInclude(["Name",{CustomFields:["Id","Name","Value","EntityFieldName","FieldType","EnabledForFilter","Required",{EntityType:["Id","Name"]},"Config"]}]),orderBy:"Name"}).then(function(items){var customFields=items.reduce(function(res,v){return res.concat(v.CustomFields)},[]),external=_.reject(this.props.defaultValue,function(cf1){return _.any(customFields,function(cf2){return cf1.Id===cf2.Id&&cf1.FieldType===cf2.FieldType})});if(external.length){var externalProcess={Id:"external",Name:"*External*",CustomFields:external};customFields=customFields.concat(external),items=[externalProcess].concat(items)}this.setState({items:items,customFields:customFields})}.bind(this))},render:function(){var processes=this.state.items;if(!processes.length)return null;var disabled=this.props.disabled,ids=_.pluck(this.props.defaultValue||[],"Id");if(!this.state.customFields.length)return null;var inner=_.filter(processes,function(v){return v.CustomFields.length}).map(function(process){var fields=process.CustomFields.map(function(cf,k){return React.DOM.div({className:"vg-customfieldselect__field",key:"cf"+k},React.DOM.label(null,React.DOM.input({type:"checkbox",value:cf.Id,key:"cf"+cf.Id,disabled:disabled,defaultChecked:ids.indexOf(cf.Id)>=0?!0:null}),cf.Name,React.DOM.span({className:"tau-entity-icon tau-entity-icon--"+cf.EntityType.Name.toLowerCase().replace(" ","")},cf.EntityType.Name)))});return React.DOM.div({className:"vg-customfieldselect__process",key:"pr"+process.Id},React.DOM.div({className:"vg-customfieldselect__processname"},process.Name),fields)});return this.transferPropsTo(React.DOM.div({className:"vg-customfieldselect"+(this.props.disabled?" disabled":"")},inner))},getValue:function(){var ids=$(this.getDOMNode()).find(":checked").toArray().map(function(v){return parseInt(v.value,10)}),fields=_.filter(this.state.customFields,function(v){return ids.indexOf(v.Id)>=0});return fields}});return module.exports=CustomFieldsSelect,module.exports}),define("ViewGallery/ExternalTrigger",function(require,exports,module){var React=require("react"),cx=React.addons.classSet,ExternalTrigger=React.createClass({displayName:"ExternalTrigger",componentDidMount:function(){this.listener=function(){this.forceUpdate()}.bind(this),this.props.store.on("change",this.listener)},componentWillUnmount:function(){this.props.store.removeListener("change",this.listener)},render:function(){var isActive=this.props.store.isActive,className=cx({"t3-view t3-grid vg-externaltrigger":!0,"vg-externaltrigger-disabled":!isActive});return React.DOM.div({className:className},React.DOM.div({className:"t3-header",onClick:this.handleClick},React.DOM.i({className:"vg-icon vg-icon-gallery"}),React.DOM.div({className:"t3-name vg-externaltrigger__name"},this.props.children||"Browse Solutions Gallery")))},handleClick:function(){this.props.store.activate()}});return module.exports=ExternalTrigger,module.exports}),define("ViewGallery/FeedbackForm",function(require,exports,module){var React=require("react"),Overlay=require("ViewGallery/Overlay"),FeedbackForm=React.createClass({displayName:"FeedbackForm",render:function(){var inner;return inner="success"===this.props.store.feedbackStatus?React.DOM.div({className:"vg-feedback__innersuccess"},React.DOM.h1(null,"Thanks!"),React.DOM.p(null,"We'll be in touch shortly."),React.DOM.a({className:"vg-feedback__close",onClick:this.handleCancel},"Close this window")):React.DOM.div(null,React.DOM.h1(null,"Can't find the view you need?"),React.DOM.p(null,"Just let us know! We'll be happy to help create it, so it can be added in one click."),React.DOM.form({onSubmit:this.handleSubmit},React.DOM.div({className:"vg-forminput"},React.DOM.textarea({ref:"message",autoFocus:!0,placeholder:""})),React.DOM.div({className:"vg-buttons"},React.DOM.button({className:"vg-btn vg-btn-success",type:"submit"},"Send"),React.DOM.a({className:"vg-cancellink",onClick:this.handleCancel},"Cancel")))),Overlay({onClose:this.handleClose,scrollable:!1},React.DOM.div({className:"vg-feedback"},inner))},handleClose:function(){this.props.store.cancelFeedback()},handleCancel:function(){this.props.store.cancelFeedback()},handleSubmit:function(e){e.preventDefault();var value=this.refs.message.getDOMNode().value;this.props.store.submitFeedback(value)}});return module.exports=FeedbackForm,module.exports}),define("ViewGallery/FileInput",function(require,exports,module){var React=require("react"),cx=React.addons.classSet,resize=function(file,width,height,isFixed){var fileType=file.type,reader=new FileReader,defer=$.Deferred();return reader.onloadend=function(){var image=new Image;image.src=reader.result;var ratio=2,canvas=document.createElement("canvas");image.onload=function(){var ctx,maxWidth=width,maxHeight=height,imageWidth=image.width,imageHeight=image.height;isFixed?(imageWidth>imageHeight?imageWidth>maxWidth&&(imageHeight*=maxWidth/imageWidth,imageWidth=maxWidth):imageHeight>maxHeight&&(imageWidth*=maxHeight/imageHeight,imageHeight=maxHeight),ctx=canvas.getContext("2d"),canvas.width=maxWidth*ratio,canvas.height=maxHeight*ratio,ratio>1&&ctx.scale(ratio,ratio),ctx.drawImage(this,-(maxWidth-imageWidth)/2,-(imageHeight-maxHeight)/2,imageWidth,imageHeight)):(ratio=1,ctx=canvas.getContext("2d"),canvas.width=imageWidth*ratio,canvas.height=imageHeight*ratio,ratio>1&&ctx.scale(ratio,ratio),ctx.drawImage(this,0,0,imageWidth,imageHeight));var finalFile=canvas.toDataURL(fileType);return defer.resolve({file:file,resizeData:finalFile})}},reader.readAsDataURL(file),defer},FileInput=React.createClass({displayName:"FileInput",getInitialState:function(){return{value:this.props.defaultValue,preview:this.props.defaultValue,clearValue:null}},render:function(){var preview;this.state.preview&&(preview=React.DOM.img({src:this.state.preview}));var buttons,className=cx({"vg-fileinput":!0,"vg-fileinput-fit":this.props.fitImage}),addButton=React.DOM.button({type:"button",className:"vg-btn"},this.props.children);return buttons=this.state.preview&&this.props.allowRemove?React.DOM.div({className:"vg-btn-group"},addButton,React.DOM.button({type:"button",className:"vg-btn",onClick:this.handleClear},React.DOM.i({className:"vg-icon vg-icon-bin"}))):addButton,React.DOM.div({className:className,onClick:this.handleClick},preview,React.DOM.div({className:"vg-buttonholder"},buttons),React.DOM.input({type:"file",ref:"input",accept:"image/*",hidden:!0,onChange:this.handleChange}))},handleClick:function(){$(this.refs.input.getDOMNode()).trigger("click")},handleClear:function(e){e.preventDefault(),e.stopPropagation(),this.setState({value:null,preview:null,clearValue:!0},function(){this.props.onChange&&this.props.onChange(null)}.bind(this))},handleChange:function(){$.when(this.getFile()).then(function(res){this.setState({value:res,preview:res?res.resizeData:null,clearValue:!1},function(){this.props.onChange&&this.props.onChange(res)}.bind(this))}.bind(this))},getFile:function(){var input=this.refs.input.getDOMNode();if(input.files&&input.files[0]){var file=input.files[0];return resize(file,this.props.width,this.props.height,this.props.fitImage)}return null},getValue:function(){return{file:this.state.value,isClear:this.state.clearValue}}});return module.exports=FileInput,module.exports}),define("ViewGallery/FileInputMultiple",function(require,exports,module){var $=require("jQuery"),React=require("react"),Flx=require("ViewGallery/Flx"),FileInputMultipleIndicator=require("ViewGallery/FileInputMultipleIndicator"),FileInputMultipleItem=require("ViewGallery/FileInputMultipleItem"),FileInputMultiple=React.createClass({displayName:"FileInputMultiple",mixins:[Flx.Mixin],componentDidUpdate:function(){var $inner=$(this.refs.inner.getDOMNode());$inner.animate({scrollLeft:this.props.store.activeIndex*$inner[0].getBoundingClientRect().width})},render:function(){var store=this.props.store;if(!store)return null;var indicators,items=this.props.store.items,imgs=items.map(function(v,k){return React.DOM.div({className:"vg-carousel__item",key:v.id||"zero"+k},FileInputMultipleItem({item:v,store:store}))}.bind(this)),indicatorItems=items.map(function(v,k){return FileInputMultipleIndicator({item:v,store:store,key:v.id||"zero"+k,index:k,draggingIndex:store.draggingIndex,sort:this.handleSort,sortStarted:this.handleSortStarted,sortCompleted:this.handleSortCompleted})}.bind(this));return indicators=React.DOM.div({className:"vg-carousel__indicators",onDrop:this.handleDrop},indicatorItems),React.DOM.div({className:"vg-carousel vg-carousel-input"},React.DOM.div({className:"vg-carousel__inner",ref:"inner"},imgs),indicators)},handleSort:function(from,to){this.props.store.reorder(from,to)},handleSortStarted:function(index){this.props.store.startSort(index)},handleSortCompleted:function(){},handleDrop:function(e){e.preventDefault(),e.stopPropagation()},getValue:function(){return this.props.store.getValue()}});return module.exports=FileInputMultiple,module.exports}),define("ViewGallery/FileInputMultipleIndicator",function(require,exports,module){var React=require("react"),cx=React.addons.classSet,SortableMixin=require("ViewGallery/SortableMixin"),FileInputMultipleIndicator=React.createClass({displayName:"FileInputMultipleIndicator",mixins:[SortableMixin],render:function(){var item=this.props.item;if(!item.id)return React.DOM.div({className:"vg-carousel__indicator vg-carousel__indicator-add",onClick:this.handleStartAdd,draggable:!1,"data-index":null},React.DOM.i({className:"vg-icon vg-icon-plus"}));var className=cx({"vg-carousel__indicator":!0,"vg-carousel__indicator-active":item.userData.isSelected});return React.DOM.div({className:className,onClick:this.handleClick,draggable:!0,"data-index":this.props.index,onDragStart:this.handleDragStart,onDragEnd:this.handleDragEnd,onDragOver:this.handleDragOver},React.DOM.img({src:item.file}))},handleClick:function(){this.props.store.select(this.props.item)},handleStartAdd:function(){this.props.store.select(this.props.item)}});return module.exports=FileInputMultipleIndicator,module.exports}),define("ViewGallery/FileInputMultipleItem",function(require,exports,module){var React=require("react"),FileInput=require("ViewGallery/FileInput"),FileInputMultipleItem=React.createClass({displayName:"FileInputMultipleItem",render:function(){var item=this.props.item;return FileInput({width:892,height:524,defaultValue:item.file,onChange:this.handleChange,allowRemove:!0},"Load screenshot (892×524)")},handleChange:function(val){val?this.props.store.update(this.props.item,val):this.props.store.remove(this.props.item)}});return module.exports=FileInputMultipleItem,module.exports}),define("ViewGallery/ImportButton",function(require,exports,module){var React=require("react"),ReactCSSTransitionGroup=React.addons.CSSTransitionGroup,$=require("jQuery"),_=require("Underscore"),ImportTooltip=require("ViewGallery/ImportTooltip"),ImportWizard=require("ViewGallery/ImportWizard"),Tooltip=require("ViewGallery/Tooltip"),Button=require("ViewGallery/Button"),boardCreator=require("ViewGallery/boardCreator"),ImportButtom=React.createClass({displayName:"ImportButtom",loadData:function(){var item=this.props.item,type=this.props.type;return $.when("solution"===type?boardCreator.getSolutionImportRestrictions(item):boardCreator.getViewImportRestrictions(item,this.props.store.solution)).then(function(code){item.userData.importRestrictions=code,this.forceUpdate()}.bind(this))},componentDidMount:function(){this.loadData()},componentDidUpdate:function(prevProps){prevProps.item.objectId===this.props.item.objectId&&this.props.item.userData.importRestrictions||this.loadData()},render:function(){var importWizard,item=this.props.item,importRestrictions=item.userData.importRestrictions,type=this.props.type;
item.userData.importStatus&&(importWizard=ImportWizard({item:item,store:this.props.store,type:type,onConfirm:this.props.onConfirm,onCancel:this.props.onCancel}));var importRestrictionsTooltip;if(item.userData.showImportRestrictions&&!item.userData.importStatus)if(importRestrictions&&importRestrictions.code&&importRestrictions.disabled)importRestrictionsTooltip=ImportTooltip({item:item});else if("view"===type)importRestrictionsTooltip=Tooltip({orientation:"top",className:"vg-importbubble vg-importbubble-info"},"A new private view will be created in your Targetprocess account.");else if("solution"===type){var count=_.filter(item.views,function(v){return v.objectId}).length;importRestrictionsTooltip=Tooltip({orientation:"top",className:"vg-importbubble vg-importbubble-info"},"A private folder with ",count," ",1===count?"view":"views"," ","will be created in your Targetprocess account.")}var isDisabledButton=importRestrictions&&importRestrictions.disabled;return React.DOM.div({className:"vg-importbuttonwrapper"},Button({onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,loaderActive:item.userData.isCreating,loaderProgress:item.userData.createProgress,className:"vg-btn vg-btn-success vg-importbutton"+(isDisabledButton?" disabled":""),onClick:isDisabledButton?null:this.props.onClick},this.props.children),importRestrictionsTooltip,ReactCSSTransitionGroup({transitionName:"vg-overlay-animation",scrollable:!0},importWizard))},handleMouseEnter:function(){this.props.store.toggleShowImportRestrictions(this.props.item,!0)},handleMouseLeave:function(){this.props.store.toggleShowImportRestrictions(this.props.item,!1)}});return module.exports=ImportButtom,module.exports}),define("ViewGallery/ImportTooltip",function(require,exports,module){var React=require("react"),_=require("Underscore"),Tooltip=require("ViewGallery/Tooltip"),Join=require("ViewGallery/Join"),ImportTooltip=React.createClass({displayName:"ImportTooltip",render:function(){var item=this.props.item,importRestrictions=item.userData.importRestrictions,isSolution=Boolean(item.views),type=isSolution?"solution":"view",message={"no-process":function(){var processName=importRestrictions.process.Name;return React.DOM.span(null,"The process ",Join({list:processName})," and a project, related to this process,"," ","must exist in your system in order to use this ",type,". Please contact your administrator."," ","Additional details are available from the ",type," prerequisites.")},"no-any-process":function(){return React.DOM.span(null,"There is no any process with at least one available project now."," ","Please contact your administrator"," ","or create project yourself."," ","Additional details are available from the ",type," prerequisites.")},"no-project":function(){var processName=importRestrictions.process.Name;return React.DOM.span(null,"The process ",Join({list:processName})," and a project, related to this process,"," ","must exist in your system in order to use this ",type,". Please contact your administrator."," ","Additional details are available from the ",type," prerequisites.")},"no-customfields":function(){var names=_.pluck(importRestrictions.views,"title"),cfNames=_.pluck(importRestrictions.customFields,"Name"),isSingle=1===names.length,typeName=isSingle?"view":"views",isCfSingle=1===_.unique(cfNames).length,cfName=isCfSingle?"field":"fields";return"solution"===type&&names.length?React.DOM.span(null,Join({list:cfNames})," ",isCfSingle?"is a":"are"," ","required custom ",cfName," for the"," ",Join({list:names})," ",typeName,"."," ","Please contact your administrator"," ","or install the solution without ",isSingle?"this":"these"," ",typeName,"."," ","Additional details are available from the ",type," prerequisites."):React.DOM.span(null,Join({list:cfNames})," ",isCfSingle?"is a":"are"," ","required custom ",cfName," for this ",type,"."," ","Please contact your administrator."," ","Additional details are available from the ",type," prerequisites.")}}[importRestrictions.code]();return Tooltip({orientation:"top",className:"vg-importbubble vg-importbubble-restrictions"},message)}});return module.exports=ImportTooltip,module.exports}),define("ViewGallery/ImportWizard",function(require,exports,module){var React=require("react"),_=require("Underscore"),configurator=require("tau/configurator"),Overlay=require("ViewGallery/Overlay"),Join=require("ViewGallery/Join"),ContextInput=require("ViewGallery/ContextInput"),CustomFieldsEditor=require("ViewGallery/CustomFieldsEditor"),Button=require("ViewGallery/Button"),boardCreator=require("ViewGallery/boardCreator"),StickyHeaderMixin=require("ViewGallery/StickyHeaderMixin"),ImportWizard=React.createClass({displayName:"ImportWizard",mixins:[StickyHeaderMixin],render:function(){var type=this.props.type,item=this.props.item,importRequired="solution"===type?boardCreator.getSolutionFullImportData(item):boardCreator.getViewFullImportData(item,this.props.store.solution);importRequired=importRequired||{};var contextMessage,customFieldsMessage,contextInput,customFieldsEditor,isAdministrator=configurator.getLoggedUser().isAdministrator,importData=item.userData.importData,customFieldsValue=importData.customFields;if(importRequired.process){var projects;if(isAdministrator){if("new-process-and-new-project"===item.userData.importStatus)contextMessage=React.DOM.span(null,"A new process ",Join(null,importData.process.Name)," ","and a new project ",Join(null,importData.project.Name)," ","will be created in your account to make this ",type," working."," ","Additional details are available from the ",type," prerequisites.");else if("existing-process-and-existing-projects"===item.userData.importStatus)projects=_.pluck(item.userData.importData.projects,"Name"),contextMessage=React.DOM.span(null,"The process ",Join(null,item.userData.importData.process.Name)," ",projects.length?"and the "+(1===projects.length?"project":"projects"):""," ",Join({list:projects})," ","will be used for this ",type,"."," ","Additional details are available from the ",type," prerequisites.");else if("existing-process-and-new-project"===item.userData.importStatus){var projectName=item.userData.importData.project.Name;contextMessage=React.DOM.span(null,"The process ",Join({list:item.userData.importData.process.Name})," ","will be in use and a new project"," ",Join({list:projectName})," ","will be created in your account to make this ",type," working."," ","Additional details are available from the ",type," prerequisites.")}}else"existing-process-and-existing-projects"===item.userData.importStatus?(projects=_.pluck(item.userData.importData.projects,"Name"),contextMessage=React.DOM.span(null,"The process ",Join(null,item.userData.importData.process.Name)," ",projects.length?"and the "+(1===projects.length?"project":"projects"):""," ",Join({list:projects})," ","will be used for this ",type,"."," ")):contextMessage=React.DOM.span(null,"The process ",Join(null,importData.process.Name)," ","and a project, related to this process"," ","must exist in your system in order to use this ",type,"."," ","Please contact your administrator."," ","Additional details are available from the ",type," prerequisites.")}else if(importRequired.customFields){var contextValue={projects:{all:importRequired.forceProcesses,items:importData.projects},teams:{all:importRequired.forceProcesses||importData.projects.length&&!importData.teams.length,items:importData.teams}},names=Join({list:_.pluck(importRequired.customFields,"Name")}),cfLength=_.unique(importRequired.customFields,function(v){return v.Name}).length;if(isAdministrator)importData.projects.length?(customFieldsMessage=React.DOM.span(null,"Custom ",1===cfLength?"field":"fields"," ",names," will be used for the ",type,"."),contextInput=ContextInput({ref:"context",defaultValue:contextValue,disabled:!0}),customFieldsEditor=CustomFieldsEditor({ref:"customFields",items:customFieldsValue,disabled:!0})):(customFieldsMessage=React.DOM.span(null,"Custom ",1===cfLength?"field":"fields"," ",names," will be created in your account."),contextInput=ContextInput({ref:"context",defaultValue:contextValue,disabled:importRequired.forceProcesses}),customFieldsEditor=CustomFieldsEditor({ref:"customFields",items:customFieldsValue}));else if(importData.projects.length)customFieldsMessage=React.DOM.span(null,"Custom ",1===cfLength?"field":"fields"," ",names," ","will be used for the ",type,"."," "),contextInput=ContextInput({ref:"context",defaultValue:contextValue,disabled:!0}),customFieldsEditor=CustomFieldsEditor({ref:"customFields",items:customFieldsValue,disabled:!0});else{var importRestrictions=item.userData.importRestrictions,viewNames=Join({list:_.pluck(importRestrictions.views,"title")});customFieldsMessage="view"===type?React.DOM.span(null,names," ",1===cfLength?"is a":"are"," required custom "," ",1===cfLength?"field":"fields","  for this ",type,"."," ","Please contact your administrator."," ","Additional details are available from the ",type," prerequisites."):React.DOM.span(null,names," ",1===cfLength?"is a":"are"," required custom "," ",1===cfLength?"field":"fields","  for"," ",1===importRestrictions.views.length?"view":"views"," ",viewNames,"."," ","Please contact your administrator  or install the solution without"," ",1===importRestrictions.views.length?"this view":"these views","."," ","Additional details are available from the ",type," prerequisites.")}}else if("context"===item.userData.importStatus){var val={projects:{items:importData.projects},teams:{items:importData.teams}};contextInput=ContextInput({ref:"context",defaultValue:val,disabled:importRequired.forceProcesses})}var context;context=contextInput?React.DOM.div({className:"vg-importwizard__section vg-importwizard__section-context"},React.DOM.div({className:"vg-importwizard__message"},contextMessage," ","The ",type," will be created for the selected below teams and projects."),contextInput):React.DOM.div(null,contextMessage);var customFields;return customFields=customFieldsEditor?React.DOM.div({className:"vg-importwizard__section vg-importwizard__section-cfs"},React.DOM.div({className:"vg-importwizard__message"},customFieldsMessage," ","The following values will be used in the custom fields."),customFieldsEditor):React.DOM.div(null,customFieldsMessage),Overlay({onClose:this.props.onCancel,className:"vg-overlay-importwizard"},React.DOM.div({ref:"header",className:"vg-viewer__header vg-viewer__header-import vg-viewer__header-sticky"},React.DOM.h2(null,item.title),React.DOM.div({className:"vg-viewer__tools"},Button({className:"vg-btn vg-btn-ghost vg-btn-cancel",onClick:this.handleCancel},"Cancel"),Button({className:"vg-btn vg-btn-success",onClick:this.handleConfirm},"Continue"))),React.DOM.div({ref:"inner",className:"vg-viewlist__itemfull vg-viewlist__itemfull-overlay vg-viewer vg-importwizard"},context,customFields))},handleConfirm:function(){this.refs.context?this.props.onConfirm({context:this.refs.context.getValue(),customFields:this.refs.customFields?this.refs.customFields.getValue():[]}):this.props.onConfirm()},handleCancel:function(){this.props.onCancel()}});return module.exports=ImportWizard,module.exports}),define("ViewGallery/Join",function(require,exports,module){var React=require("react"),_=require("Underscore"),Join=React.createClass({displayName:"Join",render:function(){var res;if(this.props.list){var arr=_.isArray(this.props.list)?this.props.list:[this.props.list];arr=_.uniq(arr);var len=arr.length;res=arr.map(function(v,k){return React.DOM.span({key:"j"+k},React.DOM.em(null,v),k===len-1?"":k===len-2?" and ":", ")})}else res=React.DOM.em(null,this.props.children);return React.DOM.span(null,res)}});return module.exports=Join,module.exports}),define("ViewGallery/MarkdownOutput",function(require,exports,module){var React=require("react"),$=require("jQuery"),setTargets=function(node){$(node).find("a").each(function(k,v){$(v).attr("target","_blank")})},MarkdownOutput=React.createClass({displayName:"MarkdownOutput",componentDidMount:function(){setTargets(this.getDOMNode())},componentDidUpdate:function(){setTargets(this.getDOMNode())},render:function(){return this.props.html?React.DOM.div({className:"vg-markdown",dangerouslySetInnerHTML:{__html:this.props.html}}):React.DOM.div({className:"vg-markdown"},this.props.children)}});return module.exports=MarkdownOutput,module.exports}),define("ViewGallery/MarkdownTextarea",function(require,exports,module){var React=require("react"),markdown=require("ViewGallery/markdown"),MarkdownTextarea=React.createClass({displayName:"MarkdownTextarea",getInitialState:function(){return{preview:!1,value:this.props.defaultValue}},render:function(){var preview;this.state.preview&&(preview=React.DOM.div({className:"vg-markdown",dangerouslySetInnerHTML:{__html:markdown.toHtml(this.state.value)}}));var style={display:this.state.preview?"none":""},textarea=React.addons.cloneWithProps(React.DOM.textarea({onChange:this.handleChange,style:style,value:this.state.value}),this.props);return React.DOM.div({className:"vg-markdown-textarea"},React.DOM.a({className:"vg-markdown-textarea__trigger",onClick:this.handleTogglePreview},this.state.preview?"Edit":"Preview"),preview,textarea)},handleChange:function(e){this.setState({value:e.target.value})},handleTogglePreview:function(){this.setState({preview:!this.state.preview})},getValue:function(){return this.state.value||""}});return module.exports=MarkdownTextarea,module.exports}),define("ViewGallery/Overlay",function(require,exports,module){var React=require("react"),cx=React.addons.classSet,Overlay=React.createClass({displayName:"Overlay",getDefaultProps:function(){return{scrollable:!0,stretch:!0}},render:function(){var contentClassName={"vg-overlay__content":!0,"vg-overlay__content-scrollable":this.props.scrollable,"vg-overlay__content-nonscrollable":!this.props.scrollable};return this.props.className&&(contentClassName[this.props.className+"__content"]=!0),contentClassName=cx(contentClassName),React.DOM.div({className:"vg-overlay "+(this.props.className||""),onClick:this.handleClose},React.DOM.div({className:"vg-overlay__inner",ref:"inner",onClick:this.handleClose},React.DOM.i({className:"vg-icon vg-icon-close vg-overlay__close",onClick:this.handleCloseByIcon,title:"Close"}),React.DOM.div({className:"vg-overlay__scroll"},React.DOM.div({ref:"content",onClick:this.props.stretch?null:this.handleClose,className:contentClassName},this.props.children))))},handleClose:function(e){(e.target===this.getDOMNode()||e.target===this.refs.inner.getDOMNode()||!this.props.stretch&&e.target===this.refs.content.getDOMNode())&&(e.stopPropagation(),this.props.onClose())},handleCloseByIcon:function(){this.props.onClose()}});return module.exports=Overlay,module.exports}),define("ViewGallery/Prerequisites",function(require,exports,module){var React=require("react"),_=require("Underscore"),Join=require("ViewGallery/Join"),MarkdownOutput=require("ViewGallery/MarkdownOutput"),Prerequisites=React.createClass({displayName:"Prerequisites",render:function(){var genHeader,genText,item=this.props.item,type=this.props.type,imported=item.userData.fullPrerequisitesData;if(imported&&imported.customFields&&imported.customFields.length){var cfs=_.pluck(imported.customFields,"Name"),isSingle=1===_.unique(cfs).length;genHeader=React.DOM.h3(null,"The custom ",isSingle?"field":"fields"," ",Join({list:cfs})," ",isSingle?"is":"are"," required for this ",type,"."," "),genText=React.DOM.ul(null,React.DOM.li(null,isSingle?"If a custom field with the same name and type exists in your account then the existing custom field will be used for this "+type+".":"If there are custom fields with the same name and type in your account, then the existing custom fields will be used for this "+type+"."),React.DOM.li(null,isSingle?"If the custom field does not exist in your account, then a new custom field will be created for the projects that are selected when the "+type+" is added.":" If the custom fields do not exist in your account, then new custom fields will be created for the projects that are selected when the "+type+" is added."))}if(imported&&imported.process){var processName=imported.process.Name;genHeader=React.DOM.h3(null,"The ",Join({list:processName})," process and a project, related to"," ","this process, are required for this ",type,"."," "),genText=React.DOM.ul({key:"list"},React.DOM.li(null,"If the ",Join({list:processName})," process already exists in your account,"," ","then the existing process and the projects related to it will be"," ","used for this ",type,"."),React.DOM.li(null,"If the ",Join({list:processName})," process exists,"," ","but there are no related projects,"," ","then a new project ",Join({list:processName})," will be created in your account."),React.DOM.li(null,"If the ",Join({list:processName})," process does not exist,"," ","a new process ",Join({list:processName})," and a related "," ",Join({list:processName})," project will be created in your account."))}return React.DOM.div({className:"vg-viewer__prerequisites"},React.DOM.div({className:"vg-viewer__prerequisitesinner"},MarkdownOutput(null,genHeader,genText),MarkdownOutput({html:item.prerequisitesHtml})))}});return module.exports=Prerequisites,module.exports}),define("ViewGallery/ProcessSelect",function(require,exports,module){var React=require("react"),_=require("Underscore"),store=require("ViewGallery/restApi"),configurator=require("tau/configurator"),hasTerms=Boolean(configurator.getStore().typeMetaInfo("process").refs.terms),ProcessSelect=React.createClass({displayName:"ProcessSelect",getInitialState:function(){return{items:[]}},componentDidMount:function(){hasTerms?store.load("Processes",{include:store.wrapInclude(["Id","Name"]),take:999,orderBy:"Name"}).then(function(items){this.setState({items:items})}.bind(this)):store.load("Processes",{include:store.wrapInclude(["Id","Name","Projects"]),take:999,orderBy:"Name"}).then(function(items){items=_.filter(items,function(v){return v.Projects.length>0}),this.setState({items:items})}.bind(this))},render:function(){if(!this.state.items.length)return React.DOM.select({key:"notloaded"});var externalSelected,inner=this.state.items.map(function(v){return React.DOM.option({key:v.Id,value:v.Id},v.Name)});return this.state.items.length&&this.props.process&&_.pluck(this.state.items,"Id").indexOf(Number(this.props.defaultValue))<0&&(externalSelected=React.DOM.option({value:this.props.defaultValue},this.props.process.Name," (external)")),this.transferPropsTo(React.DOM.select(null,React.DOM.option({value:"",key:"0"},"No process"),externalSelected,inner))}});return module.exports=ProcessSelect,module.exports}),define("ViewGallery/SearchInput",function(require,exports,module){var React=require("react"),cx=React.addons.classSet,SearchInput=React.createClass({displayName:"SearchInput",render:function(){var store=this.props.store,className=cx({"vg-forminput":!0,"vg-searchinput":!0,"vg-searchinput-value":Boolean(store.filterText)});return React.DOM.div({className:className},React.DOM.span({className:"vg-searchinput__tool vg-searchinput__loop",onClick:this.handleFocus,title:"Search"},React.DOM.i({className:"vg-icon vg-icon-loop"})),React.DOM.input({type:"text",className:"vg-searchinput__input",onChange:this.handleFilter,value:store.filterText,ref:"input",title:"Search"}),React.DOM.span({className:"vg-searchinput__tool vg-searchinput__reset",onClick:this.handleReset,title:"Clear"},React.DOM.i({className:"vg-icon vg-icon-close-sm"})))},handleFilter:function(e){this.props.store.filter(e.target.value)},handleReset:function(){this.props.store.filter(""),this.refs.input.getDOMNode().focus()},handleFocus:function(){this.refs.input.getDOMNode().focus()}});return module.exports=SearchInput,module.exports}),define("ViewGallery/SolutionGroup",function(require,exports,module){var React=require("react"),cx=React.addons.classSet,Flx=require("ViewGallery/Flx"),SolutionItem=require("ViewGallery/SolutionItem"),SolutionGroup=React.createClass({displayName:"SolutionGroup",mixins:[Flx.Mixin],render:function(){var store=this.props.store,items=store.getListItems(),draggingIndex=store.draggingIndex,permissions=store.permissions,className=cx({"vg-list__group":!0,"vg-list__group-dragging":store.isDragging}),solutionStore=this.props.solutionStore;return React.DOM.div({className:className},React.DOM.div({className:"vg-list__groupheader"},permissions.collapse?React.DOM.h1({className:"vg-list__collapsetrigger",onClick:this.handleCollapse},store.title):React.DOM.h1(null,store.title),permissions.add?React.DOM.i({className:"vg-icon vg-icon-plus",onClick:this.handleStartAdd,title:"Add Solution"}):null),store.isCollapsed?null:items.map(function(v,k){return SolutionItem({key:v.objectId,item:v,store:solutionStore,index:k,draggingIndex:draggingIndex,sort:this.handleSort,sortStarted:this.handleSortStarted,sortCompleted:this.handleSortCompleted})}.bind(this)))},handleSort:function(from,to){this.props.store.reorder(from,to)},handleSortStarted:function(index){this.props.store.startSort(index)},handleSortCompleted:function(index){this.props.store.prioritize(index)},handleStartAdd:function(){this.props.solutionStore.startAdd()},handleCollapse:function(){this.props.store.toggleCollapse()}});return module.exports=SolutionGroup,module.exports}),define("ViewGallery/SolutionItem",function(require,exports,module){var React=require("react"),cx=React.addons.classSet,Confirmation=require("ViewGallery/Confirmation"),SortableMixin=require("ViewGallery/SortableMixin"),SolutionItem=React.createClass({displayName:"SolutionItem",mixins:[SortableMixin],render:function(){var inner,confirmation,item=this.props.item,permissions=this.props.store.permissions;if(item.userData.isWaitingConfirmation&&(confirmation=Confirmation({orientation:"top",onConfirm:this.handleConfirmRemove,onCancel:this.handleCancelRemove},"Do you really want to remove this Solution?")),item.userData.isEditing)inner=React.DOM.form({onSubmit:this.handleSubmit},React.DOM.input({type:"text",ref:"input",defaultValue:item.title,placeholder:"Name",autoFocus:!0,maxLength:"50",onChange:this.handleChangeTitle,onBlur:this.handleCancel}));else{var hosts;if(permissions.edit){var str=item.hosts.join(", ");str&&(hosts=React.DOM.div({className:"vg-list__itemhost"},str))}inner=React.DOM.a({className:"vg-list__iteminner"},React.DOM.div({className:"vg-list__itemname",onClick:this.handleSelect},React.DOM.div({className:"vg-list__itemtitle",onDoubleClick:this.handleStartEdit},item.userData.isEditingFull?item.userData.tmpTitle||item.title:item.title),hosts),permissions.remove?React.DOM.i({className:"vg-icon vg-icon-bin",onClick:this.handleRemove,title:"Remove"}):null,confirmation)}var className=cx({"vg-list__item":!0,"vg-list__item-hidden":item.isHidden,"vg-list__item-selected":item.userData.isSelected,"vg-list__item-hover":item.userData.isWaitingConfirmation,"vg-list__item-dragging":item.userData.isDragging,"vg-list__item-isnotmatching":!item.userData.isMatchFilter}),isDraggable=!this.props.item.userData.isEditing&&permissions.edit;return React.DOM.div({className:className,draggable:isDraggable||null,"data-index":this.props.index,onDragStart:this.handleDragStart,onDragEnd:this.handleDragEnd,onDragOver:this.handleDragOver},inner)},handleSelect:function(){this.props.store.select(this.props.item)},handleStartEdit:function(){this.props.store.startEdit(this.props.item)},handleSubmit:function(e){e.preventDefault(),this.props.store.save(this.props.item,this.refs.input.getDOMNode().value)},handleCancel:function(){this.props.store.cancelEdit(this.props.item)},handleRemove:function(){this.props.store.startRemove(this.props.item)},handleConfirmRemove:function(){this.props.store.remove(this.props.item)},handleCancelRemove:function(){this.props.store.cancelRemove(this.props.item)},handleChangeTitle:function(e){var item=this.props.item;this.props.store.setTmpTitle(item,e.target.value)}});return module.exports=SolutionItem,module.exports}),define("ViewGallery/SolutionList",function(require,exports,module){var React=require("react"),Flx=require("ViewGallery/Flx"),SolutionGroup=require("ViewGallery/SolutionGroup"),Store=require("ViewGallery/solutionsGroupStore"),SearchInput=require("ViewGallery/SearchInput"),SolutionList=React.createClass({displayName:"SolutionList",mixins:[Flx.Mixin],render:function(){var store=this.props.store,items=store.getListItems();if(store.isLoading)return React.DOM.div({className:"tau-loader"});var groups=items.map(function(v){return SolutionGroup({key:v.host||"main",store:new Store(store,v),solutionStore:store})});return React.DOM.div({className:"vg-list"},React.DOM.div({className:"vg-list__search"},React.DOM.form({onSubmit:this.handleSubmitFilter},SearchInput({store:store}))),groups,React.DOM.div({className:"vg-feedbacktrigger",onClick:this.handleStartFeedback},React.DOM.i({className:"vg-icon vg-icon-bulb"}),React.DOM.div(null,React.DOM.strong(null,"Can't find the view you need?"),React.DOM.a(null,"Just let us know!"))))},handleSubmitFilter:function(e){e.preventDefault()},handleStartFeedback:function(){this.props.store.startFeedback()}});return module.exports=SolutionList,module.exports}),define("ViewGallery/SolutionViewer",function(require,exports,module){var React=require("react"),ReactCSSTransitionGroup=React.addons.CSSTransitionGroup,$=require("jQuery"),ViewList=require("ViewGallery/ViewList"),ViewsStore=require("ViewGallery/viewsStore"),FeedbackForm=require("ViewGallery/FeedbackForm"),SolutionViewerForm=require("ViewGallery/SolutionViewerForm"),SolutionViewerInner=require("ViewGallery/SolutionViewerInner"),SolutionViewerHeader=require("ViewGallery/SolutionViewerHeader"),StickyHeaderMixin=require("ViewGallery/StickyHeaderMixin"),ScrollToMixin=require("ViewGallery/ScrollToMixin"),SolutionViewer=React.createClass({displayName:"SolutionViewer",mixins:[StickyHeaderMixin,ScrollToMixin],getStickyHeaderParent:function(){return $(this.getDOMNode()).parents(".vg-right:first")[0]},componentDidMount:function(){this.changeListener=function(){this.isMounted()&&this.forceUpdate()}.bind(this),this.props.store.onChange(this.changeListener),window.addEventListener("resize",this.changeListener)},componentDidUpdate:function(){var scrollTo=this.props.store.scrollTo;"prereq"===scrollTo&&(this.scrollTo(),this.props.store.scrolledTo())},componentWillUnmount:function(){this.props.store.offChange(this.changeListener),window.removeEventListener("resize",this.changeListener)},render:function(){var item=this.props.store.getSelected();if(!item)return null;var inner,header;item.userData.isEditingFull?inner=SolutionViewerForm({store:this.props.store,item:item}):(header=SolutionViewerHeader({ref:"header",store:this.props.store,item:item}),inner=SolutionViewerInner({ref:"inner",store:this.props.store,item:item}));var feedbackForm;this.props.store.isFeedback&&(feedbackForm=FeedbackForm({store:this.props.store}));var viewsStore=new ViewsStore(item,this.props.store);return React.DOM.div({className:"vg-viewer"},ReactCSSTransitionGroup({transitionName:"vg-overlay-animation"},feedbackForm),header,inner,ViewList({item:item,store:viewsStore}))}});return module.exports=SolutionViewer,module.exports}),define("ViewGallery/SolutionViewerForm",function(require,exports,module){var React=require("react"),_=require("Underscore"),boardApi=require("ViewGallery/boardApi"),MarkdownTextarea=require("ViewGallery/MarkdownTextarea"),ProcessSelect=require("ViewGallery/ProcessSelect"),Button=require("ViewGallery/Button"),SolutionViewerForm=React.createClass({displayName:"SolutionViewerForm",getInitialState:function(){return{viewFolders:[],isTitleChanged:!1}},componentDidMount:function(){this.props.item.objectId||boardApi.getViewFolders().then(function(items){this.setState({viewFolders:items})}.bind(this))},render:function(){var viewFoldersInput,item=this.props.item,disableProcessMessage=item.userData.viewsHasCfs?"You can set only process for solution or custom fields for views. Unset custom fields for all views to enable process":"";if(!item.objectId){var opts=this.state.viewFolders.map(function(v,k){return React.DOM.option({key:k,value:k},v.title)}),select=React.DOM.select({ref:"viewFolder",onChange:this.handleChangeTitleByFolder},React.DOM.option({key:"zero",value:"-1"}),opts);viewFoldersInput=React.DOM.div({className:"vg-forminput"},React.DOM.label({htmlFor:"solution_processId"},"Copy folders from existing folder"),select)}return React.DOM.div({className:"vg-viewer__inner"},React.DOM.form({onSubmit:this.handleSubmit},React.DOM.div({className:"vg-forminput"},React.DOM.input({type:"text",placeholder:"Title",ref:"title",autoFocus:!0,maxLength:"50",required:!0,pattern:".*\\S+.*",title:"Enter something",onChange:this.handleChangeTitle,defaultValue:item.title,value:item.userData.tmpTitle})),viewFoldersInput,React.DOM.div({className:"vg-forminput"},React.DOM.input({type:"text",placeholder:"xxxx.tpondemand.com",ref:"hosts",maxLength:"150",defaultValue:item.hosts?item.hosts.join(", "):item.host})),React.DOM.div({className:"vg-forminput"},MarkdownTextarea({placeholder:"Description",ref:"description",defaultValue:item.description})),React.DOM.div({className:"vg-forminput"},MarkdownTextarea({placeholder:"Prerequisites",ref:"prerequisites",defaultValue:item.prerequisites})),React.DOM.div({className:"vg-forminput"},React.DOM.label({htmlFor:"solution_processId"},"Process"),ProcessSelect({id:"solution_processId",ref:"prerequisitesProcessId",disabled:item.userData.viewsHasCfs||null,title:disableProcessMessage,defaultValue:item.prerequisitesProcessId,process:item.prerequisitesData?item.prerequisitesData.process:null})),React.DOM.div({className:"vg-forminput vg-forminput-video"},React.DOM.input({type:"url",placeholder:"Youtube link",ref:"youtubeUrl",title:"Enter something",defaultValue:item.youtubeUrl})),React.DOM.div({className:"vg-forminput-checkbox"},React.DOM.label(null,React.DOM.input({type:"checkbox",ref:"isHidden",defaultChecked:item.isHidden}),"Hide for non-admins")),React.DOM.div({className:"vg-buttons"},Button({type:"submit",className:"vg-btn vg-btn-success vg-btn-big",loaderActive:item.userData.isLoading,loaderProgress:item.userData.loadProgress},"Save"),React.DOM.a({className:"vg-cancellink",onClick:this.handleCancel},"Cancel"))))},handleChangeTitle:function(e){var item=this.props.item;this.props.store.setTmpTitle(item,e.target.value),this.state.isTitleChanged||this.setState({isTitleChanged:!0})},handleChangeTitleByFolder:function(e){if(!this.state.isTitleChanged){var item=this.props.item,text=e.target.selectedOptions[0]&&e.target.selectedOptions[0].text;this.props.store.setTmpTitle(item,text)}},handleCancel:function(){var item=this.props.store.getSelected();this.props.store.cancelEditFull(item)},handleSubmit:function(e){e.preventDefault();var data={};if(data.title=this.refs.title.getDOMNode().value.trim(),data.hosts=_.uniq(_.compact(this.refs.hosts.getDOMNode().value.split(",").map(function(v){return v.trim()}))),data.host=null,data.description=this.refs.description.getValue(),data.prerequisites=this.refs.prerequisites.getValue(),data.youtubeUrl=this.refs.youtubeUrl.getDOMNode().value.trim(),data.isHidden=this.refs.isHidden.getDOMNode().checked,data.youtubeId=null,data.youtubeUrl){var match=data.youtubeUrl.match(/https?:\/\/www\.youtube.com\/watch\?v=([^&]+)/);match||(match=data.youtubeUrl.match(/https?:\/\/youtu.be\/([^&]+)/)),match&&(data.youtubeId=match[1])}var item=this.props.store.getSelected();data.prerequisitesProcessId=this.refs.prerequisitesProcessId.getDOMNode().value,this.refs.viewFolder&&(data.viewFolder=this.state.viewFolders[this.refs.viewFolder.getDOMNode().value]),this.props.store.saveFull(item,data)}});return module.exports=SolutionViewerForm,module.exports}),define("ViewGallery/SolutionViewerHeader",function(require,exports,module){var React=require("react"),ImportButton=require("ViewGallery/ImportButton"),Tooltip=require("ViewGallery/Tooltip"),SolutionViewerHeader=React.createClass({displayName:"SolutionViewerHeader",render:function(){var prereqTrigger,store=this.props.store,item=this.props.item,permissions=this.props.store.permissions;
if(item.prerequisites||item.userData.fullPrerequisitesData){var tooltip;item.userData.showPrereqTooltip&&(tooltip=Tooltip({orientation:"top"},"This solution has prerequisites, please read them before adding this solution.")),prereqTrigger=React.DOM.a({className:"vg-prereqtrigger",onClick:this.handleTogglePrereq,onMouseEnter:this.handleShowPrereqTooltip,onMouseLeave:this.handleHidePrereqTooltip},item.userData.showPrereq?"Hide prerequisites":"Prerequisites",tooltip)}var editButtons;return permissions.edit&&(editButtons=React.DOM.button({type:"button",className:"vg-btn vg-btn-ghost",onClick:this.handleStartEdit},"Edit")),React.DOM.div({className:"vg-viewer__header vg-viewer__header-sticky"},React.DOM.h2(null,item.userData.isEditing?item.userData.tmpTitle||item.title:item.title),React.DOM.div({className:"vg-viewer__tools"},prereqTrigger,editButtons,ImportButton({item:item,store:store,type:"solution",onConfirm:this.handleImportConfirm,onCancel:this.handleImportCancel,onClick:this.handleCreateBoards},"Try the solution")))},handleTogglePrereq:function(){this.props.store.togglePrereq(this.props.item)},handleShowPrereqTooltip:function(){this.props.store.togglePrereqTooltip(this.props.item,!0)},handleHidePrereqTooltip:function(){this.props.store.togglePrereqTooltip(this.props.item,!1)},handleStartEdit:function(){this.props.store.startEditFull(this.props.item)},handleImportConfirm:function(confirmData){this.props.store.confirmImport(this.props.item,confirmData)},handleImportCancel:function(){this.props.store.cancelImport(this.props.item)},handleCreateBoards:function(){this.props.store.createBoards(this.props.item)}});return module.exports=SolutionViewerHeader,module.exports}),define("ViewGallery/SolutionViewerInner",function(require,exports,module){var React=require("react"),MarkdownOutput=require("ViewGallery/MarkdownOutput"),Prerequisites=require("ViewGallery/Prerequisites"),SolutionViewerInner=React.createClass({displayName:"SolutionViewerInner",render:function(){var prereq,item=this.props.item;item.userData.showPrereq&&(item.prerequisites||item.userData.fullPrerequisitesData)&&(prereq=Prerequisites({item:item,store:this.props.store,type:"solution"}));var video,videoTrigger,videoLinks;return item.youtubeId&&(item.userData.showVideo?(videoLinks=React.DOM.div({className:"vg-viewlist__itemvideolinks"},React.DOM.a({href:"http://youtu.be/"+item.youtubeId,target:"_blank"},"http://youtu.be/"+item.youtubeId),React.DOM.a({href:"http://www.dirpy.com/studio?url="+encodeURIComponent("https://www.youtube.com/watch?v="+item.youtubeId),target:"_blank"},"Download video")),video=React.DOM.div({className:"vg-viewlist__itemdescription vg-viewlist__itemvideo"},React.DOM.iframe({src:"//www.youtube.com/embed/"+item.youtubeId+"?autoplay=1",frameBorder:"0",allowFullScreen:!0}))):videoTrigger=React.DOM.a({className:"vg-viewlist__videotrigger",onClick:this.handleToggleVideo},React.DOM.i({className:"vg-icon vg-icon-play"}),React.DOM.span(null,"Watch solution video"))),React.DOM.div({className:"vg-viewer__inner"},prereq,React.DOM.div({className:"vg-viewlist__itemdescription vg-viewlist__description"},MarkdownOutput({html:item.descriptionHtml})),videoTrigger,videoLinks,video)},handleToggleVideo:function(){this.props.store.toggleVideo(this.props.item)}});return module.exports=SolutionViewerInner,module.exports}),define("ViewGallery/Tooltip",function(require,exports,module){var React=require("react"),cx=React.addons.classSet,Tooltip=React.createClass({displayName:"Tooltip",getDefaultProps:function(){return{orientation:"left"}},render:function(){var className={"tau-bubble tau-warning-bubble i-role-bubble i-state_visible vg-confirmation":!0};return className["i-orientation_"+this.props.orientation]=!0,this.props.className&&(className[this.props.className]=!0),className=cx(className),React.DOM.div({className:className,"data-orientation":this.props.orientation},React.DOM.div({className:"tau-bubble__arrow tau-container","data-orientation":this.props.orientation}),React.DOM.div({className:"tau-bubble__inner tau-container"},this.props.children))}});return module.exports=Tooltip,module.exports}),define("ViewGallery/ViewConfig",function(require,exports,module){var React=require("react"),terms=require("ViewGallery/terms"),ViewConfig=React.createClass({displayName:"ViewConfig",render:function(){var item=this.props.item,config=item.config;if(config){var zoom;zoom="object"!=typeof item.config.zoomLevel?item.config.zoomLevel:item.config.zoomLevel[item.config.viewMode];var mainConfig=React.DOM.dl(null,React.DOM.div({className:"vg-viewconfig__param"},React.DOM.dt(null,"Mode"),React.DOM.dd(null,terms.getViewModeTitle(item.config.viewMode))),React.DOM.div({className:"vg-viewconfig__param"},React.DOM.dt(null,"Zoom"),React.DOM.dd(null,zoom))),res=React.DOM.div({className:"vg-viewconfig"},this.renderConfigLine(config.cells,"Cards"),this.renderConfigLine(config.x,"Vertical lanes"),this.renderConfigLine(config.y,"Horizontal lanes"),React.DOM.div(null,mainConfig));return res}},renderConfigLine:function(config,title){var res,filter,sort;if(config&&config.types&&config.types.length){filter=config.filter&&config.useFilter?React.DOM.div({className:"vg-viewconfig__param"},React.DOM.dt(null,"Filter"),React.DOM.dd(null,config.filter)):React.DOM.div({className:"vg-viewconfig__param"},React.DOM.span(null,"Filter is not set")),sort=config.ordering&&config.ordering.name?React.DOM.div({className:"vg-viewconfig__param"},React.DOM.dt(null,"Sort"),React.DOM.dd(null,React.DOM.span(null,config.ordering.name)," ",React.DOM.span(null,config.ordering.direction))):React.DOM.div({className:"vg-viewconfig__param"},React.DOM.span(null,"Sort is not set"));var types=config.types.map(function(v){return terms.getTermTitle(v)}).join(", ");res=React.DOM.dl(null,React.DOM.div({className:"vg-viewconfig__param"},React.DOM.dt(null,title),React.DOM.dd(null,types)),filter,sort)}else res=React.DOM.dl(null,React.DOM.div({className:"vg-viewconfig__param"},React.DOM.span(null,title+" are not set")));return React.DOM.div(null,res)}});return module.exports=ViewConfig,module.exports}),define("ViewGallery/ViewItem",function(require,exports,module){var React=require("react"),cx=React.addons.classSet,_=require("Underscore"),FileInput=require("ViewGallery/FileInput"),SortableMixin=require("ViewGallery/SortableMixin"),makeHttpsImg=require("ViewGallery/makeHttpsImg"),ViewItem=React.createClass({displayName:"ViewItem",mixins:[SortableMixin],render:function(){var img,item=this.props.item,className=cx({"vg-viewlist__item":!0,"vg-viewlist__item-active":item.userData.isSelected||item.userData.isEditing,"vg-viewlist__item-editing":item.userData.isEditing,"vg-viewlist__item-dragging":item.userData.isDragging,"vg-viewlist__item-notmatchfilter":!item.userData.isMatchFilter});img=item.previewImg?React.DOM.img({className:"vg-viewlist__itemimg",key:this.props.key,src:makeHttpsImg(item.previewImg)}):React.DOM.div({className:"vg-viewlist__itemimg"});var inner;inner=item.userData.isEditing?this.renderForm():React.DOM.div({className:"vg-viewlist__iteminner"},React.DOM.h5(null,item.title),img,React.DOM.div({className:"vg-viewlist__itemdescription"},item.shortDescription));var isDraggable=!item.userData.isEditing&&!this.props.store.solutionStore.isAdding&&this.props.store.permissions.edit;return React.DOM.div({className:className,onClick:this.handleClick,"data-matched":item.userData.isMatchFilter||null,draggable:isDraggable||null,"data-index":this.props.index,onDragStart:this.handleDragStart,onDragEnd:this.handleDragEnd,onDragOver:this.handleDragOver},inner,React.DOM.div({className:"vg-viewlist__itemhelper"}))},renderForm:function(){var item=this.props.item;return React.DOM.div({className:"vg-viewlist__iteminner"},React.DOM.h5(null,item.userData.tmpTitle||item.title),React.DOM.div({className:"vg-forminput vg-forminput-preview"},FileInput({defaultValue:makeHttpsImg(item.previewImg),ref:"previewImg",fitImage:!0,width:184,height:114},"Load preview (184×114)")),React.DOM.div({className:"vg-forminput"},React.DOM.textarea({placeholder:"Short description",ref:"shortDescription",defaultValue:item.shortDescription})))},getFormData:function(){var data={};return _.forEach(this.refs,function(v,k){"previewImg"!==k&&"screenshotImg"!==k&&(data[k]=v.getDOMNode().value)}),data.previewImg=this.refs.previewImg.getValue(),data},handleClick:function(){this.props.store.select(this.props.item)}});return module.exports=ViewItem,module.exports}),define("ViewGallery/ViewItemFull",function(require,exports,module){var React=require("react"),ReactCSSTransitionGroup=React.addons.CSSTransitionGroup,$=require("jQuery"),MarkdownOutput=require("ViewGallery/MarkdownOutput"),ViewConfig=require("ViewGallery/ViewConfig"),ViewScreenshot=require("ViewGallery/ViewScreenshot"),Prerequisites=require("ViewGallery/Prerequisites"),ViewItemFullHeader=require("ViewGallery/ViewItemFullHeader"),Overlay=require("ViewGallery/Overlay"),StickyHeaderMixin=require("ViewGallery/StickyHeaderMixin"),ScrollToMixin=require("ViewGallery/ScrollToMixin"),ViewItemFull=React.createClass({displayName:"ViewItemFull",mixins:[StickyHeaderMixin,ScrollToMixin],getScrollToScrolledEl:function(){return $(this.getDOMNode()).find(".vg-overlay__content-scrollable:first")},componentDidUpdate:function(){var scrollTo=this.props.store.scrollTo;("prereq"===scrollTo||"top"===scrollTo)&&(this.scrollTo(),this.props.store.scrolledTo())},render:function(){var prereq,item=this.props.item,store=this.props.store,key="k"+(item.objectId||"00"),header=ViewItemFullHeader({ref:"header",item:item,store:store});item.userData.showPrereq&&(item.prerequisites||item.userData.fullPrerequisitesData)&&(prereq=Prerequisites({item:item,store:store,type:"view"}));var variations;item.userData.showVariations&&item.variations&&(variations=React.DOM.div({className:"vg-viewer__variations vg-viewlist__itemdescription"},MarkdownOutput({html:item.variationsHtml})));var variationsTrigger,img=ViewScreenshot({item:item,store:store});item.variations&&(variationsTrigger=React.DOM.div({className:"vg-variationstrigger"},React.DOM.a({className:"vg-linktrigger",onClick:this.handleToggleVariations},item.userData.showVariations?"Hide variations":"Show variations")));var tags;item.tags.length&&(tags=item.tags.map(function(v,k){return React.DOM.a({className:"vg-tag",key:"t"+k,onClick:this.handleSelectTag},v)}.bind(this)),tags=React.DOM.div({className:"vg-viewlist__tags"},tags));var config;item.userData.showConfig&&(config=React.DOM.div({className:"vg-viewlist__itemdescription"},ViewConfig({item:item})));var configTrigger=React.DOM.div({className:"vg-viewlist__itemconfig"},React.DOM.a({className:"vg-linktrigger",onClick:this.handleToggleConfig},item.userData.showConfig?"Hide the view configuration":"Show the view configuration")),direction=store.pagingDirection;return Overlay({onClose:this.handleCloseOverlay,className:"vg-overlay-itemfull"},header,ReactCSSTransitionGroup({ref:"inner",component:React.DOM.div,className:"vg-paging-animation-holder",transitionName:"vg-paging-animation-"+direction},React.DOM.div({key:key,className:"vg-viewlist__itemfull vg-viewlist__itemfull-overlay vg-viewer"},prereq,React.DOM.div({className:"vg-viewlist__itemdescription vg-viewlist__description"},MarkdownOutput({html:item.descriptionHtml})),variationsTrigger,variations,img,tags,configTrigger,config)))},handleToggleVariations:function(){this.props.store.toggleVariations(this.props.item)},handleToggleConfig:function(){this.props.store.toggleConfig(this.props.item)},handleSelectTag:function(e){this.props.store.selectTag(e.target.innerText||e.target.textContent,this.props.item)},handleCloseOverlay:function(){this.props.store.select(this.props.item)},handleToggleScreenshot:function(){this.props.store.toggleScreenshot(this.props.item)}});return module.exports=ViewItemFull,module.exports}),define("ViewGallery/ViewItemFullForm",function(require,exports,module){var React=require("react"),FileInputMultiple=require("ViewGallery/FileInputMultiple"),_=require("Underscore"),Confirmation=require("ViewGallery/Confirmation"),Button=require("ViewGallery/Button"),MarkdownTextarea=require("ViewGallery/MarkdownTextarea"),ViewConfig=require("ViewGallery/ViewConfig"),FileInputMultipleStore=require("ViewGallery/fileInputMultipleStore"),CustomFieldsSelect=require("ViewGallery/CustomFieldsSelect"),boardApi=require("ViewGallery/boardApi"),ViewItemFull=React.createClass({displayName:"ViewItemFull",getInitialState:function(){return{parentId:null,isShowTooltip:!1,viewFolders:[],screenshotImgsStore:new FileInputMultipleStore(this.props.item)}},componentDidMount:function(){this.props.item.objectId&&boardApi.getGroupedViews().then(function(items){this.setState({viewFolders:items})}.bind(this))},render:function(){var confirmation,item=this.props.item;item.userData.isWaitingConfirmation&&(confirmation=Confirmation({onConfirm:this.handleConfirmRemove,onCancel:this.handleCancelRemove,orientation:"right"},"Do you really want to remove this View?"));var remove;item.objectId||(remove=React.DOM.a({className:"vg-removelink",onClick:this.handleRemove},"Remove"));var config;item.userData.showConfig&&(config=React.DOM.div({className:"vg-viewlist__itemconfig"},ViewConfig({item:item})));var viewFoldersInput;if(item.objectId){var opts=this.state.viewFolders.map(function(v,k){var opts=v.boards.map(function(v,k){return React.DOM.option({key:"o"+k,value:v.key},v.title)});return React.DOM.optgroup({key:"og"+k,label:v.title},opts)}),select=React.DOM.select({ref:"configByKey",onChange:this.handleChangeConfig},React.DOM.option({key:"zero",value:""}),opts);viewFoldersInput=React.DOM.div({className:"vg-forminput"},React.DOM.label({htmlFor:"solution_processId"},"Use config from existing view"),select)}var parentOptions=this.props.store.getSolutions().map(function(v,k){var opts=v.items.map(function(v,k){return React.DOM.option({key:"o"+k,value:v.objectId},v.title)});return React.DOM.optgroup({key:"og"+k,label:v.title},opts)}),parentId=this.state.parentId||item.parentId||this.props.store.solution.objectId,solution=this.props.store.solution,disableCfs=solution.prerequisitesData&&solution.prerequisitesData.process,disableCfsMessage=disableCfs?"You can set only process for solution or custom fields for views. Unset process for parent solution to enable custom fields":"";return React.DOM.div({className:"vg-viewlist__itemfull vg-viewer"},React.DOM.div({className:"vg-forminput"},React.DOM.input({type:"text",placeholder:"Title",ref:"title",autoFocus:!0,maxLength:"50",required:!0,pattern:".*\\S+.*",title:"Enter something",onChange:this.handleChangeTitle,defaultValue:item.title})),React.DOM.div({className:"vg-forminput"},React.DOM.select({ref:"parentId",value:parentId,onChange:this.handleChangeParentId},parentOptions)),viewFoldersInput,React.DOM.div({className:"vg-forminput"},MarkdownTextarea({placeholder:"Description",ref:"description",defaultValue:item.description})),React.DOM.div({className:"vg-forminput"},MarkdownTextarea({placeholder:"Prerequisites",ref:"prerequisites",defaultValue:item.prerequisites})),React.DOM.div({className:"vg-forminput"},MarkdownTextarea({placeholder:"Variations",ref:"variations",defaultValue:item.variations})),React.DOM.div({className:"vg-forminput"},React.DOM.input({type:"text",placeholder:"Tags",ref:"tags",defaultValue:item.tags.join(", ")})),React.DOM.div({className:"vg-forminput vg-forminput-preview"},FileInputMultiple({store:this.state.screenshotImgsStore,ref:"screenshotImg",width:892,height:542},"Load screenshot (892×524)")),React.DOM.div({className:"vg-forminput-cfs"},React.DOM.label({htmlFor:"cfs"},"Custom Fields"),CustomFieldsSelect({ref:"prerequisitesDataCustomFields",id:"cfs",defaultValue:item.prerequisitesDataCustomFields||[],disabled:disableCfs||null,title:disableCfsMessage})),React.DOM.div({className:"vg-forminput-checkbox"},React.DOM.label(null,React.DOM.input({type:"checkbox",ref:"prerequisitesForceProcesses",defaultChecked:item.prerequisitesForceProcesses}),"Force to set custom fields for all processes")),React.DOM.div({className:"vg-viewlist__itemconfig"},React.DOM.a({className:"vg-linktrigger",onClick:this.handleToggleConfig},item.userData.showConfig?"Hide parameters of the view":"Show parameters of the view")),config,React.DOM.div({className:"vg-buttons"},Button({type:"submit",className:"vg-btn vg-btn-success vg-btn-big",loaderActive:item.userData.isLoading,loaderProgress:item.userData.loadProgress},"Save"),React.DOM.a({className:"vg-cancellink",onClick:this.handleCancel},"Cancel")))},handleCancel:function(){this.props.store.cancelEdit(this.props.item)},handleToggleConfig:function(){this.props.store.toggleConfig(this.props.item)},handleChangeTitle:function(e){this.props.store.setTmpTitle(this.props.item,e.target.value)},handleChangeParentId:function(e){this.props.item.objectId?this.setState({parentId:e.target.value}):this.props.store.selectSolution(e.target.value)},handleChangeConfig:function(e){e.target.value&&window.alert("Your existing config will be replaced after save!")},getFormData:function(){var data={};return _.forEach(this.refs,function(v,k){"previewImg"!==k&&"screenshotImg"!==k&&v.getDOMNode()&&(data[k]=v.getDOMNode().value)}),data.title=data.title.trim(),data.description=this.refs.description.getValue(),data.prerequisites=this.refs.prerequisites.getValue(),data.variations=this.refs.variations.getValue(),data.prerequisitesDataCustomFields=this.refs.prerequisitesDataCustomFields.getValue(),data.prerequisitesForceProcesses=Boolean(this.refs.prerequisitesForceProcesses.getDOMNode().checked),this.refs.configByKey&&(data.configByKey=this.refs.configByKey.getDOMNode().value),data.screenshotImg=this.refs.screenshotImg.getValue(),data}});return module.exports=ViewItemFull,module.exports}),define("ViewGallery/ViewItemFullHeader",function(require,exports,module){var React=require("react"),ImportButton=require("ViewGallery/ImportButton"),Confirmation=require("ViewGallery/Confirmation"),Tooltip=require("ViewGallery/Tooltip"),ViewItemFullHeader=React.createClass({displayName:"ViewItemFullHeader",getInitialState:function(){return{isShowTooltipPrevious:!1,isShowTooltipNext:!1}},render:function(){var editButtons,item=this.props.item,store=this.props.store,permissions=this.props.store.permissions;if(permissions.edit){var confirmation;item.userData.isWaitingConfirmation&&(confirmation=Confirmation({onConfirm:this.handleConfirmRemove,onCancel:this.handleCancelRemove,orientation:"top"},"Do you really want to remove this View?")),editButtons=React.DOM.div({className:"vg-btn-group"},React.DOM.button({type:"button",className:"vg-btn vg-btn-ghost",onClick:this.handleStartEdit},"Edit"),React.DOM.button({type:"button",className:"vg-btn vg-btn-ghost vg-btn-remove",onClick:this.handleRemove},"Remove"),confirmation)}var prereqTrigger;if(item.prerequisites||item.userData.fullPrerequisitesData){var tooltip;item.userData.showPrereqTooltip&&(tooltip=Tooltip({orientation:"top"},"This view has prerequisites, please read them before adding this view.")),prereqTrigger=React.DOM.a({className:"vg-prereqtrigger",onClick:this.handleTogglePrereq,onMouseEnter:this.handleShowPrereqTooltip,onMouseLeave:this.handleHidePrereqTooltip},item.userData.showPrereq?"Hide prerequisites":"Prerequisites",tooltip)}var hasPrev=store.hasPrev(item),viewPrev=React.DOM.button({type:"button",className:"vg-btn",onClick:this.handleClickPrevious,disabled:hasPrev?null:!0,title:"Previous view"},"←"),hasNext=store.hasNext(item),viewNext=React.DOM.button({type:"button",className:"vg-btn",onClick:this.handleClickNext,disabled:hasNext?null:!0,title:"Next view"},"→"),viewPager=React.DOM.div({className:"vg-btn-group vg-viewpager"},viewPrev,viewNext);return React.DOM.div({className:"vg-viewer__header vg-viewer__header-view vg-viewer__header-sticky"},React.DOM.h2(null,item.title),React.DOM.div({className:"vg-viewer__tools"},prereqTrigger,editButtons,ImportButton({item:item,store:store,type:"view",onConfirm:this.handleImportConfirm,onCancel:this.handleImportCancel,onClick:this.handleCreateBoard},"Try the view"),viewPager))},handleStartEdit:function(){this.props.store.startEdit(this.props.item)},handleCreateBoard:function(){this.props.store.createBoard(this.props.item)},handleImportConfirm:function(confirmData){this.props.store.confirmImport(this.props.item,confirmData)},handleImportCancel:function(){this.props.store.cancelImport(this.props.item)},handleShowPrereqTooltip:function(){this.props.store.togglePrereqTooltip(this.props.item,!0)},handleHidePrereqTooltip:function(){this.props.store.togglePrereqTooltip(this.props.item,!1)},handleRemove:function(){this.props.store.startRemove(this.props.item)},handleConfirmRemove:function(){this.props.store.remove(this.props.item)},handleCancelRemove:function(){this.props.store.cancelRemove(this.props.item)},handleTogglePrereq:function(){this.props.store.togglePrereq(this.props.item)},handleClickNext:function(){this.props.store.selectNext(this.props.item)},handleClickPrevious:function(){this.props.store.selectPrevious(this.props.item)}});return module.exports=ViewItemFullHeader,module.exports}),define("ViewGallery/ViewList",function(require,exports,module){var $=require("jQuery"),_=require("Underscore"),React=require("react"),cx=React.addons.classSet,ReactCSSTransitionGroup=React.addons.CSSTransitionGroup,Flx=require("ViewGallery/Flx"),ViewItem=require("ViewGallery/ViewItem"),ViewItemFull=require("ViewGallery/ViewItemFull"),ViewItemFullForm=require("ViewGallery/ViewItemFullForm"),ScrollToMixin=require("ViewGallery/ScrollToMixin"),ViewList=React.createClass({displayName:"ViewList",mixins:[Flx.Mixin,ScrollToMixin],componentDidMount:function(){this.props.store.read()},componentDidUpdate:function(){var scrollTo=this.props.store.scrollTo;if(scrollTo){if("start"===scrollTo)this.scrollTo();else{var selector={search:"[data-matched]",edit:".vg-viewlist__item-editing",select:".vg-viewlist__item-active"}[scrollTo];if(selector){var $scrollTo=$(this.getDOMNode()).find(selector).first();$scrollTo.length&&this.scrollTo($scrollTo[0],"edit"===scrollTo?-10:-50)}}this.props.store.scrolledTo()}},render:function(){var store=this.props.store,items=store.getListItems(),selected=store.getSelected(),groupLen=1;document.body.clientWidth>=1200?groupLen=4:document.body.clientWidth>=992?groupLen=3:document.body.clientWidth>=768&&(groupLen=2);var viewer,grouped=_.range(0,Math.ceil(items.length/groupLen)).map(function(v){return items.slice(v*groupLen,(v+1)*groupLen)}),className=cx({"vg-viewlist":!0,"vg-viewlist-dragging":store.isDragging});return selected&&!selected.userData.isEditing&&selected.objectId&&(viewer=ViewItemFull({ref:"viewer",key:"viewer",item:selected,store:this.props.store})),React.DOM.div({className:className},grouped.map(function(items,k){return this.renderRow(items,selected,k,groupLen*k,groupLen)}.bind(this)),ReactCSSTransitionGroup({transitionName:"vg-overlay-animation"},viewer))},renderRow:function(items,selected,num,itemIndex,groupLen){var editor,store=this.props.store,hasSelected=items.indexOf(selected)>=0;hasSelected&&selected&&selected.userData.isEditing&&(editor=ViewItemFullForm({key:"e"+selected.objectId||"00",ref:"viewer",item:selected,store:this.props.store}));var dummies,draggingIndex=store.draggingIndex;items.length<groupLen&&(dummies=_.range(items.length,groupLen).map(function(v,k){return React.DOM.div({key:"dummy"+k,className:"vg-viewlist__itemdummy"})}));var permissions=store.permissions,hasEditable=hasSelected&&selected.userData.isEditing;return React.DOM.div({className:"vg-viewlist__row",key:hasEditable?"editable_is_here":"r"+num,onDrop:this.handleDrop},React.DOM.form({onSubmit:this.handleSubmit},React.DOM.div({className:"vg-viewlist__rowinner"},items.map(function(v,k){return ViewItem({ref:v.userData.isEditing?"item":null,key:v.objectId||"k0",item:v,store:store,index:itemIndex+k,draggingIndex:draggingIndex,sort:permissions.edit&&this.handleSort,sortStarted:permissions.edit&&this.handleSortStarted,sortCompleted:permissions.edit&&this.handleSortCompleted})}.bind(this)),dummies),editor))},handleSubmit:function(e){e.preventDefault();var itemData=this.refs.item.getFormData(),viewerData=this.refs.viewer.getFormData(),data=_.extend(itemData,viewerData),edited=_.find(this.props.store.items,function(v){return v.userData.isEditing});this.props.store.save(edited,data)},handleSort:function(from,to){this.props.store.reorder(from,to),this.to=to},handleSortStarted:function(index){this.props.store.startSort(index)},handleSortCompleted:function(to){this.to=null,this.props.store.prioritize(to)},handleDrop:function(e){e.preventDefault(),null!==this.to&&this.props.store.prioritize(this.to)}});return module.exports=ViewList,module.exports}),define("ViewGallery/ViewScreenshot",function(require,exports,module){var $=require("jQuery"),React=require("react"),ReactCSSTransitionGroup=React.addons.CSSTransitionGroup,cx=React.addons.classSet,makeHttpsImg=require("ViewGallery/makeHttpsImg"),Overlay=require("ViewGallery/Overlay"),ViewScreenshot=React.createClass({displayName:"ViewScreenshot",getInitialState:function(){var item=this.props.item,urls=item.screenshotImgs&&item.screenshotImgs.length?item.screenshotImgs:item.screenshotImg?[item.screenshotImg]:[];return{activeIndex:0,hasNext:urls.length>1,showOverlay:!1,urls:urls}},componentDidUpdate:function(){if(this.refs.inner){var $inner=$(this.refs.inner.getDOMNode());$inner.animate({scrollLeft:this.state.activeIndex*$inner[0].getBoundingClientRect().width})}},render:function(){var item=this.props.item,key="k"+item.objectId,urls=this.state.urls;if(!urls.length)return null;var imgs;imgs=urls.map(function(v,k){return React.DOM.div({className:"vg-carousel__item",key:key+k},React.DOM.img({className:"vg-carousel__img",onClick:this.handleToggleScreenshot,src:makeHttpsImg(v)}))}.bind(this));var indicators;if(urls.length>1){var indicatorItems=urls.map(function(v,k){var className=cx({"vg-carousel__indicator":!0,"vg-carousel__indicator-active":k===this.state.activeIndex});return React.DOM.div({className:className,"data-index":k,onClick:this.handleSelectActive,key:key+k})}.bind(this));indicators=React.DOM.div({className:"vg-carousel__indicators"},indicatorItems)}var arrows;if(urls.length>1){var nextArrow;this.state.hasNext&&(nextArrow=React.DOM.a({className:"vg-carousel__arrow vg-carousel__arrow-right",onClick:this.handleClickArrowRight},React.DOM.i({className:"vg-icon vg-icon-arrow-next-white"})));var prevArrow;this.state.hasPrev&&(prevArrow=React.DOM.a({className:"vg-carousel__arrow vg-carousel__arrow-left",onClick:this.handleClickArrowLeft},React.DOM.i({className:"vg-icon vg-icon-arrow-prev-white"}))),arrows=React.DOM.div({className:"vg-carousel__arrows"},prevArrow,nextArrow)}var viewer;if(this.state.showOverlay){var url=urls[this.state.activeIndex];viewer=Overlay({onClose:this.handleToggleScreenshot,stretch:!1},React.DOM.div({className:"vg-carousel__wrap"},React.DOM.img({className:"vg-viewlist__itemimgsimple",onClick:this.handleToggleScreenshot,src:makeHttpsImg(url)}),arrows))}return React.DOM.div({className:"vg-carousel vg-viewlist__itemimg"},indicators,React.DOM.div({className:"vg-carousel__wrap"},React.DOM.div({className:"vg-carousel__inner",ref:"inner"},imgs),arrows),ReactCSSTransitionGroup({key:"ov"+key,className:"vg-carousel__viewer",transitionName:"vg-overlay-animation"},viewer))},handleSelectActive:function(e){var ind=Number(e.target.dataset.index);this.setState({activeIndex:ind,hasPrev:ind>0,hasNext:ind<this.state.urls.length-1})},handleToggleScreenshot:function(){this.setState({showOverlay:!this.state.showOverlay})},handleClickArrowLeft:function(){var ind=this.state.activeIndex-1;this.setState({activeIndex:ind,hasPrev:ind>0,hasNext:ind<this.state.urls.length-1})},handleClickArrowRight:function(){var ind=this.state.activeIndex+1;this.setState({activeIndex:ind,hasPrev:ind>0,hasNext:ind<this.state.urls.length-1})}});return module.exports=ViewScreenshot,module.exports}),define("ViewGallery/parse",[],function(){var root={};return function(){!function(root){root.Parse=root.Parse||{},root.Parse.VERSION="js1.2.19"}(this),function(root){root.Parse=root.Parse||{};var Parse=root.Parse;"undefined"!=typeof exports&&exports._?(Parse._=exports._.noConflict(),Parse.localStorage=require("localStorage"),Parse.XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest,exports.Parse=Parse):(Parse._=_,"undefined"!=typeof localStorage&&(Parse.localStorage=localStorage),"undefined"!=typeof XMLHttpRequest&&(Parse.XMLHttpRequest=XMLHttpRequest)),"undefined"!=typeof $&&(Parse.$=$);var EmptyConstructor=function(){},inherits=function(parent,protoProps,staticProps){var child;return child=protoProps&&protoProps.hasOwnProperty("constructor")?protoProps.constructor:function(){parent.apply(this,arguments)},Parse._.extend(child,parent),EmptyConstructor.prototype=parent.prototype,child.prototype=new EmptyConstructor,protoProps&&Parse._.extend(child.prototype,protoProps),staticProps&&Parse._.extend(child,staticProps),child.prototype.constructor=child,child.__super__=parent.prototype,child};Parse.serverURL="https://api.parse.com","undefined"!=typeof process&&process.versions&&process.versions.node&&(Parse._isNode=!0),Parse.initialize=function(applicationId,javaScriptKey,masterKey){if(masterKey)throw"Parse.initialize() was passed a Master Key, which is only allowed from within Node.js.";Parse._initialize(applicationId,javaScriptKey)},Parse._initialize=function(applicationId,javaScriptKey,masterKey){Parse.applicationId=applicationId,Parse.javaScriptKey=javaScriptKey,Parse.masterKey=masterKey,Parse._useMasterKey=!1},Parse._isNode&&(Parse.initialize=Parse._initialize,Parse.Cloud=Parse.Cloud||{},Parse.Cloud.useMasterKey=function(){Parse._useMasterKey=!0}),Parse._getParsePath=function(path){if(!Parse.applicationId)throw"You need to call Parse.initialize before using Parse.";if(path||(path=""),!Parse._.isString(path))throw"Tried to get a localStorage path that wasn't a String.";return"/"===path[0]&&(path=path.substring(1)),"Parse/"+Parse.applicationId+"/"+path},Parse._installationId=null,Parse._getInstallationId=function(){if(Parse._installationId)return Parse._installationId;var path=Parse._getParsePath("installationId");if(Parse._installationId=Parse.localStorage.getItem(path),!Parse._installationId||""===Parse._installationId){var hexOctet=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};Parse._installationId=hexOctet()+hexOctet()+"-"+hexOctet()+"-"+hexOctet()+"-"+hexOctet()+"-"+hexOctet()+hexOctet()+hexOctet(),Parse.localStorage.setItem(path,Parse._installationId)}return Parse._installationId},Parse._parseDate=function(iso8601){var regexp=new RegExp("^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$"),match=regexp.exec(iso8601);if(!match)return null;var year=match[1]||0,month=(match[2]||1)-1,day=match[3]||0,hour=match[4]||0,minute=match[5]||0,second=match[6]||0,milli=match[8]||0;return new Date(Date.UTC(year,month,day,hour,minute,second,milli))},Parse._ajaxIE8=function(method,url,data){var promise=new Parse.Promise,xdr=new XDomainRequest;return xdr.onload=function(){var response;try{response=JSON.parse(xdr.responseText)}catch(e){promise.reject(e)}response&&promise.resolve(response)},xdr.onerror=xdr.ontimeout=function(){var fakeResponse={responseText:JSON.stringify({code:Parse.Error.X_DOMAIN_REQUEST,error:"IE's XDomainRequest does not supply error info."})};promise.reject(fakeResponse)},xdr.onprogress=function(){},xdr.open(method,url),xdr.send(data),promise},Parse._useXDomainRequest=function(){return"undefined"!=typeof XDomainRequest?"withCredentials"in new XMLHttpRequest?!1:!0:!1},Parse._ajax=function(method,url,data,success,error,progress){var options={success:success,error:error};if(Parse._useXDomainRequest())return Parse._ajaxIE8(method,url,data)._thenRunCallbacks(options);var promise=new Parse.Promise,handled=!1,xhr=new Parse.XMLHttpRequest;return progress&&(xhr.upload.onprogress=progress),xhr.onreadystatechange=function(){if(4===xhr.readyState){if(handled)return;
if(handled=!0,xhr.status>=200&&xhr.status<300){var response;try{response=JSON.parse(xhr.responseText)}catch(e){promise.reject(e)}response&&promise.resolve(response,xhr.status,xhr)}else promise.reject(xhr)}},xhr.open(method,url,!0),xhr.setRequestHeader("Content-Type","text/plain"),Parse._isNode&&xhr.setRequestHeader("User-Agent","Parse/"+Parse.VERSION+" (NodeJS "+process.versions.node+")"),xhr.send(data),promise._thenRunCallbacks(options)},Parse._extend=function(protoProps,classProps){var child=inherits(this,protoProps,classProps);return child.extend=this.extend,child},Parse._request=function(options){var route=options.route,className=options.className,objectId=options.objectId,method=options.method,useMasterKey=options.useMasterKey,sessionToken=options.sessionToken,dataObject=options.data;if(!Parse.applicationId)throw"You must specify your applicationId using Parse.initialize.";if(!Parse.javaScriptKey&&!Parse.masterKey)throw"You must specify a key using Parse.initialize.";if(!sessionToken){var currentUser=Parse.User.current();currentUser&&currentUser._sessionToken&&(sessionToken=currentUser._sessionToken)}if("batch"!==route&&"classes"!==route&&"events"!==route&&"files"!==route&&"functions"!==route&&"login"!==route&&"push"!==route&&"requestPasswordReset"!==route&&"rest_verify_analytics"!==route&&"users"!==route&&"jobs"!==route)throw"Bad route: '"+route+"'.";var url=Parse.serverURL;"/"!==url.charAt(url.length-1)&&(url+="/"),url+="1/"+route,className&&(url+="/"+className),objectId&&(url+="/"+objectId),dataObject=Parse._.clone(dataObject||{}),"POST"!==method&&(dataObject._method=method,method="POST"),Parse._.isUndefined(useMasterKey)&&(useMasterKey=Parse._useMasterKey),dataObject._ApplicationId=Parse.applicationId,useMasterKey?dataObject._MasterKey=Parse.masterKey:dataObject._JavaScriptKey=Parse.javaScriptKey,dataObject._ClientVersion=Parse.VERSION,dataObject._InstallationId=Parse._getInstallationId(),sessionToken&&(dataObject._SessionToken=sessionToken);var data=JSON.stringify(dataObject);return Parse._ajax(method,url,data,null,null,options.onProgress).then(null,function(response){var error;if(response&&response.responseText)try{var errorJSON=JSON.parse(response.responseText);error=new Parse.Error(errorJSON.code,errorJSON.error)}catch(e){error=new Parse.Error(Parse.Error.INVALID_JSON,"Received an error with invalid JSON from Parse: "+response.responseText)}else error=new Parse.Error(Parse.Error.CONNECTION_FAILED,"XMLHttpRequest failed: "+JSON.stringify(response));return Parse.Promise.error(error)})},Parse._getValue=function(object,prop){return object&&object[prop]?Parse._.isFunction(object[prop])?object[prop]():object[prop]:null},Parse._encode=function(value,seenObjects,disallowObjects){var _=Parse._;if(value instanceof Parse.Object){if(disallowObjects)throw"Parse.Objects not allowed here";if(!seenObjects||_.include(seenObjects,value)||!value._hasData)return value._toPointer();if(!value.dirty())return seenObjects=seenObjects.concat(value),Parse._encode(value._toFullJSON(seenObjects),seenObjects,disallowObjects);throw"Tried to save an object with a pointer to a new, unsaved object."}if(_.isDate(value))return{__type:"Date",iso:value.toJSON()};if(_.isArray(value))return _.map(value,function(x){return Parse._encode(x,seenObjects,disallowObjects)});if(_.isRegExp(value))return value.source;if(value instanceof Parse.Relation)return value.toJSON();if(value instanceof Parse.Op)return value.toJSON();if(value instanceof Parse.File){if(!value.url())throw"Tried to save an object containing an unsaved file.";return{__type:"File",name:value.name(),url:value.url()}}if(_.isObject(value)){var output={};return Parse._objectEach(value,function(v,k){output[k]=Parse._encode(v,seenObjects,disallowObjects)}),output}return value},Parse._decode=function(key,value){var _=Parse._;if(!_.isObject(value))return value;if(_.isArray(value))return Parse._arrayEach(value,function(v,k){value[k]=Parse._decode(k,v)}),value;if(value instanceof Parse.Object)return value;if(value instanceof Parse.File)return value;if(value instanceof Parse.Op)return value;if(value.__op)return Parse.Op._decode(value);if("Pointer"===value.__type){var pointer=Parse.Object._create(value.className);return pointer._finishFetch({objectId:value.objectId},!1),pointer}if("Object"===value.__type){var className=value.className;delete value.__type,delete value.className;var object=Parse.Object._create(className);return object._finishFetch(value,!0),object}if("Date"===value.__type)return Parse._parseDate(value.iso);if("Relation"===value.__type){var relation=new Parse.Relation(null,key);return relation.targetClassName=value.className,relation}if("File"===value.__type){var file=new Parse.File(value.name);return file._url=value.url,file}return Parse._objectEach(value,function(v,k){value[k]=Parse._decode(k,v)}),value},Parse._arrayEach=Parse._.each,Parse._traverse=function(object,func,seen){if(object instanceof Parse.Object){if(seen=seen||[],Parse._.indexOf(seen,object)>=0)return;return seen.push(object),Parse._traverse(object.attributes,func,seen),func(object)}return object instanceof Parse.Relation||object instanceof Parse.File?func(object):Parse._.isArray(object)?(Parse._.each(object,function(child,index){var newChild=Parse._traverse(child,func,seen);newChild&&(object[index]=newChild)}),func(object)):Parse._.isObject(object)?(Parse._each(object,function(child,key){var newChild=Parse._traverse(child,func,seen);newChild&&(object[key]=newChild)}),func(object)):func(object)},Parse._objectEach=Parse._each=function(obj,callback){var _=Parse._;_.isObject(obj)?_.each(_.keys(obj),function(key){callback(obj[key],key)}):_.each(obj,callback)},Parse._isNullOrUndefined=function(x){return Parse._.isNull(x)||Parse._.isUndefined(x)}}(this),function(root){root.Parse=root.Parse||{};var Parse=root.Parse,_=Parse._;Parse.Analytics=Parse.Analytics||{},_.extend(Parse.Analytics,{track:function(name,dimensions){if(name=name||"",name=name.replace(/^\s*/,""),name=name.replace(/\s*$/,""),0===name.length)throw"A name for the custom event must be provided";return _.each(dimensions,function(val,key){if(!_.isString(key)||!_.isString(val))throw'track() dimensions expects keys and values of type "string".'}),Parse._request({route:"events",className:name,method:"POST",data:{dimensions:dimensions}})}})}(this),function(root){root.Parse=root.Parse||{};var Parse=root.Parse,_=Parse._;Parse.Error=function(code,message){this.code=code,this.message=message},_.extend(Parse.Error,{OTHER_CAUSE:-1,INTERNAL_SERVER_ERROR:1,CONNECTION_FAILED:100,OBJECT_NOT_FOUND:101,INVALID_QUERY:102,INVALID_CLASS_NAME:103,MISSING_OBJECT_ID:104,INVALID_KEY_NAME:105,INVALID_POINTER:106,INVALID_JSON:107,COMMAND_UNAVAILABLE:108,NOT_INITIALIZED:109,INCORRECT_TYPE:111,INVALID_CHANNEL_NAME:112,PUSH_MISCONFIGURED:115,OBJECT_TOO_LARGE:116,OPERATION_FORBIDDEN:119,CACHE_MISS:120,INVALID_NESTED_KEY:121,INVALID_FILE_NAME:122,INVALID_ACL:123,TIMEOUT:124,INVALID_EMAIL_ADDRESS:125,MISSING_CONTENT_TYPE:126,MISSING_CONTENT_LENGTH:127,INVALID_CONTENT_LENGTH:128,FILE_TOO_LARGE:129,FILE_SAVE_ERROR:130,FILE_DELETE_ERROR:153,DUPLICATE_VALUE:137,INVALID_ROLE_NAME:139,EXCEEDED_QUOTA:140,SCRIPT_FAILED:141,VALIDATION_ERROR:142,INVALID_IMAGE_DATA:150,UNSAVED_FILE_ERROR:151,INVALID_PUSH_TIME_ERROR:152,USERNAME_MISSING:200,PASSWORD_MISSING:201,USERNAME_TAKEN:202,EMAIL_TAKEN:203,EMAIL_MISSING:204,EMAIL_NOT_FOUND:205,SESSION_MISSING:206,MUST_CREATE_USER_THROUGH_SIGNUP:207,ACCOUNT_ALREADY_LINKED:208,LINKED_ID_MISSING:250,INVALID_LINKED_SESSION:251,UNSUPPORTED_SERVICE:252,AGGREGATE_ERROR:600,FILE_READ_ERROR:601,X_DOMAIN_REQUEST:602})}(this),function(){var root=this,Parse=root.Parse||(root.Parse={}),eventSplitter=/\s+/,slice=Array.prototype.slice;Parse.Events={on:function(events,callback,context){var calls,event,node,tail,list;if(!callback)return this;for(events=events.split(eventSplitter),calls=this._callbacks||(this._callbacks={}),event=events.shift();event;)list=calls[event],node=list?list.tail:{},node.next=tail={},node.context=context,node.callback=callback,calls[event]={tail:tail,next:list?list.next:node},event=events.shift();return this},off:function(events,callback,context){var event,calls,node,tail,cb,ctx;if(calls=this._callbacks){if(!(events||callback||context))return delete this._callbacks,this;for(events=events?events.split(eventSplitter):_.keys(calls),event=events.shift();event;)if(node=calls[event],delete calls[event],node&&(callback||context)){for(tail=node.tail,node=node.next;node!==tail;)cb=node.callback,ctx=node.context,(callback&&cb!==callback||context&&ctx!==context)&&this.on(event,cb,ctx),node=node.next;event=events.shift()}return this}},trigger:function(events){var event,node,calls,tail,args,all,rest;if(!(calls=this._callbacks))return this;for(all=calls.all,events=events.split(eventSplitter),rest=slice.call(arguments,1),event=events.shift();event;){if(node=calls[event])for(tail=node.tail;(node=node.next)!==tail;)node.callback.apply(node.context||this,rest);if(node=all)for(tail=node.tail,args=[event].concat(rest);(node=node.next)!==tail;)node.callback.apply(node.context||this,args);event=events.shift()}return this}},Parse.Events.bind=Parse.Events.on,Parse.Events.unbind=Parse.Events.off}.call(this),function(root){root.Parse=root.Parse||{};var Parse=root.Parse,_=Parse._;Parse.Op=function(){this._initialize.apply(this,arguments)},Parse.Op.prototype={_initialize:function(){}},_.extend(Parse.Op,{_extend:Parse._extend,_opDecoderMap:{},_registerDecoder:function(opName,decoder){Parse.Op._opDecoderMap[opName]=decoder},_decode:function(json){var decoder=Parse.Op._opDecoderMap[json.__op];return decoder?decoder(json):void 0}}),Parse.Op._registerDecoder("Batch",function(json){var op=null;return Parse._arrayEach(json.ops,function(nextOp){nextOp=Parse.Op._decode(nextOp),op=nextOp._mergeWithPrevious(op)}),op}),Parse.Op.Set=Parse.Op._extend({_initialize:function(value){this._value=value},value:function(){return this._value},toJSON:function(){return Parse._encode(this.value())},_mergeWithPrevious:function(){return this},_estimate:function(){return this.value()}}),Parse.Op._UNSET={},Parse.Op.Unset=Parse.Op._extend({toJSON:function(){return{__op:"Delete"}},_mergeWithPrevious:function(){return this},_estimate:function(){return Parse.Op._UNSET}}),Parse.Op._registerDecoder("Delete",function(){return new Parse.Op.Unset}),Parse.Op.Increment=Parse.Op._extend({_initialize:function(amount){this._amount=amount},amount:function(){return this._amount},toJSON:function(){return{__op:"Increment",amount:this._amount}},_mergeWithPrevious:function(previous){if(previous){if(previous instanceof Parse.Op.Unset)return new Parse.Op.Set(this.amount());if(previous instanceof Parse.Op.Set)return new Parse.Op.Set(previous.value()+this.amount());if(previous instanceof Parse.Op.Increment)return new Parse.Op.Increment(this.amount()+previous.amount());throw"Op is invalid after previous op."}return this},_estimate:function(oldValue){return oldValue?oldValue+this.amount():this.amount()}}),Parse.Op._registerDecoder("Increment",function(json){return new Parse.Op.Increment(json.amount)}),Parse.Op.Add=Parse.Op._extend({_initialize:function(objects){this._objects=objects},objects:function(){return this._objects},toJSON:function(){return{__op:"Add",objects:Parse._encode(this.objects())}},_mergeWithPrevious:function(previous){if(previous){if(previous instanceof Parse.Op.Unset)return new Parse.Op.Set(this.objects());if(previous instanceof Parse.Op.Set)return new Parse.Op.Set(this._estimate(previous.value()));if(previous instanceof Parse.Op.Add)return new Parse.Op.Add(previous.objects().concat(this.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(oldValue){return oldValue?oldValue.concat(this.objects()):_.clone(this.objects())}}),Parse.Op._registerDecoder("Add",function(json){return new Parse.Op.Add(Parse._decode(void 0,json.objects))}),Parse.Op.AddUnique=Parse.Op._extend({_initialize:function(objects){this._objects=_.uniq(objects)},objects:function(){return this._objects},toJSON:function(){return{__op:"AddUnique",objects:Parse._encode(this.objects())}},_mergeWithPrevious:function(previous){if(previous){if(previous instanceof Parse.Op.Unset)return new Parse.Op.Set(this.objects());if(previous instanceof Parse.Op.Set)return new Parse.Op.Set(this._estimate(previous.value()));if(previous instanceof Parse.Op.AddUnique)return new Parse.Op.AddUnique(this._estimate(previous.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(oldValue){if(oldValue){var newValue=_.clone(oldValue);return Parse._arrayEach(this.objects(),function(obj){if(obj instanceof Parse.Object&&obj.id){var matchingObj=_.find(newValue,function(anObj){return anObj instanceof Parse.Object&&anObj.id===obj.id});if(matchingObj){var index=_.indexOf(newValue,matchingObj);newValue[index]=obj}else newValue.push(obj)}else _.contains(newValue,obj)||newValue.push(obj)}),newValue}return _.clone(this.objects())}}),Parse.Op._registerDecoder("AddUnique",function(json){return new Parse.Op.AddUnique(Parse._decode(void 0,json.objects))}),Parse.Op.Remove=Parse.Op._extend({_initialize:function(objects){this._objects=_.uniq(objects)},objects:function(){return this._objects},toJSON:function(){return{__op:"Remove",objects:Parse._encode(this.objects())}},_mergeWithPrevious:function(previous){if(previous){if(previous instanceof Parse.Op.Unset)return previous;if(previous instanceof Parse.Op.Set)return new Parse.Op.Set(this._estimate(previous.value()));if(previous instanceof Parse.Op.Remove)return new Parse.Op.Remove(_.union(previous.objects(),this.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(oldValue){if(oldValue){var newValue=_.difference(oldValue,this.objects());return Parse._arrayEach(this.objects(),function(obj){obj instanceof Parse.Object&&obj.id&&(newValue=_.reject(newValue,function(other){return other instanceof Parse.Object&&other.id===obj.id}))}),newValue}return[]}}),Parse.Op._registerDecoder("Remove",function(json){return new Parse.Op.Remove(Parse._decode(void 0,json.objects))}),Parse.Op.Relation=Parse.Op._extend({_initialize:function(adds,removes){this._targetClassName=null;var self=this,pointerToId=function(object){if(object instanceof Parse.Object){if(!object.id)throw"You can't add an unsaved Parse.Object to a relation.";if(self._targetClassName||(self._targetClassName=object.className),self._targetClassName!==object.className)throw"Tried to create a Parse.Relation with 2 different types: "+self._targetClassName+" and "+object.className+".";return object.id}return object};this.relationsToAdd=_.uniq(_.map(adds,pointerToId)),this.relationsToRemove=_.uniq(_.map(removes,pointerToId))},added:function(){var self=this;return _.map(this.relationsToAdd,function(objectId){var object=Parse.Object._create(self._targetClassName);return object.id=objectId,object})},removed:function(){var self=this;return _.map(this.relationsToRemove,function(objectId){var object=Parse.Object._create(self._targetClassName);return object.id=objectId,object})},toJSON:function(){var adds=null,removes=null,self=this,idToPointer=function(id){return{__type:"Pointer",className:self._targetClassName,objectId:id}},pointers=null;return this.relationsToAdd.length>0&&(pointers=_.map(this.relationsToAdd,idToPointer),adds={__op:"AddRelation",objects:pointers}),this.relationsToRemove.length>0&&(pointers=_.map(this.relationsToRemove,idToPointer),removes={__op:"RemoveRelation",objects:pointers}),adds&&removes?{__op:"Batch",ops:[adds,removes]}:adds||removes||{}},_mergeWithPrevious:function(previous){if(previous){if(previous instanceof Parse.Op.Unset)throw"You can't modify a relation after deleting it.";if(previous instanceof Parse.Op.Relation){if(previous._targetClassName&&previous._targetClassName!==this._targetClassName)throw"Related object must be of class "+previous._targetClassName+", but "+this._targetClassName+" was passed in.";var newAdd=_.union(_.difference(previous.relationsToAdd,this.relationsToRemove),this.relationsToAdd),newRemove=_.union(_.difference(previous.relationsToRemove,this.relationsToAdd),this.relationsToRemove),newRelation=new Parse.Op.Relation(newAdd,newRemove);return newRelation._targetClassName=this._targetClassName,newRelation}throw"Op is invalid after previous op."}return this},_estimate:function(oldValue,object,key){if(oldValue){if(oldValue instanceof Parse.Relation){if(this._targetClassName)if(oldValue.targetClassName){if(oldValue.targetClassName!==this._targetClassName)throw"Related object must be a "+oldValue.targetClassName+", but a "+this._targetClassName+" was passed in."}else oldValue.targetClassName=this._targetClassName;return oldValue}throw"Op is invalid after previous op."}var relation=new Parse.Relation(object,key);relation.targetClassName=this._targetClassName}}),Parse.Op._registerDecoder("AddRelation",function(json){return new Parse.Op.Relation(Parse._decode(void 0,json.objects),[])}),Parse.Op._registerDecoder("RemoveRelation",function(json){return new Parse.Op.Relation([],Parse._decode(void 0,json.objects))})}(this),function(root){root.Parse=root.Parse||{};var Parse=root.Parse,_=Parse._;Parse.Relation=function(parent,key){this.parent=parent,this.key=key,this.targetClassName=null},Parse.Relation.prototype={_ensureParentAndKey:function(parent,key){if(this.parent=this.parent||parent,this.key=this.key||key,this.parent!==parent)throw"Internal Error. Relation retrieved from two different Objects.";if(this.key!==key)throw"Internal Error. Relation retrieved from two different keys."},add:function(objects){_.isArray(objects)||(objects=[objects]);var change=new Parse.Op.Relation(objects,[]);this.parent.set(this.key,change),this.targetClassName=change._targetClassName},remove:function(objects){_.isArray(objects)||(objects=[objects]);var change=new Parse.Op.Relation([],objects);this.parent.set(this.key,change),this.targetClassName=change._targetClassName},toJSON:function(){return{__type:"Relation",className:this.targetClassName}},query:function(){var targetClass,query;return this.targetClassName?(targetClass=Parse.Object._getSubclass(this.targetClassName),query=new Parse.Query(targetClass)):(targetClass=Parse.Object._getSubclass(this.parent.className),query=new Parse.Query(targetClass),query._extraOptions.redirectClassNameForKey=this.key),query._addCondition("$relatedTo","object",this.parent._toPointer()),query._addCondition("$relatedTo","key",this.key),query}}}(this),function(root){root.Parse=root.Parse||{};var Parse=root.Parse,_=Parse._;Parse.Promise=function(){this._resolved=!1,this._rejected=!1,this._resolvedCallbacks=[],this._rejectedCallbacks=[]},_.extend(Parse.Promise,{is:function(promise){return promise&&promise.then&&_.isFunction(promise.then)},as:function(){var promise=new Parse.Promise;return promise.resolve.apply(promise,arguments),promise},error:function(){var promise=new Parse.Promise;return promise.reject.apply(promise,arguments),promise},when:function(promises){var objects;objects=promises&&Parse._isNullOrUndefined(promises.length)?arguments:promises;var total=objects.length,hadError=!1,results=[],errors=[];if(results.length=objects.length,errors.length=objects.length,0===total)return Parse.Promise.as.apply(this,results);var promise=new Parse.Promise,resolveOne=function(){total-=1,0===total&&(hadError?promise.reject(errors):promise.resolve.apply(promise,results))};return Parse._arrayEach(objects,function(object,i){Parse.Promise.is(object)?object.then(function(result){results[i]=result,resolveOne()},function(error){errors[i]=error,hadError=!0,resolveOne()}):(results[i]=object,resolveOne())}),promise},_continueWhile:function(predicate,asyncFunction){return predicate()?asyncFunction().then(function(){return Parse.Promise._continueWhile(predicate,asyncFunction)}):Parse.Promise.as()}}),_.extend(Parse.Promise.prototype,{resolve:function(){if(this._resolved||this._rejected)throw"A promise was resolved even though it had already been "+(this._resolved?"resolved":"rejected")+".";this._resolved=!0,this._result=arguments;var results=arguments;Parse._arrayEach(this._resolvedCallbacks,function(resolvedCallback){resolvedCallback.apply(this,results)}),this._resolvedCallbacks=[],this._rejectedCallbacks=[]},reject:function(error){if(this._resolved||this._rejected)throw"A promise was rejected even though it had already been "+(this._resolved?"resolved":"rejected")+".";this._rejected=!0,this._error=error,Parse._arrayEach(this._rejectedCallbacks,function(rejectedCallback){rejectedCallback(error)}),this._resolvedCallbacks=[],this._rejectedCallbacks=[]},then:function(resolvedCallback,rejectedCallback){var promise=new Parse.Promise,wrappedResolvedCallback=function(){var result=arguments;resolvedCallback&&(result=[resolvedCallback.apply(this,result)]),1===result.length&&Parse.Promise.is(result[0])?result[0].then(function(){promise.resolve.apply(promise,arguments)},function(error){promise.reject(error)}):promise.resolve.apply(promise,result)},wrappedRejectedCallback=function(error){var result=[];rejectedCallback?(result=[rejectedCallback(error)],1===result.length&&Parse.Promise.is(result[0])?result[0].then(function(){promise.resolve.apply(promise,arguments)},function(error){promise.reject(error)}):promise.reject(result[0])):promise.reject(error)};return this._resolved?wrappedResolvedCallback.apply(this,this._result):this._rejected?wrappedRejectedCallback(this._error):(this._resolvedCallbacks.push(wrappedResolvedCallback),this._rejectedCallbacks.push(wrappedRejectedCallback)),promise},always:function(callback){return this.then(callback,callback)},done:function(callback){return this.then(callback)},fail:function(callback){return this.then(null,callback)},_thenRunCallbacks:function(optionsOrCallback,model){var options;if(_.isFunction(optionsOrCallback)){var callback=optionsOrCallback;options={success:function(result){callback(result,null)},error:function(error){callback(null,error)}}}else options=_.clone(optionsOrCallback);return options=options||{},this.then(function(result){return options.success?options.success.apply(this,arguments):model&&model.trigger("sync",model,result,options),Parse.Promise.as.apply(Parse.Promise,arguments)},function(error){return options.error?_.isUndefined(model)?options.error(error):options.error(model,error):model&&model.trigger("error",model,error,options),Parse.Promise.error(error)})},_continueWith:function(continuation){return this.then(function(){return continuation(arguments,null)},function(error){return continuation(null,error)})}})}(this),function(root){root.Parse=root.Parse||{};var Parse=root.Parse,_=Parse._,b64Digit=function(number){if(26>number)return String.fromCharCode(65+number);if(52>number)return String.fromCharCode(97+(number-26));if(62>number)return String.fromCharCode(48+(number-52));if(62===number)return"+";if(63===number)return"/";throw"Tried to encode large digit "+number+" in base64."},encodeBase64=function(array){var chunks=[];return chunks.length=Math.ceil(array.length/3),_.times(chunks.length,function(i){var b1=array[3*i],b2=array[3*i+1]||0,b3=array[3*i+2]||0,has2=3*i+1<array.length,has3=3*i+2<array.length;chunks[i]=[b64Digit(b1>>2&63),b64Digit(b1<<4&48|b2>>4&15),has2?b64Digit(b2<<2&60|b3>>6&3):"=",has3?b64Digit(63&b3):"="].join("")}),chunks.join("")},mimeTypes={ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",asc:"text/plain",atom:"application/atom+xml",au:"audio/basic",avi:"video/x-msvideo",bcpio:"application/x-bcpio",bin:"application/octet-stream",bmp:"image/bmp",cdf:"application/x-netcdf",cgm:"image/cgm","class":"application/octet-stream",cpio:"application/x-cpio",cpt:"application/mac-compactpro",csh:"application/x-csh",css:"text/css",dcr:"application/x-director",dif:"video/x-dv",dir:"application/x-director",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dll:"application/octet-stream",dmg:"application/octet-stream",dms:"application/octet-stream",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",docm:"application/vnd.ms-word.document.macroEnabled.12",dotm:"application/vnd.ms-word.template.macroEnabled.12",dtd:"application/xml-dtd",dv:"video/x-dv",dvi:"application/x-dvi",dxr:"application/x-director",eps:"application/postscript",etx:"text/x-setext",exe:"application/octet-stream",ez:"application/andrew-inset",gif:"image/gif",gram:"application/srgs",grxml:"application/srgs+xml",gtar:"application/x-gtar",hdf:"application/x-hdf",hqx:"application/mac-binhex40",htm:"text/html",html:"text/html",ice:"x-conference/x-cooltalk",ico:"image/x-icon",ics:"text/calendar",ief:"image/ief",ifb:"text/calendar",iges:"model/iges",igs:"model/iges",jnlp:"application/x-java-jnlp-file",jp2:"image/jp2",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/x-javascript",kar:"audio/midi",latex:"application/x-latex",lha:"application/octet-stream",lzh:"application/octet-stream",m3u:"audio/x-mpegurl",m4a:"audio/mp4a-latm",m4b:"audio/mp4a-latm",m4p:"audio/mp4a-latm",m4u:"video/vnd.mpegurl",m4v:"video/x-m4v",mac:"image/x-macpaint",man:"application/x-troff-man",mathml:"application/mathml+xml",me:"application/x-troff-me",mesh:"model/mesh",mid:"audio/midi",midi:"audio/midi",mif:"application/vnd.mif",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpe:"video/mpeg",mpeg:"video/mpeg",mpg:"video/mpeg",mpga:"audio/mpeg",ms:"application/x-troff-ms",msh:"model/mesh",mxu:"video/vnd.mpegurl",nc:"application/x-netcdf",oda:"application/oda",ogg:"application/ogg",pbm:"image/x-portable-bitmap",pct:"image/pict",pdb:"chemical/x-pdb",pdf:"application/pdf",pgm:"image/x-portable-graymap",pgn:"application/x-chess-pgn",pic:"image/pict",pict:"image/pict",png:"image/png",pnm:"image/x-portable-anymap",pnt:"image/x-macpaint",pntg:"image/x-macpaint",ppm:"image/x-portable-pixmap",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppam:"application/vnd.ms-powerpoint.addin.macroEnabled.12",pptm:"application/vnd.ms-powerpoint.presentation.macroEnabled.12",potm:"application/vnd.ms-powerpoint.template.macroEnabled.12",ppsm:"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",ps:"application/postscript",qt:"video/quicktime",qti:"image/x-quicktime",qtif:"image/x-quicktime",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",ras:"image/x-cmu-raster",rdf:"application/rdf+xml",rgb:"image/x-rgb",rm:"application/vnd.rn-realmedia",roff:"application/x-troff",rtf:"text/rtf",rtx:"text/richtext",sgm:"text/sgml",sgml:"text/sgml",sh:"application/x-sh",shar:"application/x-shar",silo:"model/mesh",sit:"application/x-stuffit",skd:"application/x-koan",skm:"application/x-koan",skp:"application/x-koan",skt:"application/x-koan",smi:"application/smil",smil:"application/smil",snd:"audio/basic",so:"application/octet-stream",spl:"application/x-futuresplash",src:"application/x-wais-source",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",swf:"application/x-shockwave-flash",t:"application/x-troff",tar:"application/x-tar",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",tif:"image/tiff",tiff:"image/tiff",tr:"application/x-troff",tsv:"text/tab-separated-values",txt:"text/plain",ustar:"application/x-ustar",vcd:"application/x-cdlink",vrml:"model/vrml",vxml:"application/voicexml+xml",wav:"audio/x-wav",wbmp:"image/vnd.wap.wbmp",wbmxl:"application/vnd.wap.wbxml",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlscript",wmlsc:"application/vnd.wap.wmlscriptc",wrl:"model/vrml",xbm:"image/x-xbitmap",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.12",xltm:"application/vnd.ms-excel.template.macroEnabled.12",xlam:"application/vnd.ms-excel.addin.macroEnabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.12",xslt:"application/xslt+xml",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",xyz:"chemical/x-xyz",zip:"application/zip"},readAsync=function(file,type){var promise=new Parse.Promise;if("undefined"==typeof FileReader)return Parse.Promise.error(new Parse.Error(Parse.Error.FILE_READ_ERROR,"Attempted to use a FileReader on an unsupported browser."));var reader=new FileReader;return reader.onloadend=function(){if(2!==reader.readyState)return void promise.reject(new Parse.Error(Parse.Error.FILE_READ_ERROR,"Error reading file."));var dataURL=reader.result,matches=/^data:([^;]*);base64,(.*)$/.exec(dataURL);return matches?void promise.resolve(matches[2],type||matches[1]):void promise.reject(new Parse.Error(Parse.ERROR.FILE_READ_ERROR,"Unable to interpret data URL: "+dataURL))},reader.readAsDataURL(file),promise};Parse.File=function(name,data,type){this._name=name;var extension=/\.([^.]*)$/.exec(name);extension&&(extension=extension[1].toLowerCase());var guessedType=type||mimeTypes[extension]||"text/plain";if(_.isArray(data))this._source=Parse.Promise.as(encodeBase64(data),guessedType);else if(data&&data.base64){var dataUriRegexp=/^data:([a-zA-Z]*\/[a-zA-Z+.-]*);(charset=[a-zA-Z0-9\-\/\s]*,)?base64,(\S+)/,matches=dataUriRegexp.exec(data.base64);this._source=matches&&matches.length>0?Parse.Promise.as(4===matches.length?matches[3]:matches[2],matches[1]):Parse.Promise.as(data.base64,guessedType)}else if("undefined"!=typeof File&&data instanceof File)this._source=readAsync(data,type);else if(_.isString(data))throw"Creating a Parse.File from a String is not yet supported."},Parse.File.prototype={name:function(){return this._name},url:function(){return this._url},save:function(options){options=options||{};var self=this;return self._previousSave||(self._previousSave=self._source.then(function(base64,type){var data={base64:base64,_ContentType:type};return Parse._request({route:"files",className:self._name,method:"POST",data:data,useMasterKey:options.useMasterKey,onProgress:options.onProgress})}).then(function(response){return self._name=response.name,self._url=response.url,self})),self._previousSave._thenRunCallbacks(options)}}}(this),function(root){root.Parse=root.Parse||{};var Parse=root.Parse,_=Parse._;Parse.Object=function(attributes,options){if(_.isString(attributes))return Parse.Object._create.apply(this,arguments);attributes=attributes||{},options&&options.parse&&(attributes=this.parse(attributes));var defaults=Parse._getValue(this,"defaults");if(defaults&&(attributes=_.extend({},defaults,attributes)),options&&options.collection&&(this.collection=options.collection),this._serverData={},this._opSetQueue=[{}],this.attributes={},this._hashedJSON={},this._escapedAttributes={},this.cid=_.uniqueId("c"),this.changed={},this._silent={},this._pending={},!this.set(attributes,{silent:!0}))throw new Error("Can't create an invalid Parse.Object");this.changed={},this._silent={},this._pending={},this._hasData=!0,this._previousAttributes=_.clone(this.attributes),this.initialize.apply(this,arguments)},Parse.Object.saveAll=function(list,options){return options=options||{},Parse.Object._deepSaveAsync(list,{useMasterKey:options.useMasterKey})._thenRunCallbacks(options)},Parse.Object.destroyAll=function(list,options){options=options||{};var triggerDestroy=function(object){object.trigger("destroy",object,object.collection,options)},errors=[],destroyBatch=function(batch){var promise=Parse.Promise.as();return batch.length>0&&(promise=promise.then(function(){return Parse._request({route:"batch",method:"POST",useMasterKey:options.useMasterKey,data:{requests:_.map(batch,function(object){return{method:"DELETE",path:"/1/classes/"+object.className+"/"+object.id}
})}})}).then(function(responses){Parse._arrayEach(batch,function(object,i){if(responses[i].success&&options.wait)triggerDestroy(object);else if(responses[i].error){var error=new Parse.Error(responses[i].error.code,responses[i].error.error);error.object=object,errors.push(error)}})})),promise},promise=Parse.Promise.as(),batch=[];return Parse._arrayEach(list,function(object,i){if(object.id&&options.wait||triggerDestroy(object),object.id&&batch.push(object),20===batch.length||i+1===list.length){var thisBatch=batch;batch=[],promise=promise.then(function(){return destroyBatch(thisBatch)})}}),promise.then(function(){if(0===errors.length)return!0;var error=new Parse.Error(Parse.Error.AGGREGATE_ERROR,"Error deleting an object in destroyAll");return error.errors=errors,Parse.Promise.error(error)})._thenRunCallbacks(options)},Parse.Object.fetchAll=function(list,options){return Parse.Object._fetchAll(list,!0)._thenRunCallbacks(options)},Parse.Object.fetchAllIfNeeded=function(list,options){return Parse.Object._fetchAll(list,!1)._thenRunCallbacks(options)},_.extend(Parse.Object.prototype,Parse.Events,{_existed:!1,initialize:function(){},toJSON:function(){var json=this._toFullJSON();return Parse._arrayEach(["__type","className"],function(key){delete json[key]}),json},_toFullJSON:function(seenObjects){var json=_.clone(this.attributes);return Parse._objectEach(json,function(val,key){json[key]=Parse._encode(val,seenObjects)}),Parse._objectEach(this._operations,function(val,key){json[key]=val}),_.has(this,"id")&&(json.objectId=this.id),_.has(this,"createdAt")&&(json.createdAt=_.isDate(this.createdAt)?this.createdAt.toJSON():this.createdAt),_.has(this,"updatedAt")&&(json.updatedAt=_.isDate(this.updatedAt)?this.updatedAt.toJSON():this.updatedAt),json.__type="Object",json.className=this.className,json},_refreshCache:function(){var self=this;self._refreshingCache||(self._refreshingCache=!0,Parse._objectEach(this.attributes,function(value,key){value instanceof Parse.Object?value._refreshCache():_.isObject(value)&&self._resetCacheForKey(key)&&self.set(key,new Parse.Op.Set(value),{silent:!0})}),delete self._refreshingCache)},dirty:function(attr){this._refreshCache();var currentChanges=_.last(this._opSetQueue);return attr?currentChanges[attr]?!0:!1:this.id?_.keys(currentChanges).length>0?!0:!1:!0},dirtyKeys:function(){return _.keys(_.last(this._opSetQueue))},_toPointer:function(){if(!this.id)throw new Error("Can't serialize an unsaved Parse.Object");return{__type:"Pointer",className:this.className,objectId:this.id}},get:function(attr){return this.attributes[attr]},relation:function(attr){var value=this.get(attr);if(value){if(!(value instanceof Parse.Relation))throw"Called relation() on non-relation field "+attr;return value._ensureParentAndKey(this,attr),value}return new Parse.Relation(this,attr)},escape:function(attr){var html=this._escapedAttributes[attr];if(html)return html;var escaped,val=this.attributes[attr];return escaped=Parse._isNullOrUndefined(val)?"":_.escape(val.toString()),this._escapedAttributes[attr]=escaped,escaped},has:function(attr){return!Parse._isNullOrUndefined(this.attributes[attr])},_mergeMagicFields:function(attrs){var model=this,specialFields=["id","objectId","createdAt","updatedAt"];Parse._arrayEach(specialFields,function(attr){attrs[attr]&&("objectId"===attr?model.id=attrs[attr]:model[attr]="createdAt"!==attr&&"updatedAt"!==attr||_.isDate(attrs[attr])?attrs[attr]:Parse._parseDate(attrs[attr]),delete attrs[attr])})},_copyServerData:function(serverData){var tempServerData={};Parse._objectEach(serverData,function(value,key){tempServerData[key]=Parse._decode(key,value)}),this._serverData=tempServerData,this._rebuildAllEstimatedData(),this._refreshCache(),this._opSetQueue=[{}],this._rebuildAllEstimatedData()},_mergeFromObject:function(other){other&&(this.id=other.id,this.createdAt=other.createdAt,this.updatedAt=other.updatedAt,this._copyServerData(other._serverData),this._hasData=!0)},_startSave:function(){this._opSetQueue.push({})},_cancelSave:function(){var failedChanges=_.first(this._opSetQueue);this._opSetQueue=_.rest(this._opSetQueue);var nextChanges=_.first(this._opSetQueue);Parse._objectEach(failedChanges,function(op,key){var op1=failedChanges[key],op2=nextChanges[key];op1&&op2?nextChanges[key]=op2._mergeWithPrevious(op1):op1&&(nextChanges[key]=op1)}),this._saving=this._saving-1},_finishSave:function(serverData){var fetchedObjects={};Parse._traverse(this.attributes,function(object){object instanceof Parse.Object&&object.id&&object._hasData&&(fetchedObjects[object.id]=object)});var savedChanges=_.first(this._opSetQueue);this._opSetQueue=_.rest(this._opSetQueue),this._applyOpSet(savedChanges,this._serverData),this._mergeMagicFields(serverData);var self=this;Parse._objectEach(serverData,function(value,key){self._serverData[key]=Parse._decode(key,value);var fetched=Parse._traverse(self._serverData[key],function(object){return object instanceof Parse.Object&&fetchedObjects[object.id]?fetchedObjects[object.id]:void 0});fetched&&(self._serverData[key]=fetched)}),this._rebuildAllEstimatedData(),this._saving=this._saving-1},_finishFetch:function(serverData,hasData){this._opSetQueue=[{}],this._mergeMagicFields(serverData),this._copyServerData(serverData),this._hasData=hasData},_applyOpSet:function(opSet,target){var self=this;Parse._objectEach(opSet,function(change,key){target[key]=change._estimate(target[key],self,key),target[key]===Parse.Op._UNSET&&delete target[key]})},_resetCacheForKey:function(key){var value=this.attributes[key];if(!(!_.isObject(value)||value instanceof Parse.Object||value instanceof Parse.File)){value=value.toJSON?value.toJSON():value;var json=JSON.stringify(value);if(this._hashedJSON[key]!==json){var wasSet=!!this._hashedJSON[key];return this._hashedJSON[key]=json,wasSet}}return!1},_rebuildEstimatedDataForKey:function(key){var self=this;delete this.attributes[key],this._serverData[key]&&(this.attributes[key]=this._serverData[key]),Parse._arrayEach(this._opSetQueue,function(opSet){var op=opSet[key];op&&(self.attributes[key]=op._estimate(self.attributes[key],self,key),self.attributes[key]===Parse.Op._UNSET?delete self.attributes[key]:self._resetCacheForKey(key))})},_rebuildAllEstimatedData:function(){var self=this,previousAttributes=_.clone(this.attributes);this.attributes=_.clone(this._serverData),Parse._arrayEach(this._opSetQueue,function(opSet){self._applyOpSet(opSet,self.attributes),Parse._objectEach(opSet,function(op,key){self._resetCacheForKey(key)})}),Parse._objectEach(previousAttributes,function(oldValue,key){self.attributes[key]!==oldValue&&self.trigger("change:"+key,self,self.attributes[key],{})}),Parse._objectEach(this.attributes,function(newValue,key){_.has(previousAttributes,key)||self.trigger("change:"+key,self,newValue,{})})},set:function(key,value,options){var attrs;if(_.isObject(key)||Parse._isNullOrUndefined(key)?(attrs=key,Parse._objectEach(attrs,function(v,k){attrs[k]=Parse._decode(k,v)}),options=value):(attrs={},attrs[key]=Parse._decode(key,value)),options=options||{},!attrs)return this;attrs instanceof Parse.Object&&(attrs=attrs.attributes),options.unset&&Parse._objectEach(attrs,function(unused_value,key){attrs[key]=new Parse.Op.Unset});var dataToValidate=_.clone(attrs),self=this;if(Parse._objectEach(dataToValidate,function(value,key){value instanceof Parse.Op&&(dataToValidate[key]=value._estimate(self.attributes[key],self,key),dataToValidate[key]===Parse.Op._UNSET&&delete dataToValidate[key])}),!this._validate(attrs,options))return!1;this._mergeMagicFields(attrs),options.changes={};{var escaped=this._escapedAttributes;this._previousAttributes||{}}return Parse._arrayEach(_.keys(attrs),function(attr){var val=attrs[attr];val instanceof Parse.Relation&&(val.parent=self),val instanceof Parse.Op||(val=new Parse.Op.Set(val));var isRealChange=!0;val instanceof Parse.Op.Set&&_.isEqual(self.attributes[attr],val.value)&&(isRealChange=!1),isRealChange&&(delete escaped[attr],options.silent?self._silent[attr]=!0:options.changes[attr]=!0);var currentChanges=_.last(self._opSetQueue);currentChanges[attr]=val._mergeWithPrevious(currentChanges[attr]),self._rebuildEstimatedDataForKey(attr),isRealChange?(self.changed[attr]=self.attributes[attr],options.silent||(self._pending[attr]=!0)):(delete self.changed[attr],delete self._pending[attr])}),options.silent||this.change(options),this},unset:function(attr,options){return options=options||{},options.unset=!0,this.set(attr,null,options)},increment:function(attr,amount){return(_.isUndefined(amount)||_.isNull(amount))&&(amount=1),this.set(attr,new Parse.Op.Increment(amount))},add:function(attr,item){return this.set(attr,new Parse.Op.Add([item]))},addUnique:function(attr,item){return this.set(attr,new Parse.Op.AddUnique([item]))},remove:function(attr,item){return this.set(attr,new Parse.Op.Remove([item]))},op:function(attr){return _.last(this._opSetQueue)[attr]},clear:function(options){options=options||{},options.unset=!0;var keysToClear=_.extend(this.attributes,this._operations);return this.set(keysToClear,options)},_getSaveJSON:function(){var json=_.clone(_.first(this._opSetQueue));return Parse._objectEach(json,function(op,key){json[key]=op.toJSON()}),json},_canBeSerialized:function(){return Parse.Object._canBeSerializedAsValue(this.attributes)},fetch:function(options){var self=this;options=options||{};var request=Parse._request({method:"GET",route:"classes",className:this.className,objectId:this.id,useMasterKey:options.useMasterKey});return request.then(function(response,status,xhr){return self._finishFetch(self.parse(response,status,xhr),!0),self})._thenRunCallbacks(options,this)},save:function(arg1,arg2,arg3){var attrs,current,options;if(_.isObject(arg1)||Parse._isNullOrUndefined(arg1)?(attrs=arg1,options=arg2):(attrs={},attrs[arg1]=arg2,options=arg3),!options&&attrs){var extra_keys=_.reject(attrs,function(value,key){return _.include(["success","error","wait"],key)});if(0===extra_keys.length){var all_functions=!0;if(_.has(attrs,"success")&&!_.isFunction(attrs.success)&&(all_functions=!1),_.has(attrs,"error")&&!_.isFunction(attrs.error)&&(all_functions=!1),all_functions)return this.save(null,attrs)}}options=_.clone(options)||{},options.wait&&(current=_.clone(this.attributes));var setOptions=_.clone(options)||{};setOptions.wait&&(setOptions.silent=!0);var setError;if(setOptions.error=function(model,error){setError=error},attrs&&!this.set(attrs,setOptions))return Parse.Promise.error(setError)._thenRunCallbacks(options,this);var model=this;model._refreshCache();var unsavedChildren=[],unsavedFiles=[];return Parse.Object._findUnsavedChildren(model.attributes,unsavedChildren,unsavedFiles),unsavedChildren.length+unsavedFiles.length>0?Parse.Object._deepSaveAsync(this.attributes,{useMasterKey:options.useMasterKey}).then(function(){return model.save(null,options)},function(error){return Parse.Promise.error(error)._thenRunCallbacks(options,model)}):(this._startSave(),this._saving=(this._saving||0)+1,this._allPreviousSaves=this._allPreviousSaves||Parse.Promise.as(),this._allPreviousSaves=this._allPreviousSaves._continueWith(function(){var method=model.id?"PUT":"POST",json=model._getSaveJSON(),route="classes",className=model.className;"_User"!==model.className||model.id||(route="users",className=null);var request=Parse._request({route:route,className:className,objectId:model.id,method:method,useMasterKey:options.useMasterKey,data:json});return request=request.then(function(resp,status,xhr){var serverAttrs=model.parse(resp,status,xhr);return options.wait&&(serverAttrs=_.extend(attrs||{},serverAttrs)),model._finishSave(serverAttrs),options.wait&&model.set(current,setOptions),model},function(error){return model._cancelSave(),Parse.Promise.error(error)})._thenRunCallbacks(options,model)}),this._allPreviousSaves)},destroy:function(options){options=options||{};var model=this,triggerDestroy=function(){model.trigger("destroy",model,model.collection,options)};if(!this.id)return triggerDestroy();options.wait||triggerDestroy();var request=Parse._request({route:"classes",className:this.className,objectId:this.id,method:"DELETE",useMasterKey:options.useMasterKey});return request.then(function(){return options.wait&&triggerDestroy(),model})._thenRunCallbacks(options,this)},parse:function(resp,status){var output=_.clone(resp);return _(["createdAt","updatedAt"]).each(function(key){output[key]&&(output[key]=Parse._parseDate(output[key]))}),output.updatedAt||(output.updatedAt=output.createdAt),status&&(this._existed=201!==status),output},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.id},change:function(options){options=options||{};var changing=this._changing;this._changing=!0;var self=this;Parse._objectEach(this._silent,function(attr){self._pending[attr]=!0});var changes=_.extend({},options.changes,this._silent);if(this._silent={},Parse._objectEach(changes,function(unused_value,attr){self.trigger("change:"+attr,self,self.get(attr),options)}),changing)return this;for(var deleteChanged=function(value,attr){self._pending[attr]||self._silent[attr]||delete self.changed[attr]};!_.isEmpty(this._pending);)this._pending={},this.trigger("change",this,options),Parse._objectEach(this.changed,deleteChanged),self._previousAttributes=_.clone(this.attributes);return this._changing=!1,this},existed:function(){return this._existed},hasChanged:function(attr){return arguments.length?this.changed&&_.has(this.changed,attr):!_.isEmpty(this.changed)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):!1;var changed={},old=this._previousAttributes;return Parse._objectEach(diff,function(diffVal,attr){_.isEqual(old[attr],diffVal)||(changed[attr]=diffVal)}),changed},previous:function(attr){return arguments.length&&this._previousAttributes?this._previousAttributes[attr]:null},previousAttributes:function(){return _.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},validate:function(attrs){var correct=!0;return Parse._objectEach(attrs,function(unused_value,key){/^[A-Za-z][0-9A-Za-z_]*$/.test(key)||(correct=!1)}),correct?!1:new Parse.Error(Parse.Error.INVALID_KEY_NAME)},_validate:function(attrs,options){if(options.silent||!this.validate)return!0;attrs=_.extend({},this.attributes,attrs);var error=this.validate(attrs,options);return error?(options&&options.error?options.error(this,error,options):this.trigger("error",this,error,options),!1):!0},getACL:function(){return this.get("ACL")},setACL:function(acl,options){return this.set("ACL",acl,options)}}),Parse.Object._getSubclass=function(className){if(!_.isString(className))throw"Parse.Object._getSubclass requires a string argument.";var ObjectClass=Parse.Object._classMap[className];return ObjectClass||(ObjectClass=Parse.Object.extend(className),Parse.Object._classMap[className]=ObjectClass),ObjectClass},Parse.Object._create=function(className,attributes,options){var ObjectClass=Parse.Object._getSubclass(className);return new ObjectClass(attributes,options)},Parse.Object._toObjectIdArray=function(list,omitObjectsWithData){if(0===list.length)return Parse.Promise.as(list);for(var error,className=list[0].className,objectIds=[],i=0;i<list.length;i++){var object=list[i];if(className!==object.className)return error=new Parse.Error(Parse.Error.INVALID_CLASS_NAME,"All objects should be of the same class"),Parse.Promise.error(error);if(!object.id)return error=new Parse.Error(Parse.Error.MISSING_OBJECT_ID,"All objects must have an ID"),Parse.Promise.error(error);omitObjectsWithData&&object._hasData||objectIds.push(object.id)}return Parse.Promise.as(objectIds)},Parse.Object._updateWithFetchedResults=function(list,fetched,forceFetch){var fetchedObjectsById={};Parse._arrayEach(fetched,function(object){fetchedObjectsById[object.id]=object});for(var i=0;i<list.length;i++){var object=list[i],fetchedObject=fetchedObjectsById[object.id];if(!fetchedObject&&forceFetch){var error=new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,"All objects must exist on the server");return Parse.Promise.error(error)}object._mergeFromObject(fetchedObject)}return Parse.Promise.as(list)},Parse.Object._fetchAll=function(list,forceFetch){if(0===list.length)return Parse.Promise.as(list);var omitObjectsWithData=!forceFetch;return Parse.Object._toObjectIdArray(list,omitObjectsWithData).then(function(objectIds){var className=list[0].className,query=new Parse.Query(className);return query.containedIn("objectId",objectIds),query.limit=objectIds.length,query.find()}).then(function(results){return Parse.Object._updateWithFetchedResults(list,results,forceFetch)})},Parse.Object._classMap={},Parse.Object._extend=Parse._extend,Parse.Object.extend=function(className,protoProps,classProps){if(!_.isString(className)){if(className&&_.has(className,"className"))return Parse.Object.extend(className.className,className,protoProps);throw new Error("Parse.Object.extend's first argument should be the className.")}"User"===className&&Parse.User._performUserRewrite&&(className="_User"),protoProps=protoProps||{},protoProps.className=className;var NewClassObject=null;if(_.has(Parse.Object._classMap,className)){var OldClassObject=Parse.Object._classMap[className];NewClassObject=OldClassObject._extend(protoProps,classProps)}else NewClassObject=this._extend(protoProps,classProps);return NewClassObject.extend=function(arg0){if(_.isString(arg0)||arg0&&_.has(arg0,"className"))return Parse.Object.extend.apply(NewClassObject,arguments);var newArguments=[className].concat(Parse._.toArray(arguments));return Parse.Object.extend.apply(NewClassObject,newArguments)},Parse.Object._classMap[className]=NewClassObject,NewClassObject},Parse.Object._findUnsavedChildren=function(object,children,files){Parse._traverse(object,function(object){return object instanceof Parse.Object?(object._refreshCache(),void(object.dirty()&&children.push(object))):object instanceof Parse.File?void(object.url()||files.push(object)):void 0})},Parse.Object._canBeSerializedAsValue=function(object){if(object instanceof Parse.Object)return!!object.id;if(object instanceof Parse.File)return!0;var canBeSerializedAsValue=!0;return _.isArray(object)?Parse._arrayEach(object,function(child){Parse.Object._canBeSerializedAsValue(child)||(canBeSerializedAsValue=!1)}):_.isObject(object)&&Parse._objectEach(object,function(child){Parse.Object._canBeSerializedAsValue(child)||(canBeSerializedAsValue=!1)}),canBeSerializedAsValue},Parse.Object._deepSaveAsync=function(object,options){var unsavedChildren=[],unsavedFiles=[];Parse.Object._findUnsavedChildren(object,unsavedChildren,unsavedFiles);var promise=Parse.Promise.as();_.each(unsavedFiles,function(file){promise=promise.then(function(){return file.save(options)})});var objects=_.uniq(unsavedChildren),remaining=_.uniq(objects);return promise.then(function(){return Parse.Promise._continueWhile(function(){return remaining.length>0},function(){var batch=[],newRemaining=[];if(Parse._arrayEach(remaining,function(object){return batch.length>20?void newRemaining.push(object):void(object._canBeSerialized()?batch.push(object):newRemaining.push(object))}),remaining=newRemaining,0===batch.length)return Parse.Promise.error(new Parse.Error(Parse.Error.OTHER_CAUSE,"Tried to save a batch with a cycle."));var readyToStart=Parse.Promise.when(_.map(batch,function(object){return object._allPreviousSaves||Parse.Promise.as()})),batchFinished=new Parse.Promise;return Parse._arrayEach(batch,function(object){object._allPreviousSaves=batchFinished}),readyToStart._continueWith(function(){return Parse._request({route:"batch",method:"POST",useMasterKey:options.useMasterKey,data:{requests:_.map(batch,function(object){var json=object._getSaveJSON(),method="POST",path="/1/classes/"+object.className;return object.id&&(path=path+"/"+object.id,method="PUT"),object._startSave(),{method:method,path:path,body:json}})}}).then(function(response,status,xhr){var error;return Parse._arrayEach(batch,function(object,i){response[i].success?object._finishSave(object.parse(response[i].success,status,xhr)):(error=error||response[i].error,object._cancelSave())}),error?Parse.Promise.error(new Parse.Error(error.code,error.error)):void 0}).then(function(results){return batchFinished.resolve(results),results},function(error){return batchFinished.reject(error),Parse.Promise.error(error)})})})}).then(function(){return object})}}(this),function(root){root.Parse=root.Parse||{};var Parse=root.Parse,_=Parse._;Parse.Collection=function(models,options){options=options||{},options.comparator&&(this.comparator=options.comparator),options.model&&(this.model=options.model),options.query&&(this.query=options.query),this._reset(),this.initialize.apply(this,arguments),models&&this.reset(models,{silent:!0,parse:options.parse})},_.extend(Parse.Collection.prototype,Parse.Events,{model:Parse.Object,initialize:function(){},toJSON:function(){return this.map(function(model){return model.toJSON()})},add:function(models,options){var i,index,length,model,cid,id,cids={},ids={};for(options=options||{},models=_.isArray(models)?models.slice():[models],i=0,length=models.length;length>i;i++){if(models[i]=this._prepareModel(models[i],options),model=models[i],!model)throw new Error("Can't add an invalid model to a collection");if(cid=model.cid,cids[cid]||this._byCid[cid])throw new Error("Duplicate cid: can't add the same model to a collection twice");if(id=model.id,!Parse._isNullOrUndefined(id)&&(ids[id]||this._byId[id]))throw new Error("Duplicate id: can't add the same model to a collection twice");ids[id]=model,cids[cid]=model}for(i=0;length>i;i++)(model=models[i]).on("all",this._onModelEvent,this),this._byCid[model.cid]=model,model.id&&(this._byId[model.id]=model);if(this.length+=length,index=Parse._isNullOrUndefined(options.at)?this.models.length:options.at,this.models.splice.apply(this.models,[index,0].concat(models)),this.comparator&&this.sort({silent:!0}),options.silent)return this;for(i=0,length=this.models.length;length>i;i++)model=this.models[i],cids[model.cid]&&(options.index=i,model.trigger("add",model,this,options));return this},remove:function(models,options){var i,l,index,model;for(options=options||{},models=_.isArray(models)?models.slice():[models],i=0,l=models.length;l>i;i++)model=this.getByCid(models[i])||this.get(models[i]),model&&(delete this._byId[model.id],delete this._byCid[model.cid],index=this.indexOf(model),this.models.splice(index,1),this.length--,options.silent||(options.index=index,model.trigger("remove",model,this,options)),this._removeReference(model));return this},get:function(id){return id&&this._byId[id.id||id]},getByCid:function(cid){return cid&&this._byCid[cid.cid||cid]},at:function(index){return this.models[index]},sort:function(options){if(options=options||{},!this.comparator)throw new Error("Cannot sort a set without a comparator");var boundComparator=_.bind(this.comparator,this);return 1===this.comparator.length?this.models=this.sortBy(boundComparator):this.models.sort(boundComparator),options.silent||this.trigger("reset",this,options),this},pluck:function(attr){return _.map(this.models,function(model){return model.get(attr)})},reset:function(models,options){var self=this;return models=models||[],options=options||{},Parse._arrayEach(this.models,function(model){self._removeReference(model)}),this._reset(),this.add(models,{silent:!0,parse:options.parse}),options.silent||this.trigger("reset",this,options),this},fetch:function(options){options=_.clone(options)||{},void 0===options.parse&&(options.parse=!0);var collection=this,query=this.query||new Parse.Query(this.model);return query.find({useMasterKey:options.useMasterKey}).then(function(results){return options.add?collection.add(results,options):collection.reset(results,options),collection})._thenRunCallbacks(options,this)},create:function(model,options){var coll=this;if(options=options?_.clone(options):{},model=this._prepareModel(model,options),!model)return!1;options.wait||coll.add(model,options);var success=options.success;return options.success=function(nextModel,resp){options.wait&&coll.add(nextModel,options),success?success(nextModel,resp):nextModel.trigger("sync",model,resp,options)},model.save(null,options),model},parse:function(resp){return resp},chain:function(){return _(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(model,options){if(model instanceof Parse.Object)model.collection||(model.collection=this);else{var attrs=model;options.collection=this,model=new this.model(attrs,options),model._validate(model.attributes,options)||(model=!1)}return model},_removeReference:function(model){this===model.collection&&delete model.collection,model.off("all",this._onModelEvent,this)},_onModelEvent:function(ev,model,collection,options){("add"!==ev&&"remove"!==ev||collection===this)&&("destroy"===ev&&this.remove(model,options),model&&"change:objectId"===ev&&(delete this._byId[model.previous("objectId")],this._byId[model.id]=model),this.trigger.apply(this,arguments))}});var methods=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];Parse._arrayEach(methods,function(method){Parse.Collection.prototype[method]=function(){return _[method].apply(_,[this.models].concat(_.toArray(arguments)))}}),Parse.Collection.extend=Parse._extend}(this),function(root){root.Parse=root.Parse||{};var Parse=root.Parse,_=Parse._;Parse.User=Parse.Object.extend("_User",{_isCurrentUser:!1,_mergeFromObject:function(other){other.getSessionToken()&&(this._sessionToken=other.getSessionToken()),Parse.User.__super__._mergeFromObject.call(this,other)},_mergeMagicFields:function(attrs){attrs.sessionToken&&(this._sessionToken=attrs.sessionToken,delete attrs.sessionToken),Parse.User.__super__._mergeMagicFields.call(this,attrs)},_cleanupAuthData:function(){if(this.isCurrent()){var authData=this.get("authData");authData&&Parse._objectEach(this.get("authData"),function(value,key){authData[key]||delete authData[key]})}},_synchronizeAllAuthData:function(){var authData=this.get("authData");if(authData){var self=this;Parse._objectEach(this.get("authData"),function(value,key){self._synchronizeAuthData(key)})}},_synchronizeAuthData:function(provider){if(this.isCurrent()){var authType;_.isString(provider)?(authType=provider,provider=Parse.User._authProviders[authType]):authType=provider.getAuthType();var authData=this.get("authData");if(authData&&provider){var success=provider.restoreAuthentication(authData[authType]);success||this._unlinkFrom(provider)}}},_handleSaveResult:function(makeCurrent){makeCurrent&&(this._isCurrentUser=!0),this._cleanupAuthData(),this._synchronizeAllAuthData(),delete this._serverData.password,this._rebuildEstimatedDataForKey("password"),this._refreshCache(),(makeCurrent||this.isCurrent())&&Parse.User._saveCurrentUser(this)},_linkWith:function(provider,options){var authType;if(_.isString(provider)?(authType=provider,provider=Parse.User._authProviders[provider]):authType=provider.getAuthType(),_.has(options,"authData")){var authData=this.get("authData")||{};authData[authType]=options.authData,this.set("authData",authData);var newOptions=_.clone(options)||{};return newOptions.success=function(model){model._handleSaveResult(!0),options.success&&options.success.apply(this,arguments)},this.save({authData:authData},newOptions)}var self=this,promise=new Parse.Promise;return provider.authenticate({success:function(provider,result){self._linkWith(provider,{authData:result,success:options.success,error:options.error}).then(function(){promise.resolve(self)})},error:function(provider,error){options.error&&options.error(self,error),promise.reject(error)}}),promise},_unlinkFrom:function(provider,options){var authType;_.isString(provider)?(authType=provider,provider=Parse.User._authProviders[provider]):authType=provider.getAuthType();var newOptions=_.clone(options),self=this;return newOptions.authData=null,newOptions.success=function(){self._synchronizeAuthData(provider),options.success&&options.success.apply(this,arguments)},this._linkWith(provider,newOptions)},_isLinked:function(provider){var authType;authType=_.isString(provider)?provider:provider.getAuthType();var authData=this.get("authData")||{};return!!authData[authType]},_logOutWithAll:function(){var authData=this.get("authData");if(authData){var self=this;Parse._objectEach(this.get("authData"),function(value,key){self._logOutWith(key)})}},_logOutWith:function(provider){this.isCurrent()&&(_.isString(provider)&&(provider=Parse.User._authProviders[provider]),provider&&provider.deauthenticate&&provider.deauthenticate())},signUp:function(attrs,options){var error;options=options||{};var username=attrs&&attrs.username||this.get("username");if(!username||""===username)return error=new Parse.Error(Parse.Error.OTHER_CAUSE,"Cannot sign up user with an empty name."),options&&options.error&&options.error(this,error),Parse.Promise.error(error);var password=attrs&&attrs.password||this.get("password");if(!password||""===password)return error=new Parse.Error(Parse.Error.OTHER_CAUSE,"Cannot sign up user with an empty password."),options&&options.error&&options.error(this,error),Parse.Promise.error(error);var newOptions=_.clone(options);return newOptions.success=function(model){model._handleSaveResult(!0),options.success&&options.success.apply(this,arguments)},this.save(attrs,newOptions)},logIn:function(options){var model=this;options=options||{};var request=Parse._request({route:"login",method:"GET",useMasterKey:options.useMasterKey,data:this.toJSON()});return request.then(function(resp,status,xhr){var serverAttrs=model.parse(resp,status,xhr);return model._finishFetch(serverAttrs),model._handleSaveResult(!0),model})._thenRunCallbacks(options,this)},save:function(arg1,arg2,arg3){var attrs,options;_.isObject(arg1)||_.isNull(arg1)||_.isUndefined(arg1)?(attrs=arg1,options=arg2):(attrs={},attrs[arg1]=arg2,options=arg3),options=options||{};var newOptions=_.clone(options);return newOptions.success=function(model){model._handleSaveResult(!1),options.success&&options.success.apply(this,arguments)},Parse.Object.prototype.save.call(this,attrs,newOptions)},fetch:function(options){var newOptions=options?_.clone(options):{};return newOptions.success=function(model){model._handleSaveResult(!1),options&&options.success&&options.success.apply(this,arguments)},Parse.Object.prototype.fetch.call(this,newOptions)},isCurrent:function(){return this._isCurrentUser},getUsername:function(){return this.get("username")},setUsername:function(username,options){return this.set("username",username,options)},setPassword:function(password,options){return this.set("password",password,options)},getEmail:function(){return this.get("email")},setEmail:function(email,options){return this.set("email",email,options)},authenticated:function(){return!!this._sessionToken&&Parse.User.current()&&Parse.User.current().id===this.id},getSessionToken:function(){return this._sessionToken}},{_currentUser:null,_currentUserMatchesDisk:!1,_CURRENT_USER_KEY:"currentUser",_authProviders:{},_performUserRewrite:!0,signUp:function(username,password,attrs,options){attrs=attrs||{},attrs.username=username,attrs.password=password;var user=Parse.Object._create("_User");return user.signUp(attrs,options)},logIn:function(username,password,options){var user=Parse.Object._create("_User");return user._finishFetch({username:username,password:password}),user.logIn(options)},become:function(sessionToken,options){options=options||{};var user=Parse.Object._create("_User");return Parse._request({route:"users",className:"me",method:"GET",useMasterKey:options.useMasterKey,sessionToken:sessionToken}).then(function(resp,status,xhr){var serverAttrs=user.parse(resp,status,xhr);return user._finishFetch(serverAttrs),user._handleSaveResult(!0),user})._thenRunCallbacks(options,user)
},logOut:function(){null!==Parse.User._currentUser&&(Parse.User._currentUser._logOutWithAll(),Parse.User._currentUser._isCurrentUser=!1),Parse.User._currentUserMatchesDisk=!0,Parse.User._currentUser=null,Parse.localStorage.removeItem(Parse._getParsePath(Parse.User._CURRENT_USER_KEY))},requestPasswordReset:function(email,options){options=options||{};var request=Parse._request({route:"requestPasswordReset",method:"POST",useMasterKey:options.useMasterKey,data:{email:email}});return request._thenRunCallbacks(options)},current:function(){if(Parse.User._currentUser)return Parse.User._currentUser;if(Parse.User._currentUserMatchesDisk)return Parse.User._currentUser;Parse.User._currentUserMatchesDisk=!0;var userData=Parse.localStorage.getItem(Parse._getParsePath(Parse.User._CURRENT_USER_KEY));if(!userData)return null;Parse.User._currentUser=Parse.Object._create("_User"),Parse.User._currentUser._isCurrentUser=!0;var json=JSON.parse(userData);return Parse.User._currentUser.id=json._id,delete json._id,Parse.User._currentUser._sessionToken=json._sessionToken,delete json._sessionToken,Parse.User._currentUser._finishFetch(json),Parse.User._currentUser._synchronizeAllAuthData(),Parse.User._currentUser._refreshCache(),Parse.User._currentUser._opSetQueue=[{}],Parse.User._currentUser},allowCustomUserClass:function(isAllowed){this._performUserRewrite=!isAllowed},_saveCurrentUser:function(user){Parse.User._currentUser!==user&&Parse.User.logOut(),user._isCurrentUser=!0,Parse.User._currentUser=user,Parse.User._currentUserMatchesDisk=!0;var json=user.toJSON();json._id=user.id,json._sessionToken=user._sessionToken,Parse.localStorage.setItem(Parse._getParsePath(Parse.User._CURRENT_USER_KEY),JSON.stringify(json))},_registerAuthenticationProvider:function(provider){Parse.User._authProviders[provider.getAuthType()]=provider,Parse.User.current()&&Parse.User.current()._synchronizeAuthData(provider.getAuthType())},_logInWith:function(provider,options){var user=Parse.Object._create("_User");return user._linkWith(provider,options)}})}(this),function(root){root.Parse=root.Parse||{};var Parse=root.Parse,_=Parse._;Parse.Query=function(objectClass){_.isString(objectClass)&&(objectClass=Parse.Object._getSubclass(objectClass)),this.objectClass=objectClass,this.className=objectClass.prototype.className,this._where={},this._include=[],this._limit=-1,this._skip=0,this._extraOptions={}},Parse.Query.or=function(){var queries=_.toArray(arguments),className=null;Parse._arrayEach(queries,function(q){if(_.isNull(className)&&(className=q.className),className!==q.className)throw"All queries must be for the same class"});var query=new Parse.Query(className);return query._orQuery(queries),query},Parse.Query.prototype={get:function(objectId,options){var self=this;self.equalTo("objectId",objectId);var firstOptions={};return options&&_.has(options,"useMasterKey")&&(firstOptions={useMasterKey:options.useMasterKey}),self.first(firstOptions).then(function(response){if(response)return response;var errorObject=new Parse.Error(Parse.Error.OBJECT_NOT_FOUND,"Object not found.");return Parse.Promise.error(errorObject)})._thenRunCallbacks(options,null)},toJSON:function(){var params={where:this._where};return this._include.length>0&&(params.include=this._include.join(",")),this._select&&(params.keys=this._select.join(",")),this._limit>=0&&(params.limit=this._limit),this._skip>0&&(params.skip=this._skip),void 0!==this._order&&(params.order=this._order.join(",")),Parse._objectEach(this._extraOptions,function(v,k){params[k]=v}),params},find:function(options){var self=this;options=options||{};var request=Parse._request({route:"classes",className:this.className,method:"GET",useMasterKey:options.useMasterKey,data:this.toJSON()});return request.then(function(response){return _.map(response.results,function(json){var obj;return obj=response.className?new Parse.Object(response.className):new self.objectClass,obj._finishFetch(json,!0),obj})})._thenRunCallbacks(options)},count:function(options){var self=this;options=options||{};var params=this.toJSON();params.limit=0,params.count=1;var request=Parse._request({route:"classes",className:self.className,method:"GET",useMasterKey:options.useMasterKey,data:params});return request.then(function(response){return response.count})._thenRunCallbacks(options)},first:function(options){var self=this;options=options||{};var params=this.toJSON();params.limit=1;var request=Parse._request({route:"classes",className:this.className,method:"GET",useMasterKey:options.useMasterKey,data:params});return request.then(function(response){return _.map(response.results,function(json){var obj=new self.objectClass;return obj._finishFetch(json,!0),obj})[0]})._thenRunCallbacks(options)},collection:function(items,options){return options=options||{},new Parse.Collection(items,_.extend(options,{model:this.objectClass,query:this}))},skip:function(n){return this._skip=n,this},limit:function(n){return this._limit=n,this},equalTo:function(key,value){return _.isUndefined(value)?this.doesNotExist(key):(this._where[key]=Parse._encode(value),this)},_addCondition:function(key,condition,value){return this._where[key]||(this._where[key]={}),this._where[key][condition]=Parse._encode(value),this},notEqualTo:function(key,value){return this._addCondition(key,"$ne",value),this},lessThan:function(key,value){return this._addCondition(key,"$lt",value),this},greaterThan:function(key,value){return this._addCondition(key,"$gt",value),this},lessThanOrEqualTo:function(key,value){return this._addCondition(key,"$lte",value),this},greaterThanOrEqualTo:function(key,value){return this._addCondition(key,"$gte",value),this},containedIn:function(key,values){return this._addCondition(key,"$in",values),this},notContainedIn:function(key,values){return this._addCondition(key,"$nin",values),this},containsAll:function(key,values){return this._addCondition(key,"$all",values),this},exists:function(key){return this._addCondition(key,"$exists",!0),this},doesNotExist:function(key){return this._addCondition(key,"$exists",!1),this},matches:function(key,regex,modifiers){return this._addCondition(key,"$regex",regex),modifiers||(modifiers=""),regex.ignoreCase&&(modifiers+="i"),regex.multiline&&(modifiers+="m"),modifiers&&modifiers.length&&this._addCondition(key,"$options",modifiers),this},matchesQuery:function(key,query){var queryJSON=query.toJSON();return queryJSON.className=query.className,this._addCondition(key,"$inQuery",queryJSON),this},doesNotMatchQuery:function(key,query){var queryJSON=query.toJSON();return queryJSON.className=query.className,this._addCondition(key,"$notInQuery",queryJSON),this},matchesKeyInQuery:function(key,queryKey,query){var queryJSON=query.toJSON();return queryJSON.className=query.className,this._addCondition(key,"$select",{key:queryKey,query:queryJSON}),this},doesNotMatchKeyInQuery:function(key,queryKey,query){var queryJSON=query.toJSON();return queryJSON.className=query.className,this._addCondition(key,"$dontSelect",{key:queryKey,query:queryJSON}),this},_orQuery:function(queries){var queryJSON=_.map(queries,function(q){return q.toJSON().where});return this._where.$or=queryJSON,this},_quote:function(s){return"\\Q"+s.replace("\\E","\\E\\\\E\\Q")+"\\E"},contains:function(key,value){return this._addCondition(key,"$regex",this._quote(value)),this},startsWith:function(key,value){return this._addCondition(key,"$regex","^"+this._quote(value)),this},endsWith:function(key,value){return this._addCondition(key,"$regex",this._quote(value)+"$"),this},ascending:function(){return this._order=[],this.addAscending.apply(this,arguments)},addAscending:function(){var self=this;return this._order||(this._order=[]),Parse._arrayEach(arguments,function(key){Array.isArray(key)&&(key=key.join()),self._order=self._order.concat(key.replace(/\s/g,"").split(","))}),this},descending:function(){return this._order=[],this.addDescending.apply(this,arguments)},addDescending:function(){var self=this;return this._order||(this._order=[]),Parse._arrayEach(arguments,function(key){Array.isArray(key)&&(key=key.join()),self._order=self._order.concat(_.map(key.replace(/\s/g,"").split(","),function(k){return"-"+k}))}),this},near:function(key,point){return point instanceof Parse.GeoPoint||(point=new Parse.GeoPoint(point)),this._addCondition(key,"$nearSphere",point),this},withinRadians:function(key,point,distance){return this.near(key,point),this._addCondition(key,"$maxDistance",distance),this},withinMiles:function(key,point,distance){return this.withinRadians(key,point,distance/3958.8)},withinKilometers:function(key,point,distance){return this.withinRadians(key,point,distance/6371)},withinGeoBox:function(key,southwest,northeast){return southwest instanceof Parse.GeoPoint||(southwest=new Parse.GeoPoint(southwest)),northeast instanceof Parse.GeoPoint||(northeast=new Parse.GeoPoint(northeast)),this._addCondition(key,"$within",{$box:[southwest,northeast]}),this},include:function(){var self=this;return Parse._arrayEach(arguments,function(key){_.isArray(key)?self._include=self._include.concat(key):self._include.push(key)}),this},select:function(){var self=this;return this._select=this._select||[],Parse._arrayEach(arguments,function(key){_.isArray(key)?self._select=self._select.concat(key):self._select.push(key)}),this},each:function(callback,options){if(options=options||{},this._order||this._skip||this._limit>=0){var error="Cannot iterate on a query with sort, skip, or limit.";return Parse.Promise.error(error)._thenRunCallbacks(options)}var query=(new Parse.Promise,new Parse.Query(this.objectClass));query._limit=options.batchSize||100,query._where=_.clone(this._where),query._include=_.clone(this._include),query.ascending("objectId");var findOptions={};_.has(options,"useMasterKey")&&(findOptions.useMasterKey=options.useMasterKey);var finished=!1;return Parse.Promise._continueWhile(function(){return!finished},function(){return query.find(findOptions).then(function(results){var callbacksDone=Parse.Promise.as();return Parse._.each(results,function(result){callbacksDone=callbacksDone.then(function(){return callback(result)})}),callbacksDone.then(function(){results.length>=query._limit?query.greaterThan("objectId",results[results.length-1].id):finished=!0})})})._thenRunCallbacks(options)}}}(this)}.bind(root)(),root.Parse});var Showdown={extensions:{}},forEach=Showdown.forEach=function(obj,callback){if("function"==typeof obj.forEach)obj.forEach(callback);else{var i,len=obj.length;for(i=0;len>i;i++)callback(obj[i],i,obj)}},stdExtName=function(s){return s.replace(/[_-]||\s/g,"").toLowerCase()};Showdown.converter=function(converter_options){var g_urls,g_titles,g_html_blocks,g_list_level=0,g_lang_extensions=[],g_output_modifiers=[];if("undefind"!=typeof module&&"undefined"!=typeof exports&&"undefind"!=typeof require){var fs=require("fs");if(fs){var extensions=fs.readdirSync((__dirname||".")+"/extensions").filter(function(file){return~file.indexOf(".js")}).map(function(file){return file.replace(/\.js$/,"")});Showdown.forEach(extensions,function(ext){var name=stdExtName(ext);Showdown.extensions[name]=require("./extensions/"+ext)})}}if(this.makeHtml=function(text){return g_urls={},g_titles={},g_html_blocks=[],text=text.replace(/~/g,"~T"),text=text.replace(/\$/g,"~D"),text=text.replace(/\r\n/g,"\n"),text=text.replace(/\r/g,"\n"),text="\n\n"+text+"\n\n",text=_Detab(text),text=text.replace(/^[ \t]+$/gm,""),Showdown.forEach(g_lang_extensions,function(x){text=_ExecuteExtension(x,text)}),text=_DoGithubCodeBlocks(text),text=_HashHTMLBlocks(text),text=_StripLinkDefinitions(text),text=_RunBlockGamut(text),text=_UnescapeSpecialChars(text),text=text.replace(/~D/g,"$$"),text=text.replace(/~T/g,"~"),Showdown.forEach(g_output_modifiers,function(x){text=_ExecuteExtension(x,text)}),text},converter_options&&converter_options.extensions){var self=this;Showdown.forEach(converter_options.extensions,function(plugin){if("string"==typeof plugin&&(plugin=Showdown.extensions[stdExtName(plugin)]),"function"!=typeof plugin)throw"Extension '"+plugin+"' could not be loaded.  It was either not found or is not a valid extension.";Showdown.forEach(plugin(self),function(ext){ext.type?"language"===ext.type||"lang"===ext.type?g_lang_extensions.push(ext):("output"===ext.type||"html"===ext.type)&&g_output_modifiers.push(ext):g_output_modifiers.push(ext)})})}var _ProcessListItems,_ExecuteExtension=function(ext,text){if(ext.regex){var re=new RegExp(ext.regex,"g");return text.replace(re,ext.replace)}return ext.filter?ext.filter(text):void 0},_StripLinkDefinitions=function(text){return text+="~0",text=text.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|(?=~0))/gm,function(wholeMatch,m1,m2,m3,m4){return m1=m1.toLowerCase(),g_urls[m1]=_EncodeAmpsAndAngles(m2),m3?m3+m4:(m4&&(g_titles[m1]=m4.replace(/"/g,"&quot;")),"")}),text=text.replace(/~0/,"")},_HashHTMLBlocks=function(text){text=text.replace(/\n/g,"\n\n");return text=text.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,hashElement),text=text.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|style|section|header|footer|nav|article|aside)\b[^\r]*?<\/\2>[ \t]*(?=\n+)\n)/gm,hashElement),text=text.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,hashElement),text=text.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,hashElement),text=text.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,hashElement),text=text.replace(/\n\n/g,"\n")},hashElement=function(wholeMatch,m1){var blockText=m1;return blockText=blockText.replace(/\n\n/g,"\n"),blockText=blockText.replace(/^\n/,""),blockText=blockText.replace(/\n+$/g,""),blockText="\n\n~K"+(g_html_blocks.push(blockText)-1)+"K\n\n"},_RunBlockGamut=function(text){text=_DoHeaders(text);var key=hashBlock("<hr />");return text=text.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,key),text=text.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,key),text=text.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,key),text=_DoLists(text),text=_DoCodeBlocks(text),text=_DoBlockQuotes(text),text=_HashHTMLBlocks(text),text=_FormParagraphs(text)},_RunSpanGamut=function(text){return text=_DoCodeSpans(text),text=_EscapeSpecialCharsWithinTagAttributes(text),text=_EncodeBackslashEscapes(text),text=_DoImages(text),text=_DoAnchors(text),text=_DoAutoLinks(text),text=_EncodeAmpsAndAngles(text),text=_DoItalicsAndBold(text),text=text.replace(/  +\n/g," <br />\n")},_EscapeSpecialCharsWithinTagAttributes=function(text){var regex=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return text=text.replace(regex,function(wholeMatch){var tag=wholeMatch.replace(/(.)<\/?code>(?=.)/g,"$1`");return tag=escapeCharacters(tag,"\\`*_")})},_DoAnchors=function(text){return text=text.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,writeAnchorTag),text=text.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?(?:\(.*?\).*?)?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,writeAnchorTag),text=text.replace(/(\[([^\[\]]+)\])()()()()()/g,writeAnchorTag)},writeAnchorTag=function(wholeMatch,m1,m2,m3,m4,m5,m6,m7){void 0==m7&&(m7="");var whole_match=m1,link_text=m2,link_id=m3.toLowerCase(),url=m4,title=m7;if(""==url)if(""==link_id&&(link_id=link_text.toLowerCase().replace(/ ?\n/g," ")),url="#"+link_id,void 0!=g_urls[link_id])url=g_urls[link_id],void 0!=g_titles[link_id]&&(title=g_titles[link_id]);else{if(!(whole_match.search(/\(\s*\)$/m)>-1))return whole_match;url=""}url=escapeCharacters(url,"*_");var result='<a href="'+url+'"';return""!=title&&(title=title.replace(/"/g,"&quot;"),title=escapeCharacters(title,"*_"),result+=' title="'+title+'"'),result+=">"+link_text+"</a>"},_DoImages=function(text){return text=text.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,writeImageTag),text=text.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,writeImageTag)},writeImageTag=function(wholeMatch,m1,m2,m3,m4,m5,m6,m7){var whole_match=m1,alt_text=m2,link_id=m3.toLowerCase(),url=m4,title=m7;if(title||(title=""),""==url){if(""==link_id&&(link_id=alt_text.toLowerCase().replace(/ ?\n/g," ")),url="#"+link_id,void 0==g_urls[link_id])return whole_match;url=g_urls[link_id],void 0!=g_titles[link_id]&&(title=g_titles[link_id])}alt_text=alt_text.replace(/"/g,"&quot;"),url=escapeCharacters(url,"*_");var result='<img src="'+url+'" alt="'+alt_text+'"';return title=title.replace(/"/g,"&quot;"),title=escapeCharacters(title,"*_"),result+=' title="'+title+'"',result+=" />"},_DoHeaders=function(text){function headerId(m){return m.replace(/[^\w]/g,"").toLowerCase()}return text=text.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(wholeMatch,m1){return hashBlock('<h1 id="'+headerId(m1)+'">'+_RunSpanGamut(m1)+"</h1>")}),text=text.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(matchFound,m1){return hashBlock('<h2 id="'+headerId(m1)+'">'+_RunSpanGamut(m1)+"</h2>")}),text=text.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(wholeMatch,m1,m2){var h_level=m1.length;return hashBlock("<h"+h_level+' id="'+headerId(m2)+'">'+_RunSpanGamut(m2)+"</h"+h_level+">")})},_DoLists=function(text){text+="~0";var whole_list=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return g_list_level?text=text.replace(whole_list,function(wholeMatch,m1,m2){var list=m1,list_type=m2.search(/[*+-]/g)>-1?"ul":"ol";list=list.replace(/\n{2,}/g,"\n\n\n");var result=_ProcessListItems(list);return result=result.replace(/\s+$/,""),result="<"+list_type+">"+result+"</"+list_type+">\n"}):(whole_list=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,text=text.replace(whole_list,function(wholeMatch,m1,m2,m3){var runup=m1,list=m2,list_type=m3.search(/[*+-]/g)>-1?"ul":"ol",list=list.replace(/\n{2,}/g,"\n\n\n"),result=_ProcessListItems(list);return result=runup+"<"+list_type+">\n"+result+"</"+list_type+">\n"})),text=text.replace(/~0/,"")};_ProcessListItems=function(list_str){return g_list_level++,list_str=list_str.replace(/\n{2,}$/,"\n"),list_str+="~0",list_str=list_str.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(wholeMatch,m1,m2,m3,m4){var item=m4,leading_line=m1;return leading_line||item.search(/\n{2,}/)>-1?item=_RunBlockGamut(_Outdent(item)):(item=_DoLists(_Outdent(item)),item=item.replace(/\n$/,""),item=_RunSpanGamut(item)),"<li>"+item+"</li>\n"}),list_str=list_str.replace(/~0/g,""),g_list_level--,list_str};var _DoCodeBlocks=function(text){return text+="~0",text=text.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(wholeMatch,m1,m2){var codeblock=m1,nextChar=m2;return codeblock=_EncodeCode(_Outdent(codeblock)),codeblock=_Detab(codeblock),codeblock=codeblock.replace(/^\n+/g,""),codeblock=codeblock.replace(/\n+$/g,""),codeblock="<pre><code>"+codeblock+"\n</code></pre>",hashBlock(codeblock)+nextChar}),text=text.replace(/~0/,"")},_DoGithubCodeBlocks=function(text){return text+="~0",text=text.replace(/(?:^|\n)```(.*)\n([\s\S]*?)\n```/g,function(wholeMatch,m1,m2){var language=m1,codeblock=m2;return codeblock=_EncodeCode(codeblock),codeblock=_Detab(codeblock),codeblock=codeblock.replace(/^\n+/g,""),codeblock=codeblock.replace(/\n+$/g,""),codeblock="<pre><code"+(language?' class="'+language+'"':"")+">"+codeblock+"\n</code></pre>",hashBlock(codeblock)}),text=text.replace(/~0/,"")},hashBlock=function(text){return text=text.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(g_html_blocks.push(text)-1)+"K\n\n"},_DoCodeSpans=function(text){return text=text.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(wholeMatch,m1,m2,m3){var c=m3;return c=c.replace(/^([ \t]*)/g,""),c=c.replace(/[ \t]*$/g,""),c=_EncodeCode(c),m1+"<code>"+c+"</code>"})},_EncodeCode=function(text){return text=text.replace(/&/g,"&amp;"),text=text.replace(/</g,"&lt;"),text=text.replace(/>/g,"&gt;"),text=escapeCharacters(text,"*_{}[]\\",!1)},_DoItalicsAndBold=function(text){return text=text.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>"),text=text.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>")},_DoBlockQuotes=function(text){return text=text.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(wholeMatch,m1){var bq=m1;return bq=bq.replace(/^[ \t]*>[ \t]?/gm,"~0"),bq=bq.replace(/~0/g,""),bq=bq.replace(/^[ \t]+$/gm,""),bq=_RunBlockGamut(bq),bq=bq.replace(/(^|\n)/g,"$1  "),bq=bq.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(wholeMatch,m1){var pre=m1;return pre=pre.replace(/^  /gm,"~0"),pre=pre.replace(/~0/g,"")}),hashBlock("<blockquote>\n"+bq+"\n</blockquote>")})},_FormParagraphs=function(text){text=text.replace(/^\n+/g,""),text=text.replace(/\n+$/g,"");for(var grafs=text.split(/\n{2,}/g),grafsOut=[],end=grafs.length,i=0;end>i;i++){var str=grafs[i];str.search(/~K(\d+)K/g)>=0?grafsOut.push(str):str.search(/\S/)>=0&&(str=_RunSpanGamut(str),str=str.replace(/^([ \t]*)/g,"<p>"),str+="</p>",grafsOut.push(str))}end=grafsOut.length;for(var i=0;end>i;i++)for(;grafsOut[i].search(/~K(\d+)K/)>=0;){var blockText=g_html_blocks[RegExp.$1];blockText=blockText.replace(/\$/g,"$$$$"),grafsOut[i]=grafsOut[i].replace(/~K\d+K/,blockText)}return grafsOut.join("\n\n")},_EncodeAmpsAndAngles=function(text){return text=text.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),text=text.replace(/<(?![a-z\/?\$!])/gi,"&lt;")},_EncodeBackslashEscapes=function(text){return text=text.replace(/\\(\\)/g,escapeCharacters_callback),text=text.replace(/\\([`*_{}\[\]()>#+-.!])/g,escapeCharacters_callback)},_DoAutoLinks=function(text){return text=text.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>'),text=text.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(wholeMatch,m1){return _EncodeEmailAddress(_UnescapeSpecialChars(m1))})},_EncodeEmailAddress=function(addr){var encode=[function(ch){return"&#"+ch.charCodeAt(0)+";"},function(ch){return"&#x"+ch.charCodeAt(0).toString(16)+";"},function(ch){return ch}];return addr="mailto:"+addr,addr=addr.replace(/./g,function(ch){if("@"==ch)ch=encode[Math.floor(2*Math.random())](ch);else if(":"!=ch){var r=Math.random();ch=r>.9?encode[2](ch):r>.45?encode[1](ch):encode[0](ch)}return ch}),addr='<a href="'+addr+'">'+addr+"</a>",addr=addr.replace(/">.+:/g,'">')},_UnescapeSpecialChars=function(text){return text=text.replace(/~E(\d+)E/g,function(wholeMatch,m1){var charCodeToReplace=parseInt(m1);return String.fromCharCode(charCodeToReplace)})},_Outdent=function(text){return text=text.replace(/^(\t|[ ]{1,4})/gm,"~0"),text=text.replace(/~0/g,"")},_Detab=function(text){return text=text.replace(/\t(?=\t)/g,"    "),text=text.replace(/\t/g,"~A~B"),text=text.replace(/~B(.+?)~A/g,function(wholeMatch,m1){for(var leadingText=m1,numSpaces=4-leadingText.length%4,i=0;numSpaces>i;i++)leadingText+=" ";return leadingText}),text=text.replace(/~A/g,"    "),text=text.replace(/~B/g,"")},escapeCharacters=function(text,charsToEscape,afterBackslash){var regexString="(["+charsToEscape.replace(/([\[\]\\])/g,"\\$1")+"])";afterBackslash&&(regexString="\\\\"+regexString);var regex=new RegExp(regexString,"g");return text=text.replace(regex,escapeCharacters_callback)},escapeCharacters_callback=function(wholeMatch,m1){var charCodeToEscape=m1.charCodeAt(0);return"~E"+charCodeToEscape+"E"}},"undefined"!=typeof module&&(module.exports=Showdown),"function"==typeof define&&define.amd&&define("showdown",function(){return Showdown});